<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Vue移动端项目流程 | 蜡笔小新Blogs</title>
  <meta name="keywords" content=" Vue , Vue2 ">
  <meta name="description" content="Vue移动端项目流程 | 蜡笔小新Blogs">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="vue3 如何注册全局组件123456789import &amp;#123; createApp &amp;#125; from &amp;#x27;vue&amp;#x27;import App from &amp;#x27;.&#x2F;App.vue&amp;#x27;const app &#x3D; createApp(App)&#x2F;&#x2F; 注册全局组件import SaveButton from &amp;#x27;@&#x2F;globalComponents&#x2F;SaveBut">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue3全局注册问题">
<meta property="og:url" content="http://yoursite.com/2020/12/12/Vue3%E5%85%A8%E5%B1%80%E6%B3%A8%E5%86%8C%E9%97%AE%E9%A2%98/index.html">
<meta property="og:site_name" content="蜡笔小新Blogs">
<meta property="og:description" content="vue3 如何注册全局组件123456789import &amp;#123; createApp &amp;#125; from &amp;#x27;vue&amp;#x27;import App from &amp;#x27;.&#x2F;App.vue&amp;#x27;const app &#x3D; createApp(App)&#x2F;&#x2F; 注册全局组件import SaveButton from &amp;#x27;@&#x2F;globalComponents&#x2F;SaveBut">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-11-27_22-50-21.png">
<meta property="og:image" content="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-11-27_22-50-44.png">
<meta property="og:image" content="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-11-27_22-51-07.png">
<meta property="og:image" content="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-11-27_22-51-35.png">
<meta property="og:image" content="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-11-27_22-52-06.png">
<meta property="og:image" content="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-11-27_22-52-58.png">
<meta property="og:image" content="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-11-27_22-53-28.png">
<meta property="og:image" content="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-12-12_21-01-25.png">
<meta property="og:image" content="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-12-12_21-04-50.png">
<meta property="og:image" content="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-12-12_21-05-45.png">
<meta property="og:image" content="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-12-12_21-07-11.png">
<meta property="article:published_time" content="2020-12-12T15:40:46.000Z">
<meta property="article:modified_time" content="2020-12-12T15:44:33.466Z">
<meta property="article:author" content="蜡笔小新">
<meta property="article:tag" content="Vue">
<meta property="article:tag" content="Vue3">
<meta property="article:tag" content="Vue3全局注册">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-11-27_22-50-21.png">


<link rel="icon" href="/img/avatar3.jpg">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1" ></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.0.1" ></script>

<meta name="generator" content="Hexo 5.2.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value="">
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span>蜡笔小新</span>
</div>

<div class="icon">
    
        
        <a title="github" href="https://github.com/YHX0507" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
        <a title="weibo" href="https://www.weibo.com/3863592977" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-weibo"></use>
                </svg>
            
        </a>
        
    
        
        <a title="zhihu" href="https://www.zhihu.com/people/00huan-shi-90/activities" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-zhihu"></use>
                </svg>
            
        </a>
        
    
        
        <a title="email" href="mailto:1183376071@qq.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=1183376071&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(24)</small></div></li>
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="24">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode === 13){return false;}">
        <input id="local-search-input" class="search" type="text" placeholder="Search..." />
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a class="color1">Proxy</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">defineProperty</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">cookie</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">session</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">Redux</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">React</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Vue</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">Vue-router</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">router</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">Vue3</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">v-model</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">Vue3新特性</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">移动项目</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">总结</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">Vue组件通信</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">git</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">git stash</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">git 版本回退</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">不是内部命令或外部命令</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">不是可运行的程序</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">redux</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">react</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">Node</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">Express</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">小程序</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">数组方法</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">面试题</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">csv表格下载</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">文件下载</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">图片下载</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">Webpack</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">Webpack入门</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">Blob</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">Vue3全局注册</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">Vue2</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">Canvas</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <nav id="title-list-nav">
        
        <a  class=""
           href="/2018/07/10/Proxy/"
           data-tag="Proxy,defineProperty"
           data-author="" >
            <span class="post-title" title="Proxy和Object.defineProperty">Proxy和Object.defineProperty</span>
            <span class="post-date" title="2018-07-10 22:01:28">2018/07/10</span>
        </a>
        
        <a  class=""
           href="/2018/10/11/Cookie%E5%92%8CSession/"
           data-tag="cookie,session"
           data-author="" >
            <span class="post-title" title="Cookie和Session">Cookie和Session</span>
            <span class="post-date" title="2018-10-11 17:23:07">2018/10/11</span>
        </a>
        
        <a  class=""
           href="/2019/01/06/Redux%E9%85%8D%E5%90%88React%E4%BD%BF%E7%94%A8/"
           data-tag="Redux,React"
           data-author="" >
            <span class="post-title" title="Redux配合React使用">Redux配合React使用</span>
            <span class="post-date" title="2019-01-06 21:52:52">2019/01/06</span>
        </a>
        
        <a  class=""
           href="/2020/12/12/Vue-router4%E7%9A%84%E4%B8%80%E4%BA%9B%E5%8F%98%E5%8C%96/"
           data-tag="Vue,Vue-router,router"
           data-author="" >
            <span class="post-title" title="Vue-router4的一些变化">Vue-router4的一些变化</span>
            <span class="post-date" title="2020-12-12 19:54:58">2020/12/12</span>
        </a>
        
        <a  class=""
           href="/2020/11/27/Vue3v-model/"
           data-tag="Vue,Vue3,v-model"
           data-author="" >
            <span class="post-title" title="Vue3v-model">Vue3v-model</span>
            <span class="post-date" title="2020-11-27 23:07:36">2020/11/27</span>
        </a>
        
        <a  class=""
           href="/2020/12/12/Vue3%E5%85%A8%E5%B1%80%E6%B3%A8%E5%86%8C%E9%97%AE%E9%A2%98/"
           data-tag="Vue,Vue3,Vue3全局注册"
           data-author="" >
            <span class="post-title" title="Vue3全局注册问题">Vue3全局注册问题</span>
            <span class="post-date" title="2020-12-12 23:40:46">2020/12/12</span>
        </a>
        
        <a  class=""
           href="/2020/11/27/Vue3%E6%96%B0%E7%89%B9%E6%80%A7/"
           data-tag="Vue,Vue3,Vue3新特性"
           data-author="" >
            <span class="post-title" title="Vue3新特性">Vue3新特性</span>
            <span class="post-date" title="2020-11-27 21:39:25">2020/11/27</span>
        </a>
        
        <a  class=""
           href="/2018/03/01/Vue%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/"
           data-tag="Vue,移动项目,总结"
           data-author="" >
            <span class="post-title" title="Vue移动端项目总结">Vue移动端项目总结</span>
            <span class="post-date" title="2018-03-01 11:43:25">2018/03/01</span>
        </a>
        
        <a  class=""
           href="/2018/04/13/Vue%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1/"
           data-tag="Vue,Vue组件通信"
           data-author="" >
            <span class="post-title" title="Vue组件通信">Vue组件通信</span>
            <span class="post-date" title="2018-04-13 11:08:34">2018/04/13</span>
        </a>
        
        <a  class=""
           href="/2017/10/30/git%E6%93%8D%E4%BD%9C/"
           data-tag="git,git stash,git 版本回退"
           data-author="" >
            <span class="post-title" title="git操作">git操作</span>
            <span class="post-date" title="2017-10-30 20:59:36">2017/10/30</span>
        </a>
        
        <a  class=""
           href="/2019/04/04/npm%E5%85%A8%E5%B1%80%E5%AE%89%E8%A3%85%E5%8C%85%E5%90%8E%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/"
           data-tag="不是内部命令或外部命令,不是可运行的程序"
           data-author="" >
            <span class="post-title" title="npm全局安装包后无法使用问题解决">npm全局安装包后无法使用问题解决</span>
            <span class="post-date" title="2019-04-04 20:19:36">2019/04/04</span>
        </a>
        
        <a  class=""
           href="/2019/03/30/redux/"
           data-tag="redux,react"
           data-author="" >
            <span class="post-title" title="redux">redux</span>
            <span class="post-date" title="2019-03-30 20:37:10">2019/03/30</span>
        </a>
        
        <a  class=""
           href="/2018/09/14/node/"
           data-tag="Node,Express"
           data-author="" >
            <span class="post-title" title="node">node</span>
            <span class="post-date" title="2018-09-14 20:43:25">2018/09/14</span>
        </a>
        
        <a  class=""
           href="/2018/02/27/%E5%85%B3%E4%BA%8E%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E7%9A%84%E6%80%BB%E7%BB%93/"
           data-tag="小程序"
           data-author="" >
            <span class="post-title" title="关于小程序开发的总结">关于小程序开发的总结</span>
            <span class="post-date" title="2018-02-27 20:56:38">2018/02/27</span>
        </a>
        
        <a  class=""
           href="/2017/12/15/%E6%95%B0%E7%BB%84%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95%EF%BC%8C%E6%8E%8C%E6%8F%A1%E8%BF%99%E4%BA%9B%E5%B0%B1%E5%A4%9F%E4%BA%86/"
           data-tag="数组方法"
           data-author="" >
            <span class="post-title" title="数组常用方法，掌握这些就够了">数组常用方法，掌握这些就够了</span>
            <span class="post-date" title="2017-12-15 21:31:43">2017/12/15</span>
        </a>
        
        <a  class=""
           href="/2020/11/01/%E7%BB%8F%E5%85%B8%E9%9D%A2%E8%AF%95%E9%A2%98/"
           data-tag="面试题"
           data-author="" >
            <span class="post-title" title="经典面试题">经典面试题</span>
            <span class="post-date" title="2020-11-01 15:20:58">2020/11/01</span>
        </a>
        
        <a  class=""
           href="/2017/08/15/%E9%80%9A%E8%BF%87json2csv%E5%89%8D%E7%AB%AF%E5%AF%BC%E5%87%BA/"
           data-tag="csv表格下载,文件下载"
           data-author="" >
            <span class="post-title" title="前端前端导出csv文件（通过json2csv前端导出）">前端前端导出csv文件（通过json2csv前端导出）</span>
            <span class="post-date" title="2017-08-15 20:36:14">2017/08/15</span>
        </a>
        
        <a  class=""
           href="/2020/08/06/%E9%80%9A%E8%BF%87Blob%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD/"
           data-tag="文件下载,图片下载"
           data-author="" >
            <span class="post-title" title="通过Blob实现图片下载">通过Blob实现图片下载</span>
            <span class="post-date" title="2020-08-06 20:50:25">2020/08/06</span>
        </a>
        
        <a  class=""
           href="/2019/07/20/Webpack%E5%85%A5%E9%97%A8/"
           data-tag="Webpack,Webpack入门"
           data-author="" >
            <span class="post-title" title="Webpack入门">Webpack入门</span>
            <span class="post-date" title="2019-07-20 20:04:42">2019/07/20</span>
        </a>
        
        <a  class=""
           href="/2019/08/06/%E5%89%8D%E7%AB%AF%E9%80%9A%E8%BF%87Blob%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/"
           data-tag="文件下载,Blob"
           data-author="" >
            <span class="post-title" title="前端通过Blob实现文件下载">前端通过Blob实现文件下载</span>
            <span class="post-date" title="2019-08-06 19:59:09">2019/08/06</span>
        </a>
        
        <a  class=""
           href="/2019/03/01/React%E5%9F%BA%E7%A1%80/"
           data-tag="react"
           data-author="" >
            <span class="post-title" title="React基础">React基础</span>
            <span class="post-date" title="2019-03-01 15:30:58">2019/03/01</span>
        </a>
        
        <a  class=""
           href="/2019/12/18/Vue%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%A1%B9%E7%9B%AE%E6%B5%81%E7%A8%8B/"
           data-tag="Vue,Vue2"
           data-author="" >
            <span class="post-title" title="Vue移动端项目流程">Vue移动端项目流程</span>
            <span class="post-date" title="2019-12-18 23:50:43">2019/12/18</span>
        </a>
        
        <a  class=""
           href="/2019/12/12/Webpack%E6%89%93%E5%8C%85Vue%E9%A1%B9%E7%9B%AE/"
           data-tag="Vue,Webpack"
           data-author="" >
            <span class="post-title" title="Webpack打包Vue项目">Webpack打包Vue项目</span>
            <span class="post-date" title="2019-12-12 21:06:46">2019/12/12</span>
        </a>
        
        <a  class=""
           href="/2020/01/22/Canvas/"
           data-tag="Canvas"
           data-author="" >
            <span class="post-title" title="Canvas">Canvas</span>
            <span class="post-date" title="2020-01-22 20:35:57">2020/01/22</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-Vue移动端项目流程" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">Vue移动端项目流程</h1>
    
    <div class="article-meta">
        
        
        
        
        <span class="tag">
            
            <a class="color4">Vue</a>
            
            <a class="color5">Vue2</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2020-12-18 23:54:19'>2019-12-18 23:50</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">一、项目初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Vue-CLI-%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-text">使用 Vue CLI 创建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E8%AF%B4%E6%98%8E"><span class="toc-text">初始目录结构说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5-Git-%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86"><span class="toc-text">加入 Git 版本管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E6%95%B4%E5%88%9D%E5%A7%8B%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-text">调整初始目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5-Vant"><span class="toc-text">导入 Vant</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Vant-%E4%BB%8B%E7%BB%8D"><span class="toc-text">Vant 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5"><span class="toc-text">导入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B7%E5%BC%8F"><span class="toc-text">样式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E5%A4%84%E7%90%86%E5%99%A8%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-text">预处理器文件结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#normalize-css"><span class="toc-text">normalize.css</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E5%AD%97%E4%BD%93%E5%9B%BE%E6%A0%87"><span class="toc-text">关于字体图标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-REM-%E9%80%82%E9%85%8D"><span class="toc-text">配置 REM 适配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E8%AE%BE%E8%AE%A1%E7%A8%BF%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">关于设计稿的使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E8%AF%B7%E6%B1%82%E6%A8%A1%E5%9D%97"><span class="toc-text">封装请求模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#axios"><span class="toc-text">axios</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%90%8E%E7%AB%AF%E8%BF%94%E5%9B%9E%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8C%85%E5%90%AB%E8%B6%85%E5%87%BA-JS-%E5%AE%89%E5%85%A8%E6%95%B4%E6%95%B0%E8%8C%83%E5%9B%B4%E6%95%B0%E5%AD%97%E9%97%AE%E9%A2%98"><span class="toc-text">处理后端返回数据中包含超出 JS 安全整数范围数字问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%B3%A8%E5%86%8C"><span class="toc-text">二、用户登录注册</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87"><span class="toc-text">准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%99%BB%E5%BD%95%E7%BB%84%E4%BB%B6%E5%B9%B6%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1"><span class="toc-text">创建登录组件并配置路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E7%BB%93%E6%9E%84"><span class="toc-text">布局结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E6%A0%B7%E5%BC%8F"><span class="toc-text">布局样式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%9F%BA%E6%9C%AC%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-text">实现基本登录功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A"><span class="toc-text">数据绑定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E7%99%BB%E5%BD%95"><span class="toc-text">请求登录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E4%B8%AD%E6%8F%90%E7%A4%BA"><span class="toc-text">登录中提示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%B0%81%E8%A3%85%E8%AF%B7%E6%B1%82%E6%A8%A1%E5%9D%97"><span class="toc-text">优化封装请求模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-text">发送验证码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%80%92%E8%AE%A1%E6%97%B6%E7%BB%84%E4%BB%B6"><span class="toc-text">使用倒计时组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E9%AA%8C%E8%AF%81%E7%A0%81-1"><span class="toc-text">发送验证码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81"><span class="toc-text">表单验证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81%E6%96%B9%E5%BC%8F%E4%BB%8B%E7%BB%8D"><span class="toc-text">表单验证方式介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE"><span class="toc-text">安装和配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%86%85%E7%BD%AE%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%99"><span class="toc-text">使用内置验证规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%99"><span class="toc-text">使用自定义验证规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91%E9%AA%8C%E8%AF%81"><span class="toc-text">手动触发验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E6%8C%87%E5%AE%9A%E6%95%B0%E6%8D%AE%E5%AD%97%E6%AE%B5"><span class="toc-text">验证指定数据字段</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81Token-%E5%A4%84%E7%90%86"><span class="toc-text">三、Token 处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Token-%E4%BB%8B%E7%BB%8D"><span class="toc-text">Token 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP-%E6%98%AF%E6%97%A0%E7%8A%B6%E6%80%81%E7%9A%84"><span class="toc-text">HTTP 是无状态的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-Cookie-%E7%9A%84%E7%8A%B6%E6%80%81%E4%BF%9D%E6%8C%81"><span class="toc-text">基于 Cookie 的状态保持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-Session-%E7%9A%84%E7%8A%B6%E6%80%81%E4%BF%9D%E6%8C%81"><span class="toc-text">基于 Session 的状态保持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-Token%EF%BC%88%E4%BB%A4%E7%89%8C%E3%80%81%E5%87%AD%E6%8D%AE%E3%80%81%E5%87%AD%E8%AF%81%EF%BC%89-%E7%9A%84%E7%8A%B6%E6%80%81%E4%BF%9D%E6%8C%81"><span class="toc-text">基于 Token（令牌、凭据、凭证） 的状态保持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JWT%EF%BC%88JSON-Web-Token%EF%BC%89"><span class="toc-text">JWT（JSON Web Token）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8-Token"><span class="toc-text">存储 Token</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90-Token"><span class="toc-text">解析 Token</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E9%80%81-Token"><span class="toc-text">发送 Token</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86-Token-%E8%BF%87%E6%9C%9F%EF%BC%88%E5%9C%A8%E5%8A%9F%E8%83%BD%E4%BC%98%E5%8C%96%E4%B8%AD%E8%BF%9B%E8%A1%8C%E8%AE%B2%E8%A7%A3%EF%BC%89"><span class="toc-text">处理 Token 过期（在功能优化中进行讲解）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%EF%BC%88%E6%88%91%E7%9A%84%EF%BC%89"><span class="toc-text">四、个人中心（我的）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TabBar"><span class="toc-text">TabBar</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-tabbar-%E7%BB%84%E4%BB%B6%E5%B9%B6%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1"><span class="toc-text">创建 tabbar 组件并配置路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%88%AB%E5%88%9B%E5%BB%BA%E9%A6%96%E9%A1%B5%E3%80%81%E9%97%AE%E7%AD%94%E3%80%81%E8%A7%86%E9%A2%91%E3%80%81%E6%88%91%E7%9A%84%E9%A1%B5%E9%9D%A2%E7%BB%84%E4%BB%B6"><span class="toc-text">分别创建首页、问答、视频、我的页面组件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%91%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80"><span class="toc-text">我的页面布局</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%B7%B2%E7%99%BB%E5%BD%95%E5%92%8C%E6%9C%AA%E7%99%BB%E5%BD%95%E7%9A%84%E5%B1%95%E7%A4%BA%E7%8A%B6%E6%80%81"><span class="toc-text">处理已登录和未登录的展示状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-text">展示当前登录用户信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E9%80%80%E5%87%BA"><span class="toc-text">用户退出</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E7%94%A8%E6%88%B7%E9%A1%B5%E9%9D%A2"><span class="toc-text">五、用户页面</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87-1"><span class="toc-text">准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BB%84%E4%BB%B6%E5%B9%B6%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1"><span class="toc-text">创建组件并配置路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80"><span class="toc-text">页面布局</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-text">展示用户信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E7%94%A8%E6%88%B7%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8"><span class="toc-text">展示用户文章列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E7%BB%84%E4%BB%B6"><span class="toc-text">列表组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E5%88%97%E8%A1%A8%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8"><span class="toc-text">分析列表组件使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8"><span class="toc-text">展示文章列表</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E9%A6%96%E9%A1%B5%E2%80%94%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8"><span class="toc-text">六、首页—文章列表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B1%80"><span class="toc-text">布局</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E9%A2%91%E9%81%93%E5%88%97%E8%A1%A8"><span class="toc-text">展示频道列表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8"><span class="toc-text">文章列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E7%BB%84%E4%BB%B6"><span class="toc-text">文章列表组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E7%BB%84%E4%BB%B6%E5%B8%83%E5%B1%80"><span class="toc-text">文章列表组件布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8"><span class="toc-text">加载文章列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0"><span class="toc-text">下拉刷新</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B7%E5%BC%8F%E8%B0%83%E6%95%B4"><span class="toc-text">样式调整</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E9%A6%96%E9%A1%B5%E2%80%94%E9%A2%91%E9%81%93%E7%BC%96%E8%BE%91"><span class="toc-text">七、首页—频道编辑</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87-2"><span class="toc-text">准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%B9%E5%87%BA%E5%B1%82%E7%BB%84%E4%BB%B6"><span class="toc-text">弹出层组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%87%BB%E9%9D%A2%E5%8C%85%E6%8C%89%E9%92%AE%E5%B1%95%E7%A4%BA%E5%BC%B9%E5%87%BA%E5%B1%82"><span class="toc-text">点击面包按钮展示弹出层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%91%E9%81%93%E7%BC%96%E8%BE%91%E7%BB%84%E4%BB%B6"><span class="toc-text">频道编辑组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E5%B8%83%E5%B1%80"><span class="toc-text">组件布局</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E6%88%91%E7%9A%84%E9%A2%91%E9%81%93"><span class="toc-text">展示我的频道</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E6%8E%A8%E8%8D%90%E9%A2%91%E9%81%93%E5%88%97%E8%A1%A8"><span class="toc-text">展示推荐频道列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E9%A2%91%E9%81%93"><span class="toc-text">获取所有频道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E8%8E%B7%E5%8F%96%E5%B1%95%E7%A4%BA%E5%89%A9%E4%BD%99%E6%8E%A8%E8%8D%90%E9%A2%91%E9%81%93"><span class="toc-text">处理获取展示剩余推荐频道</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E9%A2%91%E9%81%93"><span class="toc-text">添加频道</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E9%A2%91%E9%81%93"><span class="toc-text">编辑频道</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E7%BC%96%E8%BE%91%E7%8A%B6%E6%80%81"><span class="toc-text">处理编辑状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%A2%91%E9%81%93"><span class="toc-text">删除频道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E9%A2%91%E9%81%93"><span class="toc-text">切换频道</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%91%E9%81%93%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">频道数据持久化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E6%96%87%E7%AB%A0%E6%90%9C%E7%B4%A2"><span class="toc-text">八、文章搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87-3"><span class="toc-text">准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BB%84%E4%BB%B6%E5%B9%B6%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1-1"><span class="toc-text">创建组件并配置路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80-1"><span class="toc-text">页面布局</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86-%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95-%E8%81%94%E6%83%B3%E5%BB%BA%E8%AE%AE-%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C-%E6%98%BE%E7%A4%BA%E7%8A%B6%E6%80%81"><span class="toc-text">处理(历史记录&#x2F;联想建议&#x2F;搜索结果)显示状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E8%81%94%E6%83%B3%E5%BB%BA%E8%AE%AE"><span class="toc-text">搜索联想建议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%85%B3%E9%94%AE%E5%AD%97%E9%AB%98%E4%BA%AE"><span class="toc-text">搜索关键字高亮</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E6%8A%96%E5%A4%84%E7%90%86%EF%BC%88%E6%9C%80%E5%90%8E%E5%A4%84%E7%90%86%EF%BC%89"><span class="toc-text">防抖处理（最后处理）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C"><span class="toc-text">搜索结果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95"><span class="toc-text">搜索历史记录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95"><span class="toc-text">添加历史记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95"><span class="toc-text">展示历史记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95"><span class="toc-text">删除历史记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">数据持久化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%EF%BC%9A%E5%87%BD%E6%95%B0%E9%98%B2%E6%8A%96%E5%92%8C%E5%87%BD%E6%95%B0%E8%8A%82%E6%B5%81"><span class="toc-text">扩展：函数防抖和函数节流</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E9%98%B2%E6%8A%96%EF%BC%88Debounce%EF%BC%89"><span class="toc-text">函数防抖（Debounce）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E9%98%B2%E6%8A%96%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-text">函数防抖实现原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%8A%82%E6%B5%81%EF%BC%88Throttle%EF%BC%89"><span class="toc-text">函数节流（Throttle）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%8A%82%E6%B5%81%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-text">函数节流实现原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%8A%82%E6%B5%81%E6%88%96%E8%80%85%E9%98%B2%E6%8A%96%E7%9A%84%E7%9B%B8%E5%85%B3%E5%9C%BA%E6%99%AF"><span class="toc-text">函数节流或者防抖的相关场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%EF%BC%9Alodash-%E5%87%BD%E6%95%B0%E5%BA%93"><span class="toc-text">扩展：lodash 函数库</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E6%96%87%E7%AB%A0%E8%AF%A6%E6%83%85"><span class="toc-text">九、文章详情</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87-4"><span class="toc-text">准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BB%84%E4%BB%B6%E5%B9%B6%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1-2"><span class="toc-text">创建组件并配置路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B1%80-1"><span class="toc-text">布局</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2-loading-%E7%BB%84%E4%BB%B6"><span class="toc-text">页面 loading 组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E9%94%99%E8%AF%AF%E7%BB%84%E4%BB%B6"><span class="toc-text">页面错误组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E9%A2%84%E8%A7%88"><span class="toc-text">图片预览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E6%96%87%E7%AB%A0%E8%AF%A6%E6%83%85"><span class="toc-text">展示文章详情</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E6%94%B6%E8%97%8F"><span class="toc-text">文章收藏</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E7%82%B9%E8%B5%9E"><span class="toc-text">文章点赞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E6%B3%A8%E7%94%A8%E6%88%B7"><span class="toc-text">关注用户</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%B8%8D%E8%83%BD%E5%85%B3%E6%B3%A8%E8%87%AA%E5%B7%B1"><span class="toc-text">用户不能关注自己</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E6%B3%A8-%E5%8F%96%E6%B6%88%E5%85%B3%E6%B3%A8"><span class="toc-text">关注|取消关注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-text">日期格式化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA"><span class="toc-text">十、文章评论</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA"><span class="toc-text">文章评论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA%E7%BB%84%E4%BB%B6"><span class="toc-text">准备文章评论组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA%E5%88%97%E8%A1%A8"><span class="toc-text">展示文章评论列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA%E9%A1%B9%E7%BB%84%E4%BB%B6"><span class="toc-text">文章评论项组件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA"><span class="toc-text">发布文章评论</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E7%BB%84%E4%BB%B6"><span class="toc-text">发布组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA-1"><span class="toc-text">发布文章评论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA-2"><span class="toc-text">发布文章评论</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA%E7%82%B9%E8%B5%9E"><span class="toc-text">文章评论点赞</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%84%E8%AE%BA%E5%9B%9E%E5%A4%8D"><span class="toc-text">评论回复</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E5%9B%9E%E5%A4%8D%E5%BC%B9%E5%B1%82"><span class="toc-text">展示回复弹层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B1%80-2"><span class="toc-text">布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E7%82%B9%E5%87%BB%E5%9B%9E%E5%A4%8D%E7%9A%84%E5%BD%93%E5%89%8D%E8%AF%84%E8%AE%BA"><span class="toc-text">展示点击回复的当前评论</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E8%AF%84%E8%AE%BA%E5%9B%9E%E5%A4%8D%E5%88%97%E8%A1%A8"><span class="toc-text">展示评论回复列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E5%BC%B9%E5%B1%82%E4%B8%AD%E7%BB%84%E4%BB%B6%E5%86%85%E5%AE%B9%E4%B8%8D%E6%9B%B4%E6%96%B0%E9%97%AE%E9%A2%98"><span class="toc-text">解决弹层中组件内容不更新问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E8%AF%84%E8%AE%BA%E5%9B%9E%E5%A4%8D%E7%BB%84%E4%BB%B6%E4%B8%AD%E5%85%B3%E9%97%AD%E5%BC%B9%E5%B1%82"><span class="toc-text">在评论回复组件中关闭弹层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E5%9B%9E%E5%A4%8D"><span class="toc-text">发布回复</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E7%BC%96%E8%BE%91%E7%94%A8%E6%88%B7%E8%B5%84%E6%96%99"><span class="toc-text">十一、编辑用户资料</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87-5"><span class="toc-text">准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BB%84%E4%BB%B6%E5%B9%B6%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1-3"><span class="toc-text">创建组件并配置路由</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E7%94%A8%E6%88%B7%E8%B5%84%E6%96%99"><span class="toc-text">展示用户资料</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%A4%B4%E5%83%8F"><span class="toc-text">修改头像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%87%BB%E9%80%89%E6%8B%A9%E6%96%87%E4%BB%B6"><span class="toc-text">点击选择文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E9%A2%84%E8%A7%88"><span class="toc-text">图片上传预览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E6%9B%B4%E6%96%B0"><span class="toc-text">保存更新</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%98%B5%E7%A7%B0"><span class="toc-text">修改昵称</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B1%80-3"><span class="toc-text">布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0"><span class="toc-text">更新</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%80%A7%E5%88%AB"><span class="toc-text">修改性别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%94%9F%E6%97%A5"><span class="toc-text">修改生日</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E6%88%91%E7%9A%84%E6%94%B6%E8%97%8F-%E5%8E%86%E5%8F%B2-%E4%BD%9C%E5%93%81"><span class="toc-text">十二、我的收藏&#x2F;历史&#x2F;作品</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87-6"><span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%91%E7%9A%84%E6%94%B6%E8%97%8F"><span class="toc-text">我的收藏</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%91%E7%9A%84%E5%8E%86%E5%8F%B2"><span class="toc-text">我的历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%91%E7%9A%84%E4%BD%9C%E5%93%81"><span class="toc-text">我的作品</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81%E5%B0%8F%E6%99%BA%E5%90%8C%E5%AD%A6"><span class="toc-text">十三、小智同学</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WebSocket"><span class="toc-text">WebSocket</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%94%9F-WebSocket%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89"><span class="toc-text">使用原生 WebSocket（了解）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Socket-IO%EF%BC%88%E4%BA%86%E8%A7%A3%E4%BD%93%E9%AA%8C%EF%BC%89"><span class="toc-text">Socket.IO（了解体验）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8-1"><span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%EF%BC%9Angrok-%E4%BB%A3%E7%90%86"><span class="toc-text">扩展：ngrok 代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E6%99%BA%E5%90%8C%E5%AD%A6"><span class="toc-text">小智同学</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87-7"><span class="toc-text">准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B1%80-4"><span class="toc-text">布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5"><span class="toc-text">建立连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B6%E5%8F%91%E6%B6%88%E6%81%AF"><span class="toc-text">收发消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E6%B6%88%E6%81%AF%E5%88%97%E8%A1%A8"><span class="toc-text">展示消息列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96-1"><span class="toc-text">数据持久化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E5%88%97%E8%A1%A8%E8%87%AA%E5%8A%A8%E6%BB%9A%E5%8A%A8%E5%88%B0%E5%BA%95%E9%83%A8"><span class="toc-text">消息列表自动滚动到底部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nextTick-%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-text">$nextTick 的作用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81%E5%8A%9F%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-text">十四、功能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86-token-%E8%BF%87%E6%9C%9F"><span class="toc-text">处理 token 过期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F%E8%B7%B3%E8%BD%AC%E5%9B%9E%E5%8E%9F%E6%9D%A5%E9%A1%B5%E9%9D%A2"><span class="toc-text">登录成功跳转回原来页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E7%BC%93%E5%AD%98"><span class="toc-text">组件缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%81%E7%94%A8%E7%BB%84%E4%BB%B6%E7%BC%93%E5%AD%98"><span class="toc-text">禁用组件缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E7%BC%93%E5%AD%98"><span class="toc-text">动态缓存</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%BA%94%E3%80%81%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83"><span class="toc-text">十五、打包发布</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E6%89%93%E5%8C%85"><span class="toc-text">构建打包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%89%93%E5%8C%85%E7%BB%93%E6%9E%9C"><span class="toc-text">测试打包结果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2"><span class="toc-text">部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%EF%BC%9AGitHub-Pages"><span class="toc-text">扩展：GitHub Pages</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GitHub-Pages"><span class="toc-text">GitHub Pages</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2-Vue-%E9%A1%B9%E7%9B%AE%E5%88%B0-GitHub-Pages"><span class="toc-text">部署 Vue 项目到 GitHub Pages</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E5%90%88-GitHub-Actions-%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2-Vue-%E9%A1%B9%E7%9B%AE"><span class="toc-text">结合 GitHub Actions 自动部署 Vue 项目</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E5%85%AD%E3%80%81Vue-%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E4%BC%98%E5%8C%96"><span class="toc-text">十六、Vue 项目构建优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%8A-VueCLI-%E5%8D%87%E7%BA%A7%E5%88%B0%E6%9C%80%E6%96%B0%E7%A8%B3%E5%AE%9A%E7%89%88"><span class="toc-text">把 VueCLI 升级到最新稳定版</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E6%89%93%E5%8C%85%E7%BB%93%E6%9E%9C"><span class="toc-text">分析打包结果</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#vue-cli-service-build"><span class="toc-text">vue-cli-service build</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2%E6%89%93%E5%8C%85"><span class="toc-text">使用图形界面打包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gzip-%E5%8E%8B%E7%BC%A9"><span class="toc-text">Gzip 压缩</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Gzip-%E5%8E%8B%E7%BC%A9%E5%8E%9F%E7%90%86"><span class="toc-text">Gzip 压缩原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8-Vue-CLI-%E4%B8%AD%E8%87%AA%E5%AE%9A%E4%B9%89-webpack-%E9%85%8D%E7%BD%AE"><span class="toc-text">在 Vue CLI 中自定义 webpack 配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CDN"><span class="toc-text">CDN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="toc-text">路由懒加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E7%BB%84%E4%BB%B6"><span class="toc-text">异步组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#prefetch"><span class="toc-text">prefetch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD%E7%AC%AC%E4%B8%89%E6%96%B9%E7%BB%84%E4%BB%B6"><span class="toc-text">按需加载第三方组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E5%92%8C%E5%B9%B6%E8%A1%8C%E5%A4%84%E7%90%86"><span class="toc-text">缓存和并行处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-text">参考链接</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%83%E3%80%81%E7%A7%BB%E5%8A%A8-App-%E5%BC%80%E5%8F%91"><span class="toc-text">十七、移动 App 开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8-App-%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-text">移动 App 开发相关概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%EF%BC%88DCloud-HTML5-App%EF%BC%89"><span class="toc-text">混合应用开发（DCloud HTML5+ App）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-HBuilder"><span class="toc-text">安装 HBuilder</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hello-World"><span class="toc-text">Hello World</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-text">创建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95%E8%BF%90%E8%A1%8C"><span class="toc-text">真机调试运行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Android"><span class="toc-text">Android</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#iOS"><span class="toc-text">iOS</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE-HTML5-API"><span class="toc-text">访问 HTML5 + API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83"><span class="toc-text">打包发布</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-manifest"><span class="toc-text">配置 manifest</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%93%E5%8C%85"><span class="toc-text">打包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E5%B8%83"><span class="toc-text">发布</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Vue-js-%E5%BC%80%E5%8F%91-HTML5-App"><span class="toc-text">使用 Vue.js 开发 HTML5+ App</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83-1"><span class="toc-text">打包发布</span></a></li></ol></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="一、项目初始化"><a href="#一、项目初始化" class="headerlink" title="一、项目初始化"></a>一、项目初始化</h1><h2 id="使用-Vue-CLI-创建项目"><a href="#使用-Vue-CLI-创建项目" class="headerlink" title="使用 Vue CLI 创建项目"></a>使用 Vue CLI 创建项目</h2><blockquote>
<p>提示：该项目基于 VueCLI 版本 4 创建，如果你的版本低于 4，请升级继续下面的内容。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 VueCLI 版本号</span></span><br><span class="line">vue --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># npm 安装升级</span></span><br><span class="line">npm install @vue/cli</span><br><span class="line"></span><br><span class="line"><span class="comment"># Yarn 安装升级</span></span><br><span class="line">yarn global add @vue/cli</span><br></pre></td></tr></table></figure>
</blockquote>
<p>在命令行中输入以下命令创建 Vue 项目：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue create vue-toutiao-webapp</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Vue CLI v4.1.2</span><br><span class="line">? Please pick a preset:</span><br><span class="line">  default (babel, eslint)</span><br><span class="line">&gt; Manually select features</span><br></pre></td></tr></table></figure>

<blockquote>
<p>default：默认勾选 babel、eslint，回车之后直接进入装包</p>
<p>manually：自定义勾选特性配置，选择完毕之后，才会进入装包</p>
<p>选择第 2 种：手动选择特性，支持更多自定义选项</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">? Please pick a preset: Manually select features</span><br><span class="line">? Check the features needed for your project:</span><br><span class="line"> (*) Babel</span><br><span class="line"> ( ) TypeScript</span><br><span class="line"> ( ) Progressive Web App (PWA) Support</span><br><span class="line"> (*) Router</span><br><span class="line"> (*) Vuex</span><br><span class="line"> (*) CSS Pre-processors</span><br><span class="line">&gt;(*) Linter &#x2F; Formatter</span><br><span class="line"> ( ) Unit Testing</span><br><span class="line"> ( ) E2E Testing</span><br></pre></td></tr></table></figure>

<blockquote>
<p>分别选择：</p>
<p>Babel：es6 转 es5</p>
<p>Router：路由</p>
<p>Vuex：数据容器，存储共享数据</p>
<p>CSS Pre-processors：CSS 预处理器，后面会提示你选择 less、sass、stylus 等</p>
<p>Linter / Formatter：代码格式校验</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">? Use history mode for router? (Requires proper server setup for index fallback in production) (Y&#x2F;n) n</span><br></pre></td></tr></table></figure>

<blockquote>
<p>是否使用 history 路由模式，这里输入 n 不使用</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default):</span><br><span class="line">  Sass&#x2F;SCSS (with dart-sass)</span><br><span class="line">  Sass&#x2F;SCSS (with node-sass)</span><br><span class="line">&gt; Less</span><br><span class="line">  Stylus</span><br></pre></td></tr></table></figure>

<blockquote>
<p>选择 CSS 预处理器，这里选择我们熟悉的 Less</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">? Pick a linter / formatter config:</span><br><span class="line">  ESLint with error prevention only</span><br><span class="line">  ESLint + Airbnb config</span><br><span class="line">&gt; ESLint + Standard config</span><br><span class="line">  ESLint + Prettier</span><br></pre></td></tr></table></figure>

<blockquote>
<p>选择校验工具，这里选择 ESLint + <a target="_blank" rel="noopener" href="https://standardjs.com/">Standard config</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">? Pick additional lint features:</span><br><span class="line"> (*) Lint on save</span><br><span class="line">&gt;(*) Lint and fix on commit</span><br></pre></td></tr></table></figure>

<blockquote>
<p>选择在什么时机下触发代码格式校验：</p>
<ul>
<li>Lint on save：每当保存文件的时候</li>
<li>Lint and fix on commit：每当执行 <code>git commit</code> 提交的时候</li>
</ul>
<p>这里建议两个都选上，更严谨。</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">? Where <span class="keyword">do</span> you prefer placing config <span class="keyword">for</span> Babel, ESLint, etc.? (Use arrow keys)</span><br><span class="line">&gt; In dedicated config files</span><br><span class="line">  In package.json</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Babel、ESLint 等工具会有一些额外的配置文件，这里的意思是问你将这些工具相关的配置文件写到哪里：</p>
<ul>
<li>In dedicated config files：分别保存到单独的配置文件</li>
<li>In package.json：保存到 package.json 文件中</li>
</ul>
<p>这里建议选择第 1 个，保存到单独的配置文件，这样方便我们做自定义配置。</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">? Save this as a preset <span class="keyword">for</span> future projects? (y/N) N</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里是问你是否需要将刚才选择的一系列配置保存起来，然后它可以帮你记住上面的一系列选择，以便下次直接重用。</p>
<p>这里根据自己需要输入 y 或者 n，我这里输入 n 不需要。</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">✨  Creating project <span class="keyword">in</span> C:\Users\LPZ\Desktop\topline-m-fe89\topline-m-89.</span><br><span class="line">�  Initializing git repository...</span><br><span class="line">⚙  Installing CLI plugins. This might take a <span class="keyword">while</span>...</span><br><span class="line"></span><br><span class="line">[          ........] - extract:object-keys: sill extract json5@2.1.1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>向导配置结束，开始装包。</p>
<p>安装包的时间可能较长，请耐心等待……</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">⚓  Running completion hooks...</span><br><span class="line"></span><br><span class="line">�  Generating README.md...</span><br><span class="line"></span><br><span class="line">�  Successfully created project topline-m-89.</span><br><span class="line">�  Get started with the following commands:</span><br><span class="line"></span><br><span class="line"> $ <span class="built_in">cd</span> topline-m</span><br><span class="line"> $ npm run serve</span><br></pre></td></tr></table></figure>

<blockquote>
<p>安装结束，命令提示你项目创建成功，按照命令行的提示在终端中分别输入：</p>
<ul>
<li><code>cd 你的项目</code></li>
<li><code>npm run serve</code><ul>
<li>如果你是 yarn 装的包就执行 <code>yarn serve</code></li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DONE  Compiled successfully <span class="keyword">in</span> 7527ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> App running at:</span><br><span class="line"> - Local:   http://localhost:8080/</span><br><span class="line"> - Network: http://192.168.10.216:8080/</span><br><span class="line"></span><br><span class="line"> Note that the development build is not optimized.</span><br><span class="line"> To create a production build, run npm run build.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>启动成功，命令行中输出项目的 http 访问地址。</p>
<p>打开浏览器，输入其中任何一个地址进行访问。</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/image-20200105001849854.png" class="">

<p>如果能看到该页面，恭喜你，项目创建成功了。</p>
<h2 id="初始目录结构说明"><a href="#初始目录结构说明" class="headerlink" title="初始目录结构说明"></a>初始目录结构说明</h2><p>项目创建好以后，下面我们来了解一下目录结构的含义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── .browserslistrc</span><br><span class="line">├── .editorconfig</span><br><span class="line">├── .eslintrc.js</span><br><span class="line">├── .gitignore</span><br><span class="line">├── README.md</span><br><span class="line">├── babel.config.js</span><br><span class="line">├── package-lock.json</span><br><span class="line">├── package.json</span><br><span class="line">├── public</span><br><span class="line">│   ├── favicon.ico</span><br><span class="line">│   └── index.html</span><br><span class="line">└── src</span><br><span class="line">    ├── App.vue       根组件</span><br><span class="line">    ├── assets        资源目录</span><br><span class="line">    ├── components    公共组件</span><br><span class="line">    ├── main.js       入口模块</span><br><span class="line">    ├── router        路由</span><br><span class="line">    ├── store         Vuex容器</span><br><span class="line">    └── views         路由组件</span><br></pre></td></tr></table></figure>

<blockquote>
<p>关于 <code>lock</code> 文件</p>
<ul>
<li>如果你的项目使用的是 npm，则这里产生的是 <code>package-lock.json</code> 文件</li>
<li>如果你的项目使用的 yarn，则这里生产的是 <code>yarn.lock</code> 文件</li>
</ul>
</blockquote>
<h2 id="加入-Git-版本管理"><a href="#加入-Git-版本管理" class="headerlink" title="加入 Git 版本管理"></a>加入 Git 版本管理</h2><p>几个好处：</p>
<ul>
<li>代码备份</li>
<li>多人协作</li>
<li>历史记录</li>
</ul>
<p>1、创建远程仓库（github、码云、coding。。。）</p>
<p>2、将本地仓库推到线上</p>
<p>正常的话我们需要创建 Git 仓库并提交历史记录。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git add 文件</span><br><span class="line">git commit <span class="string">&quot;提交日志&quot;</span></span><br></pre></td></tr></table></figure>

<p>但是 Vue CLI 在生成项目的时候默认完成了 Git 仓库的初始化和初始提交，所以这里只需要 push 到线上即可。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote add 你的远程仓库地址</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>

<p>之后如果需要提交，则还是常规的 add、commit、push。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add 文件</span><br><span class="line">git commit -m <span class="string">&quot;提交日志&quot;</span></span><br><span class="line">git push</span><br></pre></td></tr></table></figure>

<h2 id="调整初始目录结构"><a href="#调整初始目录结构" class="headerlink" title="调整初始目录结构"></a>调整初始目录结构</h2><p>默认生成的目录结构不满足我们的开发需求，所以这里需要做一些自定义改动。</p>
<p>这里主要就是下面的两个工作：</p>
<ul>
<li>删除初始化的默认文件</li>
<li>新增调整我们需要的目录结构</li>
</ul>
<p>1、将 <code>App.vue</code> 修改为</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 根路由出口 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;App&#x27;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、将 <code>router/index.js</code> 修改为</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、删除</p>
<ul>
<li>src/views/About.vue</li>
<li>src/views/Home.vue</li>
<li>src/components/HelloWorld.vue</li>
<li>src/assets/logo.png</li>
</ul>
<p>4、创建以下几个目录</p>
<ul>
<li>src/api<ul>
<li>存储接口封装</li>
</ul>
</li>
<li>src/utils<ul>
<li>存储一些工具模块</li>
</ul>
</li>
<li>src/styles<ul>
<li>存储样式</li>
</ul>
</li>
</ul>
<p>调整之后的目录结构如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.                                 </span><br><span class="line">├── README.md                     </span><br><span class="line">├── babel.config.js               </span><br><span class="line">├── package-lock.json             </span><br><span class="line">├── package.json                  </span><br><span class="line">├── public                        </span><br><span class="line">│   ├── favicon.ico               </span><br><span class="line">│   └── index.html                </span><br><span class="line">└── src                           </span><br><span class="line">    ├── api</span><br><span class="line">    ├── App.vue                   </span><br><span class="line">    ├── assets                    </span><br><span class="line">    ├── components                </span><br><span class="line">    ├── main.js                   </span><br><span class="line">    ├── router</span><br><span class="line">    ├── utils</span><br><span class="line">    ├── styles</span><br><span class="line">    ├── store                     </span><br><span class="line">    └── views                     </span><br></pre></td></tr></table></figure>

<h2 id="导入-Vant"><a href="#导入-Vant" class="headerlink" title="导入 Vant"></a>导入 Vant</h2><h3 id="Vant-介绍"><a href="#Vant-介绍" class="headerlink" title="Vant 介绍"></a>Vant 介绍</h3><img src="https://yhx0507.github.io/wxapp_static/app/logo.png" class="">

<ul>
<li><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/">官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/youzan/vant">GitHub 仓库</a></li>
</ul>
<p>Vant 是杭州有赞商城前端开发团队开发的一个基于 Vue.js 的移动端组件库，它提供了丰富的常见的移动端功能组件，开箱即用。</p>
<ul>
<li>60+ 高质量组件</li>
<li>90% 单元测试覆盖率</li>
<li>完善的中英文文档和示例</li>
<li>支持按需引入</li>
<li>支持主题定制</li>
<li>支持国际化</li>
<li>支持 TS</li>
<li>支持 SSR</li>
</ul>
<h3 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h3><p>方式一. 自动按需引入组件</p>
<ul>
<li>和方式二一样，都是按需引入，但是加载更方便一些（需要额外配置插件）</li>
<li>优点：打包体积小</li>
<li>缺点：每个组件在使用之前都需要手动加载注册</li>
</ul>
<p>方式二. 手动按需引入组件</p>
<ul>
<li>在不使用插件的情况下，可以手动引入需要的组件</li>
<li>优点：打包体积小</li>
<li>缺点：每个组件在使用之前都需要手动加载注册</li>
</ul>
<p>方式三. 导入所有组件</p>
<ul>
<li>Vant 支持一次性导入所有组件，引入所有组件会增加代码包体积，因此不推荐这种做法</li>
<li>优点：导入一次，使用所有</li>
<li>缺点：打包体积大</li>
</ul>
<p>方式四. 通过 CDN 引入</p>
<ul>
<li>使用 Vant 最简单的方法是直接在 html 文件中引入 CDN 链接，之后你可以通过全局变量<code>vant</code>访问到所有组件。</li>
<li>优点：适合一些演示、示例项目，一个 html 文件就可以跑起来</li>
<li>缺点：不适合在模块化系统中使用</li>
</ul>
<p>这里建议为了前期开发的便利性先一次性导入所有 Vant 组件，在最后做打包优化的时候配置按需加载以降低打包体积大小。</p>
<p>下面是具体的操作步骤。</p>
<p>1、安装 Vant</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vant -S</span><br></pre></td></tr></table></figure>

<p>2、在 <code>main.js</code> 中加载注册 Vant 组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vant <span class="keyword">from</span> <span class="string">&#x27;vant&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;vant/lib/index.css&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vant)</span><br></pre></td></tr></table></figure>

<p>3、查阅文档使用组件</p>
<h2 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h2><h3 id="预处理器文件结构"><a href="#预处理器文件结构" class="headerlink" title="预处理器文件结构"></a>预处理器文件结构</h3><p>在 styles 中创建以下文件结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">styles&#x2F;</span><br><span class="line">  ├── base.less       公共基础样式（全局样式）</span><br><span class="line">  ├── index.less      组织加载全局样式</span><br><span class="line">  ├── mixins.less     公共的 mixin（哪里使用哪里加载）</span><br><span class="line">  ├── reset.less      重置默认样式（全局样式）</span><br><span class="line">  └── variables.less  公共变量文件（哪里使用哪里加载）</span><br></pre></td></tr></table></figure>

<p>然后在 <code>main.js</code> 中加载全局样式使其生效：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载全局样式</span></span><br><span class="line"><span class="comment">// 注意：该样式文件要放到第三方样式之后</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./styles/index.less&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="normalize-css"><a href="#normalize-css" class="headerlink" title="normalize.css"></a>normalize.css</h3><p>​    <a target="_blank" rel="noopener" href="http://necolas.github.io/normalize.css/">Normalize.css</a> 只是一个很小的CSS文件，但它在默认的HTML元素样式上提供了跨浏览器的高度一致性。相比于传统的<code>CSS reset</code>，<code>Normalize.css</code>是一种现代的、为HTML5准备的优质替代方案。<code>Normalize.css</code>现在已经被用于<a target="_blank" rel="noopener" href="http://getbootstrap.com/">Twitter Bootstrap</a>、<a target="_blank" rel="noopener" href="http://html5boilerplate.com/">HTML5 Boilerplate</a>、<a target="_blank" rel="noopener" href="http://www.gov.uk/">GOV.UK</a>、<a target="_blank" rel="noopener" href="http://www.rdio.com/">Rdio</a>、<a target="_blank" rel="noopener" href="http://css-tricks.com/">CSS Tricks</a> 以及许许多多其他框架、工具和网站上。</p>
<ul>
<li><strong>保护有用的浏览器默认样式</strong>而不是完全去掉它们</li>
<li><strong>一般化的样式</strong>：为大部分HTML元素提供</li>
<li><strong>修复浏览器自身的bug</strong>并保证各浏览器的一致性</li>
<li><strong>优化CSS可用性</strong>：用一些小技巧</li>
<li><strong>解释代码</strong>：用注释和详细的文档来</li>
</ul>
<p><code>Normalize.css</code>支持包括手机浏览器在内的超多浏览器，同时对HTML5元素、排版、列表、嵌入的内容、表单和表格都进行了一般化。尽管这个项目基于一般化的原则，但我们还是在合适的地方使用了更实用的默认值。</p>
<p>1、安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i normalize.css</span><br></pre></td></tr></table></figure>

<p>2、在 <code>main.js</code> 中引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;normalize.css&#x27;</span></span><br></pre></td></tr></table></figure>

<p>但是我们的项目不需要加载它，不是不需要，因为我们使用了第三方组件库 Vant，它内置了 normalize.css，所以我们不需要自己手动安装配置它了。</p>
<h3 id="关于字体图标"><a href="#关于字体图标" class="headerlink" title="关于字体图标"></a>关于字体图标</h3><p>Vant 内置了很多丰富的<a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/icon">字体图标</a>，如果其中没有满足我们需要的，推荐使用 <a target="_blank" rel="noopener" href="https://www.iconfont.cn/">iconfont</a>。</p>
<h3 id="配置-REM-适配"><a href="#配置-REM-适配" class="headerlink" title="配置 REM 适配"></a>配置 REM 适配</h3><p>Vant 中的样式默认使用 <code>px</code> 作为单位，如果需要使用 <code>rem</code> 单位，推荐使用以下两个工具：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/cuth/postcss-pxtorem">postcss-pxtorem</a> 是一款 postcss 插件，用于将单位转化为 rem</li>
<li><a target="_blank" rel="noopener" href="https://github.com/amfe/lib-flexible">lib-flexible</a> 用于设置 rem 基准值</li>
</ul>
<p>下面我们分别将这两个工具配置到项目中完成 REM 适配。</p>
<p>一、使用 <a target="_blank" rel="noopener" href="https://github.com/amfe/lib-flexible">amfe-flexible</a> 动态设置 REM 基准值（html 标签的字体大小）</p>
<p>1、安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yarn add amfe-flexible</span></span><br><span class="line">npm i amfe-flexible</span><br></pre></td></tr></table></figure>

<p>2、然后在 <code>main.js</code> 中加载执行该模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;amfe-flexible&#x27;</span></span><br></pre></td></tr></table></figure>

<p>最后测试：在浏览器中切换不同的手机设备尺寸，观察 html 标签 <code>font-size</code> 的变化。</p>
<p>二、使用 <a target="_blank" rel="noopener" href="https://github.com/cuth/postcss-pxtorem">postcss-pxtorem</a> 将 px 转为 rem</p>
<p>1、安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yarn add -D postcss-pxtorem</span></span><br><span class="line"><span class="comment"># -D 是 --save-dev 的简写</span></span><br><span class="line">npm install postcss-pxtorem -D</span><br></pre></td></tr></table></figure>

<p>2、然后在<strong>项目根目录</strong>中创建 <code>postcss.config.js</code> 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: &#123;</span><br><span class="line">    <span class="string">&quot;postcss-pxtorem&quot;</span>: &#123;</span><br><span class="line">      <span class="comment">// 设计稿 375:37.5</span></span><br><span class="line">      <span class="comment">// 设计稿：750:75</span></span><br><span class="line">      <span class="comment">// Vant 是基于 375</span></span><br><span class="line">      rootValue: <span class="number">37.5</span>,</span><br><span class="line">      propList: [<span class="string">&quot;*&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、<strong>配置完毕，重新启动服务</strong></p>
<p>最后测试：在浏览器中审查元素的样式查看是否已将 px 转换为 rem。</p>
<blockquote>
<p>注意：</p>
<ul>
<li><strong>只能转换单独的 .css|.less|.scss 之类的文件、.vue 文件中的 style 中的 px</strong></li>
<li><strong>不能转换行内样式中的 px</strong></li>
</ul>
</blockquote>
<h3 id="关于设计稿的使用"><a href="#关于设计稿的使用" class="headerlink" title="关于设计稿的使用"></a>关于设计稿的使用</h3><p>Vant 的组件是基于 375 宽写的，而我们的设计稿是 750 宽，这样的话转换规则就出现了冲突。</p>
<p>解决办法就是把我们应该将就 Vant，将转换规则中的 <code>rootValue</code> 设置为 <code>37.5</code>。</p>
<p>之后在测量我们的设计稿的时候，就需要通过下面的方式来处理使用。</p>
<p>方式一：</p>
<ul>
<li>如果你的设计稿 375，写的时候就是量多少写多少</li>
<li>如果你的设计稿 750，写的时候就是测量尺寸 ÷ 2</li>
</ul>
<p>方式二（扩展）：</p>
<ul>
<li>在 Photoshop 中把设计稿图像尺寸修改为 375，测量多少写多少</li>
<li>有个缺点：它也会把图片转为 375 下的，会导致模糊</li>
<li>如果你真的想要这样做，那就是 750 把图片切出来，然后在 375 下量尺寸（不用/2）</li>
</ul>
<h2 id="封装请求模块"><a href="#封装请求模块" class="headerlink" title="封装请求模块"></a>封装请求模块</h2><p>这里我们直接把 axios 封装为一个请求模块，在需要的时候直接加载使用。</p>
<h3 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h3><p>1、安装 axios</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yarn add axios</span></span><br><span class="line">npm i axios</span><br></pre></td></tr></table></figure>

<p>2、创建 <code>src/utils/request.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装 axios 请求模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// axios.create 方法：复制一个 axios</span></span><br><span class="line"><span class="keyword">const</span> request = axios.create(&#123;</span><br><span class="line">  baseURL: <span class="string">&quot;http://ttapi.research.itcast.cn/&quot;</span> <span class="comment">// 基础路径</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request</span><br></pre></td></tr></table></figure>

<p>3、如何使用</p>
<ul>
<li>方式一（麻烦）：哪里使用，哪里 <code>import </code>加载</li>
<li>方式二（不利于接口维护）：我们可以把请求对象挂载到 <code>Vue.prototype</code> 原型对象中，然后在组件中通过 <code>this.xxx</code> 直接访问</li>
<li>方式三（推荐）：我们把每一个请求都封装成一个一个的独立功能函数，在需要的时候加载调用即可</li>
</ul>
<p>在我们的项目中建议使用方式三，更推荐。</p>
<h3 id="处理后端返回数据中包含超出-JS-安全整数范围数字问题"><a href="#处理后端返回数据中包含超出-JS-安全整数范围数字问题" class="headerlink" title="处理后端返回数据中包含超出 JS 安全整数范围数字问题"></a>处理后端返回数据中包含超出 JS 安全整数范围数字问题</h3><p>JavaScript 中可以处理的最大安全整数范围是</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>.MAX_SAFE_INTEGER <span class="comment">// 9007199254740991</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.parse(<span class="string">&#x27;&#123; &quot;id&quot;: 9007199254740995 &#125;&#x27;</span>) <span class="comment">// &#123; id: 9007199254740996 &#125;</span></span><br></pre></td></tr></table></figure>

<p>该项目所使用的后端接口数据中包含超出 JavaScript 安全整数范围的数字，所以也需要像之前的 PC 端项目一样使用 <a target="_blank" rel="noopener" href="https://github.com/sidorares/json-bigint">json-bigint</a> 将后端返回数据处理一下才能正确使用。</p>
<p>1、安装依赖</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yarn add json-bigint</span></span><br><span class="line">npm i json-bigint</span><br></pre></td></tr></table></figure>

<p>2、在 <code>utils/request.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jsonBig <span class="keyword">from</span> <span class="string">&#x27;json-bigint&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// axios 开放了自定义转换后端返回数据的 API</span></span><br><span class="line"><span class="comment">// data 就是后端返回的原始数据</span></span><br><span class="line">request.defaults.transformResponse = [<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 现在我们定制使用 json-bigint 来帮我们处理转换原始的 JSON 格式字符串</span></span><br><span class="line">    <span class="comment">// 这个方法类似于 JSON.parse，只不过它能把数据中的超出 JS 安全整数范围的数字给处理成正确的</span></span><br><span class="line">    <span class="comment">// 它内部有自己的算法，它会把大数字转为一个对象，我们在使用的时候把对象.toString() 就得到字符串形式的 id 了</span></span><br><span class="line">    <span class="comment">// 如果转换成功则返回成功的结果给请求使用</span></span><br><span class="line">    <span class="comment">// 如果转换失败则进入 catch，返回一个空对象</span></span><br><span class="line">    <span class="keyword">return</span> jsonBig.parse(data)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 它默认是这样的</span></span><br><span class="line">    <span class="comment">// return JSON.parse(data)</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;转换失败&#x27;</span>, err)</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>

<h1 id="二、用户登录注册"><a href="#二、用户登录注册" class="headerlink" title="二、用户登录注册"></a>二、用户登录注册</h1><blockquote>
<p>目标</p>
<ul>
<li>能实现基本登录功能</li>
<li>能了解 vant 中提示组件的使用</li>
<li>能理解 api 请求模块的封装</li>
<li>能了解在 Vue 中处理表单验证的方式</li>
</ul>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/1566431560209.png" class="">

<p>流程：</p>
<ul>
<li>创建登录组件并配置路由</li>
<li>布局</li>
<li>完成登录功能</li>
</ul>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><h3 id="创建登录组件并配置路由"><a href="#创建登录组件并配置路由" class="headerlink" title="创建登录组件并配置路由"></a>创建登录组件并配置路由</h3><img src="https://yhx0507.github.io/wxapp_static/app/1570784873574.png" class="">

<p>1、创建 <code>views/login/index.vue</code> 并写入以下内容：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span><br><span class="line">    登录组件</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;LoginPage&quot;</span>,</span></span><br><span class="line">    components: &#123;&#125;,</span><br><span class="line">    props: &#123;&#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;&#125;;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;&#125;,</span><br><span class="line">    watch: &#123;&#125;,</span><br><span class="line">    created() &#123;&#125;,</span><br><span class="line">    methods: &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、然后在 <code>router/index.js</code> 中配置路由表：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line">+ <span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">&#x27;@/views/login&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由表</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">+  &#123;</span><br><span class="line">+    path: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">+    component: Login</span><br><span class="line">+  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后，访问 <code>/login</code> 查看是否能访问到登录页面组件。</p>
<h3 id="布局结构"><a href="#布局结构" class="headerlink" title="布局结构"></a>布局结构</h3><img src="https://yhx0507.github.io/wxapp_static/app/1570785466138.png" class="">

<p>这里主要使用到三个 Vant 组件：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/nav-bar">NavBar 导航栏</a></li>
<li><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/field">Field 输入框</a></li>
<li><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/button">Button 按钮</a></li>
</ul>
<p>1、登录页面的模板</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">title</span>=<span class="string">&quot;登录&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 表单 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-field</span> <span class="attr">label</span>=<span class="string">&quot;手机号&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入手机号&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-field</span> <span class="attr">label</span>=<span class="string">&quot;验证码&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入验证码&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /表单 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 登录按钮 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login-btn-box&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">&quot;info&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /登录按钮 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="布局样式"><a href="#布局样式" class="headerlink" title="布局样式"></a>布局样式</h3><img src="https://yhx0507.github.io/wxapp_static/app/1570786015561.png" class="">

<p>我们把设置登录页头部的样式写到全局（全局生效），因为其它页面也要使用。把非公共样式写到页面组件内部，避免和其它组件样式冲突。</p>
<p>下面是具体实现步骤。</p>
<p>一、添加全局样式设置导航栏</p>
<p>1、在 <code>styles/base.less</code> 并写入以下内容</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 把全局公共样式写到这里</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.van-nav-bar</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#3196fa</span>;</span><br><span class="line">  <span class="selector-class">.van-nav-bar__title</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完了测试查看效果。</p>
<p>二、添加局部样式处理登录按钮居中</p>
<p>在 <code>views/login/index.vue</code> 组件中的 style 中添加</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.login-container</span> &#123;</span><br><span class="line">  <span class="selector-class">.login-btn-container</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="selector-class">.login-btn</span> &#123;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实现基本登录功能"><a href="#实现基本登录功能" class="headerlink" title="实现基本登录功能"></a>实现基本登录功能</h2><img src="https://yhx0507.github.io/wxapp_static/app/login.gif" class="">

<p>实现思路：</p>
<ul>
<li>获取表单数据（根据接口要求使用 v-model 绑定）</li>
<li>注册点击登录的事件</li>
<li>表单验证</li>
<li>发请求提交</li>
<li>根据请求结果做下一步处理</li>
</ul>
<h3 id="数据绑定"><a href="#数据绑定" class="headerlink" title="数据绑定"></a>数据绑定</h3><p><strong>根据接口要求</strong>绑定获取表单数据。</p>
<p>1、在登录页面组件的实例选项 data 中添加 <code>user</code> 数据字段</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    user: &#123;</span><br><span class="line">      mobile: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      code: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、在表单中使用 <code>v-model</code> 绑定对应数据</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- van-cell-group 仅仅是提供了一个上下外边框，能看到包裹的区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-field</span></span></span><br><span class="line"><span class="tag">    +</span></span><br><span class="line"><span class="tag">    <span class="attr">v-model</span>=<span class="string">&quot;user.mobile&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">required</span></span></span><br><span class="line"><span class="tag">    <span class="attr">clearable</span></span></span><br><span class="line"><span class="tag">    <span class="attr">label</span>=<span class="string">&quot;手机号&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">placeholder</span>=<span class="string">&quot;请输入手机号&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-field</span></span></span><br><span class="line"><span class="tag">    +</span></span><br><span class="line"><span class="tag">    <span class="attr">v-model</span>=<span class="string">&quot;user.code&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">type</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">label</span>=<span class="string">&quot;验证码&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">placeholder</span>=<span class="string">&quot;请输入验证码&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">required</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后测试。</p>
<blockquote>
<p>一个小技巧：使用 VueDevtools 调试工具查看是否绑定成功。</p>
</blockquote>
<h3 id="请求登录"><a href="#请求登录" class="headerlink" title="请求登录"></a>请求登录</h3><p>1、给登录按钮注册点击事件处理函数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">&quot;info&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onLogin&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、登录处理函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onLogin () &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> request(&#123;</span><br><span class="line">      method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">      url: <span class="string">&#x27;/app/v1_0/authorizations&#x27;</span>,</span><br><span class="line">      data: <span class="built_in">this</span>.user</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;登录成功&#x27;</span>, res)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;登录失败&#x27;</span>, err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="登录中提示"><a href="#登录中提示" class="headerlink" title="登录中提示"></a>登录中提示</h2><img src="https://yhx0507.github.io/wxapp_static/app/loging.gif" class="">

<p>Vant 中内置了<a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/toast">Toast 轻提示</a>组件，可以实现移动端常见的提示效果。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简单文字提示</span></span><br><span class="line">Toast(<span class="string">&quot;提示内容&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// loading 转圈圈提示</span></span><br><span class="line">Toast.loading(&#123;</span><br><span class="line">  duration: <span class="number">0</span>, <span class="comment">// 持续展示 toast</span></span><br><span class="line">  message: <span class="string">&quot;加载中...&quot;</span>,</span><br><span class="line">  forbidClick: <span class="literal">true</span> <span class="comment">// 是否禁止背景点击</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 成功提示</span></span><br><span class="line">Ttoast.success(<span class="string">&quot;成功文案&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 失败提示</span></span><br><span class="line">Toast.fail(<span class="string">&quot;失败文案&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>提示：在组件中可以直接通过 <code>this.$toast</code> 调用。</p>
</blockquote>
<p>另外需要注意的是：Toast 默认采用单例模式，即同一时间只会存在一个 Toast，如果需要在同一时间弹出多个 Toast，可以参考下面的示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Toast.allowMultiple();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> toast1 = Toast(<span class="string">&#x27;第一个 Toast&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> toast2 = Toast.success(<span class="string">&#x27;第二个 Toast&#x27;</span>);</span><br><span class="line"></span><br><span class="line">toast1.clear();</span><br><span class="line">toast2.clear();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>下面是为我们的登录功能增加 toast 交互提示。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onLogin () &#123;</span><br><span class="line">  <span class="comment">// 开始转圈圈</span></span><br><span class="line">  <span class="built_in">this</span>.$toast.loading(&#123;</span><br><span class="line">    duration: <span class="number">0</span>, <span class="comment">// 持续时间，0表示持续展示不停止</span></span><br><span class="line">    forbidClick: <span class="literal">true</span>, <span class="comment">// 是否禁止背景点击</span></span><br><span class="line">    message: <span class="string">&#x27;登录中...&#x27;</span> <span class="comment">// 提示消息</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> request(&#123;</span><br><span class="line">      method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">      url: <span class="string">&#x27;/app/v1_0/authorizations&#x27;</span>,</span><br><span class="line">      data: <span class="built_in">this</span>.user</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;登录成功&#x27;</span>, res)</span><br><span class="line">    <span class="comment">// 提示 success 或者 fail 的时候，会先把其它的 toast 先清除</span></span><br><span class="line">    <span class="built_in">this</span>.$toast.success(<span class="string">&#x27;登录成功&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;登录失败&#x27;</span>, err)</span><br><span class="line">    <span class="built_in">this</span>.$toast.fail(<span class="string">&#x27;登录失败，手机号或验证码错误&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>假如请求非常快的话就看不到 loading 效果了，这里可以手动将调试工具中的网络设置为慢速网络。</p>
<img src="https://yhx0507.github.io/wxapp_static/app/image-20200108104554588.png" class="">

<p>测试结束，再把网络设置恢复为 <code>Online</code> 正常网络。</p>
<h2 id="优化封装请求模块"><a href="#优化封装请求模块" class="headerlink" title="优化封装请求模块"></a>优化封装请求模块</h2><p>我们建议将所有请求都封装为函数的方式来进行使用，这样做的主要目的是为了便于重用和管理维护。</p>
<p>这里我们先把登录中的请求封装到请求模块中。</p>
<p>1、创建 <code>src/api/user.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户相关的请求模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&quot;@/utils/request&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> login = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;/app/v1_0/authorizations&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、然后在登录页面中加载调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; login &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/user&quot;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onLogin () &#123;</span><br><span class="line">  <span class="comment">// const loginToast = this.$toast.loading(&#123;</span></span><br><span class="line">  <span class="built_in">this</span>.$toast.loading(&#123;</span><br><span class="line">    duration: <span class="number">0</span>, <span class="comment">// 持续时间，0表示持续展示不停止</span></span><br><span class="line">    forbidClick: <span class="literal">true</span>, <span class="comment">// 是否禁止背景点击</span></span><br><span class="line">    message: <span class="string">&#x27;登录中...&#x27;</span> <span class="comment">// 提示消息</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">+    <span class="keyword">const</span> res = <span class="keyword">await</span> login(<span class="built_in">this</span>.user)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;登录成功&#x27;</span>, res)</span><br><span class="line">    <span class="comment">// 提示 success 或者 fail 的时候，会先把其它的 toast 先清除</span></span><br><span class="line">    <span class="built_in">this</span>.$toast.success(<span class="string">&#x27;登录成功&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;登录失败&#x27;</span>, err)</span><br><span class="line">    <span class="built_in">this</span>.$toast.fail(<span class="string">&#x27;登录失败，手机号或验证码错误&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、测试功能是否正常</p>
<p><strong>之后项目中所有的请求就都不要在组件中去直接发了，而是都采用上面的方式封装之后进行使用，这是一个建议的做法。</strong></p>
<h2 id="发送验证码"><a href="#发送验证码" class="headerlink" title="发送验证码"></a>发送验证码</h2><h3 id="使用倒计时组件"><a href="#使用倒计时组件" class="headerlink" title="使用倒计时组件"></a>使用倒计时组件</h3><p>1、在 data 中添加数据用来控制倒计时的显示和隐藏</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    isCountDownShow: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、使用倒计时组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-field</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">&quot;user.code&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">placeholder</span>=<span class="string">&quot;请输入验证码&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon icon-mima&quot;</span> <span class="attr">slot</span>=<span class="string">&quot;left-icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-count-down</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-if</span>=<span class="string">&quot;isCountDownShow&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">slot</span>=<span class="string">&quot;button&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:time</span>=<span class="string">&quot;1000 * 5&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">format</span>=<span class="string">&quot;ss s&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">finish</span>=<span class="string">&quot;isCountDownShow = false&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-else</span></span></span><br><span class="line"><span class="tag">    <span class="attr">slot</span>=<span class="string">&quot;button&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">round</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click</span>=<span class="string">&quot;onSendSmsCode&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span>发送验证码<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="发送验证码-1"><a href="#发送验证码-1" class="headerlink" title="发送验证码"></a>发送验证码</h3><p>1、在 <code>api/user.js</code> 中添加封装数据接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getSmsCode = <span class="function"><span class="params">mobile</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    url: <span class="string">`/app/v1_0/sms/codes/<span class="subst">$&#123;mobile&#125;</span>`</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、给发送验证码按钮注册点击事件</p>
<p>3、发送处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onSendSmsCode () &#123;</span><br><span class="line">  <span class="comment">// 1. 获取手机号</span></span><br><span class="line">  <span class="keyword">const</span> &#123; mobile &#125; = <span class="built_in">this</span>.user</span><br><span class="line">  <span class="comment">// 2. 校验手机号是否有效</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 发送验证码</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 显示倒计时</span></span><br><span class="line">    <span class="built_in">this</span>.isCountDownShow = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送</span></span><br><span class="line">    <span class="keyword">await</span> getSmsCode(mobile)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送失败，关闭倒计时</span></span><br><span class="line">    <span class="built_in">this</span>.isCountDownShow = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (err.response.status === <span class="number">429</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.$toast(<span class="string">&#x27;请勿频繁发送&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.$toast(<span class="string">&#x27;发送失败&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="表单验证"><a href="#表单验证" class="headerlink" title="表单验证"></a>表单验证</h2><h3 id="表单验证方式介绍"><a href="#表单验证方式介绍" class="headerlink" title="表单验证方式介绍"></a>表单验证方式介绍</h3><p>常见的表单验证方式一般有下面几种：</p>
<ul>
<li>使用 HTML5 自带的表单验证</li>
<li>使用第三方组件库</li>
<li>自己写</li>
</ul>
<p>下面针对这些方式一一说明。</p>
<p><strong>方式一：HTML5 自带的表单验证（了解即可）</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;&quot;</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">required</span> <span class="attr">minlength</span>=<span class="string">&quot;3&quot;</span> <span class="attr">maxlength</span>=<span class="string">&quot;5&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;&quot;</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>优点：原生支持，使用简单</p>
<p>缺点：兼容不好，功能有限</p>
<p><strong>方式二：自己写</strong></p>
<ul>
<li>例如之前学习的自定义表单验证</li>
<li>例如 Vue 官方 Cookbook 中的<a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/cookbook/form-validation.html">表单校验</a></li>
</ul>
<p>优点：控制灵活</p>
<p>缺点：手写麻烦，效率低</p>
<p><strong>方式三：使用组件库内置的验证</strong></p>
<ul>
<li>例如 element 内置的验证功能</li>
<li>但是 Vant 没有提供</li>
</ul>
<p>优点：和组件库配套使用，功能强大</p>
<p>缺点：依赖 Vue 生态，特定组件库</p>
<p><strong>方式四：使用专门的验证插件</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/monterail/vuelidate">vuelidate</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/baianat/vee-validate">VeeValidate</a>（推荐）</li>
<li>…</li>
</ul>
<p>优点：功能强大</p>
<p>缺点：依赖 Vue 生态，特定组件库</p>
<p>我们项目中主要讲解使用 VeeValidate 作为我们的表单验证解决方案。</p>
<h3 id="安装和配置"><a href="#安装和配置" class="headerlink" title="安装和配置"></a>安装和配置</h3><p>1、安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yarn add vee-validate</span></span><br><span class="line">npm i vee-validate</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、创建 <code>utils/validation.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载需要使用的验证组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; ValidationProvider, ValidationObserver, extend &#125; <span class="keyword">from</span> <span class="string">&#x27;vee-validate&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载内置的验证规则</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> rules <span class="keyword">from</span> <span class="string">&#x27;vee-validate/dist/rules&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载中文语言包</span></span><br><span class="line"><span class="comment">// 官方文档：https://logaretm.github.io/vee-validate/guide/rules.html#importing-the-rules</span></span><br><span class="line"><span class="keyword">import</span> &#123; messages &#125; <span class="keyword">from</span> <span class="string">&#x27;vee-validate/dist/locale/zh_CN.json&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册全局组件</span></span><br><span class="line">Vue.component(<span class="string">&#x27;ValidationProvider&#x27;</span>, ValidationProvider)</span><br><span class="line">Vue.component(<span class="string">&#x27;ValidationObserver&#x27;</span>, ValidationObserver)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置验证规则和中文提示消息</span></span><br><span class="line"><span class="built_in">Object</span>.keys(rules).forEach(<span class="function"><span class="params">rule</span> =&gt;</span> &#123;</span><br><span class="line">  extend(rule, &#123;</span><br><span class="line">    ...rules[rule],</span><br><span class="line">    message: messages[rule]</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、在 <code>main.js</code> 中加载执行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./utils/validation.js&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p>1、使用 <code>ValidationObserver</code> 把需要校验的整个表单包起来</p>
<p>2、使用 <code>ValidationProvider</code> 把需要校验的具体表单元素包起来，例如 input</p>
<p>3、通过 <code>ValidationProvider</code> 配置具体的校验规则</p>
<ul>
<li><p><code>name</code> 配置验证字段的名称</p>
</li>
<li><p><code>rules</code> 验证规则</p>
<ul>
<li><code>rules=&quot;requried&quot;</code> 单个验证规则</li>
<li><code>rules=&quot;required|length:4&quot;</code> 多个验证规则使用 | 分隔</li>
</ul>
</li>
<li><p><code>v-slot=&quot;&#123; errors &#125;&quot;</code> 获取错误消息，使用 <code>errors[0]</code> 绑定展示错误消息</p>
</li>
</ul>
<p>下面是一个基本使用示例。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ValidationObserver</span> <span class="attr">ref</span>=<span class="string">&quot;form&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ValidationProvider</span> <span class="attr">name</span>=<span class="string">&quot;手机号&quot;</span> <span class="attr">rules</span>=<span class="string">&quot;required&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-field</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;form-item&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">&quot;user.mobile&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">clearable</span></span></span><br><span class="line"><span class="tag">      <span class="attr">placeholder</span>=<span class="string">&quot;请输入手机号&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon icon-shouji&quot;</span> <span class="attr">slot</span>=<span class="string">&quot;left-icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- errors[0] 获取验证失败的错误消息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; errors[0] &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ValidationProvider</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">ValidationProvider</span> <span class="attr">name</span>=<span class="string">&quot;验证码&quot;</span> <span class="attr">rules</span>=<span class="string">&quot;required&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-field</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;form-item&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">&quot;user.code&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">placeholder</span>=<span class="string">&quot;请输入验证码&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon icon-mima&quot;</span> <span class="attr">slot</span>=<span class="string">&quot;left-icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-count-down</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-if</span>=<span class="string">&quot;isCountDownShow&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">slot</span>=<span class="string">&quot;button&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:time</span>=<span class="string">&quot;1000 * 60&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">format</span>=<span class="string">&quot;ss s&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">finish</span>=<span class="string">&quot;isCountDownShow = false&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-else</span></span></span><br><span class="line"><span class="tag">        <span class="attr">slot</span>=<span class="string">&quot;button&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">round</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">&quot;onSendSmsCode&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span>发送验证码<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ValidationProvider</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ValidationObserver</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="使用内置验证规则"><a href="#使用内置验证规则" class="headerlink" title="使用内置验证规则"></a>使用内置验证规则</h3><p>例如：</p>
<ul>
<li><code>required</code>：必填项</li>
<li><code>email</code>：必须是邮箱</li>
<li><code>length</code>：长度</li>
<li><code>min</code>：最小长度</li>
<li><code>max</code>：最大长度</li>
<li><code>min_value</code>：最小数字</li>
<li><code>max_value</code>：最大数字</li>
<li>…</li>
</ul>
<p>所有的内置验证规则都在<a target="_blank" rel="noopener" href="https://logaretm.github.io/vee-validate/guide/rules.html#rules">这里查询</a>。</p>
<h3 id="使用自定义验证规则"><a href="#使用自定义验证规则" class="headerlink" title="使用自定义验证规则"></a>使用自定义验证规则</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; extend &#125; <span class="keyword">from</span> <span class="string">&#x27;vee-validate&#x27;</span>;</span><br><span class="line"></span><br><span class="line">extend(<span class="string">&#x27;positive&#x27;</span>, <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> value &gt;= <span class="number">0</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ValidationProvider</span> <span class="attr">rules</span>=<span class="string">&quot;positive&quot;</span> <span class="attr">v-slot</span>=<span class="string">&quot;&#123; errors &#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;value&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; errors[0] &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ValidationProvider</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加自定义手机号验证规则。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">extend(<span class="string">&#x27;mobile&#x27;</span>, &#123;</span><br><span class="line">  validate: <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/^1(3|5|6|7|8|9)\d&#123;9&#125;$/</span>.test(value)</span><br><span class="line">  &#125;,</span><br><span class="line">  message: <span class="string">&#x27;手机号码格式错误&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>添加自定义验证码验证规则。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">extend(<span class="string">&#x27;code&#x27;</span>, &#123;</span><br><span class="line">  validate: <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/^\d&#123;6&#125;$/</span>.test(value)</span><br><span class="line">  &#125;,</span><br><span class="line">  message: <span class="string">&#x27;验证码格式错误&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>自定义异步验证示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 验证方法必须返回一个 Promise</span></span><br><span class="line"><span class="comment">// 1. 在 Promise 中执行异步操作（定时器、ajax请求）</span></span><br><span class="line"><span class="comment">// 2. 成功 resolve(true)</span></span><br><span class="line"><span class="comment">// 3. 失败 reject(&#x27;错误提示消息&#x27;)</span></span><br><span class="line">extend(<span class="string">&#x27;async-test&#x27;</span>, <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span> ? resolve(<span class="literal">true</span>) : reject(<span class="string">&#x27;错误消息&#x27;</span>)</span><br><span class="line">    &#125;, <span class="number">500</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="手动触发验证"><a href="#手动触发验证" class="headerlink" title="手动触发验证"></a>手动触发验证</h3><p>一、手动触发验证</p>
<p>1、给 <code>ValidationObserver</code> 组件添加一个 <code>ref</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ValidationObserver</span> <span class="attr">ref</span>=<span class="string">&quot;form&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、调用组件的 <code>validate</code> 方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.$refs.form.validate().then(<span class="function"><span class="params">success</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">    <span class="comment">// 表单验证失败处理</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 表单验证通过处理</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这里我们可以看到表单验证的方法支持 Promise，所以我们可以结合 async-await 获取表单验证结果。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> success = <span class="keyword">await</span> <span class="built_in">this</span>.$refs.form.validate()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!success) &#123;</span><br><span class="line">  <span class="comment">// 表单验证失败处理</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 使用 return 阻止代码往后执行，不用把后续代码往 else 中嵌套了</span></span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 表单验证成功处理</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>二、获取验证失败的错误消息并给出轻提示</p>
<p>通过 ValidationObserver 组件的 <code>errors</code> 可以获取到报错信息。</p>
<img src="https://yhx0507.github.io/wxapp_static/app/image-20200109093642365.png" class="">

<blockquote>
<p>通过调试工具也可以看到这个错误信息对象。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> errors = <span class="built_in">this</span>.$refs.form.errors</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> errors) &#123;</span><br><span class="line">  <span class="keyword">const</span> item = errors[key]</span><br><span class="line">  <span class="keyword">if</span> (item[<span class="number">0</span>]) &#123;</span><br><span class="line">    <span class="built_in">this</span>.$toast(item[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 找到第1个有错误的消息，给出提示，停止遍历</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证指定数据字段"><a href="#验证指定数据字段" class="headerlink" title="验证指定数据字段"></a>验证指定数据字段</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; validate &#125; <span class="keyword">from</span> <span class="string">&#x27;vee-validate&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数1：要验证的数据</span></span><br><span class="line"><span class="comment">// 参数2：验证规则</span></span><br><span class="line"><span class="comment">// 参数3：一个可选的配置对象，例如配置错误消息字段名称 name</span></span><br><span class="line"><span class="comment">// 返回值：&#123; valid, errors, ... &#125;</span></span><br><span class="line"><span class="comment">//          valid: 验证是否成功，成功 true，失败 false</span></span><br><span class="line"><span class="comment">//          errors：一个数组，错误提示消息</span></span><br><span class="line"><span class="keyword">const</span> validateResult = <span class="keyword">await</span> validate(mobile, <span class="string">&#x27;required|mobile&#x27;</span>, &#123;</span><br><span class="line">  name: <span class="string">&#x27;手机号&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果验证失败，提示错误消息，停止发送验证码</span></span><br><span class="line"><span class="keyword">if</span> (!validateResult.valid) &#123;</span><br><span class="line">  <span class="built_in">this</span>.$toast(validateResult.errors[<span class="number">0</span>])</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="三、Token-处理"><a href="#三、Token-处理" class="headerlink" title="三、Token 处理"></a>三、Token 处理</h1><h2 id="Token-介绍"><a href="#Token-介绍" class="headerlink" title="Token 介绍"></a>Token 介绍</h2><h3 id="HTTP-是无状态的"><a href="#HTTP-是无状态的" class="headerlink" title="HTTP 是无状态的"></a>HTTP 是无状态的</h3><img src="https://yhx0507.github.io/wxapp_static/app/v2-dde997503ed9d450e2f39042d53d4307_hd.png" class="">

<h3 id="基于-Cookie-的状态保持"><a href="#基于-Cookie-的状态保持" class="headerlink" title="基于 Cookie 的状态保持"></a>基于 Cookie 的状态保持</h3><img src="https://yhx0507.github.io/wxapp_static/app/v2-85622297a93f493c891ffb90b67fd5e0_hd.png" class="">

<img src="https://yhx0507.github.io/wxapp_static/app/v2-1f49734871c5e2da2d264d28ac310a65_hd.png" class="">

<p>Cookie 在客户端本地，用户可以操作它，所以不适合存储对安全性要求比较高的数据。</p>
<h3 id="基于-Session-的状态保持"><a href="#基于-Session-的状态保持" class="headerlink" title="基于 Session 的状态保持"></a>基于 Session 的状态保持</h3><img src="https://yhx0507.github.io/wxapp_static/app/image-20200108192548559.png" class="">

<p>Session 不是新东西，它是基于 Cookie 的一个服务端技术，用一个生活中的例子来解释就好比我们逛超市存包。</p>
<ul>
<li>你：客户端</li>
<li>超市：服务器</li>
<li>存物柜：服务端的 Session Store<ul>
<li>存储用户的状态等对安全性比较高的数据</li>
</ul>
</li>
<li>你拿的那个凭据：访问服务端 Session 数据的凭证<ul>
<li>凭证是服务端给你的</li>
<li>凭证是唯一的</li>
</ul>
</li>
</ul>
<p>Session 其实就是把对安全性要求比较高的状态数据放到了服务端，把访问数据的钥匙放到了用户的本地（Cookie）。</p>
<p>用户的登录状态肯定是安全性要求比较高的，所以通常会使用 Session 来存储用户的登录状态。</p>
<img src="https://yhx0507.github.io/wxapp_static/app/v2-0b02fa4a73a8072eb03cdf78270235e1_hd.png" class="">

<p>1、用户向服务器发送用户名和密码。</p>
<p>2、服务器验证通过后，在当前对话（session）里面保存相关数据，比如用户角色、登录时间等等。</p>
<p>3、服务器向用户返回一个 session_id，写入用户的 Cookie。</p>
<p>4、用户随后的每一次请求，都会通过 Cookie，将 session_id 传回服务器。</p>
<p>5、服务器收到 session_id，找到前期保存的数据，由此得知用户的身份。</p>
<p>这种模式的问题在于，扩展性（scaling）不好。单机当然没有问题，如果是服务器集群，或者是跨域的服务导向架构，就要求 session 数据共享，每台服务器都能够读取 session。</p>
<p>举例来说，A 网站和 B 网站是同一家公司的关联服务。现在要求，用户只要在其中一个网站登录，再访问另一个网站就会自动登录，请问怎么实现？</p>
<p>一种解决方案是 session 数据持久化，写入数据库或别的持久层。各种服务收到请求后，都向持久层请求数据。这种方案的优点是架构清晰，缺点是工程量比较大。另外，持久层万一挂了，就会单点失败。</p>
<p>另一种方案是服务器索性不保存 session 数据了，所有数据都保存在客户端，每次请求都发回服务器。</p>
<h3 id="基于-Token（令牌、凭据、凭证）-的状态保持"><a href="#基于-Token（令牌、凭据、凭证）-的状态保持" class="headerlink" title="基于 Token（令牌、凭据、凭证） 的状态保持"></a>基于 Token（令牌、凭据、凭证） 的状态保持</h3><p>基于 Token 的的思路是，服务器认证以后，生成一个加密数据（令牌），发回给用户，数据内容就像下面这样。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;姓名&quot;</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;角色&quot;</span>: <span class="string">&quot;管理员&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;到期时间&quot;</span>: <span class="string">&quot;2018年7月1日0点0分&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以后，用户与服务端通信的时候，都要发回这个加密数据（令牌）。服务器通过解密获取明文数据就知道了用户身份。</p>
<p>服务器就不保存任何 session 数据了，也就是说，服务器变成无状态了，从而比较容易实现扩展。</p>
<p>基于 <code>token</code> 的鉴权机制类似于 HTTP 协议也是无状态的，它不需要在服务端去保留用户的认证信息或者会话信息。这就意味着基于 <code>token</code> 认证机制的应用不需要去考虑用户在哪一台服务器登录了，这就为应用的扩展提供了便利。</p>
<img src="https://yhx0507.github.io/wxapp_static/app/ezgif-5-ae2b96ba00b5.png" class="">

<p>1、用户使用用户名密码来请求服务器</p>
<p>2、服务器进行验证用户的信息</p>
<p>3、服务器通过验证发送给用户一个 token</p>
<p>4、客户端存储 token，并在每次请求时附送上这个 token 值</p>
<p>5、服务端验证 token 值，并返回数据</p>
<p>以上就是基于 Token 认证的思路。</p>
<h3 id="JWT（JSON-Web-Token）"><a href="#JWT（JSON-Web-Token）" class="headerlink" title="JWT（JSON Web Token）"></a>JWT（JSON Web Token）</h3><p>有了基于 Token 认证的思路了，该如何实现呢？例如</p>
<ul>
<li>如何生成 Token？</li>
<li>如何加密？</li>
<li>如何解密？</li>
<li>如何规定数据格式？</li>
</ul>
<p>如果大家都各自搞一套，太麻烦。所以社区中制定了一个具体实现：<a target="_blank" rel="noopener" href="https://jwt.io/">JSON Web Token</a>。</p>
<ul>
<li>Java</li>
<li>PHP</li>
<li>Ruby</li>
<li>Python</li>
<li>Node.js</li>
<li>。。。。</li>
</ul>
<p>该方案主要是对 JSON 格式数据进行加解密以及数据格式的规范，方便前后端交互。</p>
<img src="https://yhx0507.github.io/wxapp_static/app/image-20200108012948915.png" class="">

<p>Json web token (JWT), 是为了在网络应用环境间传递声明而执行的一种基于JSON的开放标准（<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://tools.ietf.org/html/rfc7519">(RFC 7519</a>).该token被设计为紧凑且安全的，特别适用于分布式站点的单点登录（SSO）场景。JWT的声明一般被用来在身份提供者和服务提供者间传递被认证的用户身份信息，以便于从资源服务器获取资源，也可以增加一些额外的其它业务逻辑所必须的声明信息，该token也可直接被用于认证，也可被加密。</p>
<p>JWT 的一些特点如下：</p>
<p>（1）JWT 默认是不加密，但也是可以加密的。生成原始 Token 以后，可以用密钥再加密一次。</p>
<p>（2）JWT 不加密的情况下，不能将秘密数据写入 JWT。</p>
<p>（3）JWT 不仅可以用于认证，也可以用于交换信息。有效使用 JWT，可以降低服务器查询数据库的次数。</p>
<p>（4）JWT 的最大缺点是，由于服务器不保存 session 状态，因此无法在使用过程中废止某个 token，或者更改 token 的权限。也就是说，一旦 JWT 签发了，在到期之前就会始终有效，除非服务器部署额外的逻辑。</p>
<p>（5）JWT 本身包含了认证信息，一旦泄露，任何人都可以获得该令牌的所有权限。为了减少盗用，JWT 的有效期应该设置得比较短。对于一些比较重要的权限，使用时应该再次对用户进行认证。</p>
<p>（6）为了减少盗用，JWT 不应该使用 HTTP 协议明码传输，要使用 HTTPS 协议传输。</p>
<blockquote>
<p>扩展阅读</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html">http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html</a></li>
</ul>
</blockquote>
<h2 id="存储-Token"><a href="#存储-Token" class="headerlink" title="存储 Token"></a>存储 Token</h2><img src="https://yhx0507.github.io/wxapp_static/app/image-20200109192157006.png" class="">

<p>我们项目中哪里需要使用呢？</p>
<ul>
<li>请求需要权限的接口</li>
<li>底部导航栏中也需要使用判断登录状态给出不同的提示<ul>
<li>已登录：我的</li>
<li>未登录：未登录</li>
</ul>
</li>
<li>我的页面也要使用，判断登录状态给出不同的页面展示</li>
<li>…</li>
</ul>
<p>往哪儿存？</p>
<ul>
<li>本地存储（持久化）<ul>
<li>获取麻烦</li>
<li>不是响应式</li>
</ul>
</li>
<li>Vuex 容器（推荐）<ul>
<li>获取方便</li>
<li>响应式的</li>
</ul>
</li>
</ul>
<p>思路：</p>
<ul>
<li>登录成功，将 token 存储到本地存储</li>
<li>为了持久化，还需要把 token 放到本地存储</li>
</ul>
<p>下面是具体实现。</p>
<p>一、使用 Vuex 容器存储 token</p>
<p>1、在 <code>src/store/index.js</code> 中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    <span class="comment">// 登录用户，一个对象，包含 token 信息</span></span><br><span class="line">+    user: <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">+    setUser (state, data) &#123;</span><br><span class="line">+      state.user = data</span><br><span class="line">+    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  modules: &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、登录成功以后将后端返回的 token 相关数据存储到容器中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onLogin () &#123;</span><br><span class="line">  <span class="comment">// const loginToast = this.$toast.loading(&#123;</span></span><br><span class="line">  <span class="built_in">this</span>.$toast.loading(&#123;</span><br><span class="line">    duration: <span class="number">0</span>, <span class="comment">// 持续时间，0表示持续展示不停止</span></span><br><span class="line">    forbidClick: <span class="literal">true</span>, <span class="comment">// 是否禁止背景点击</span></span><br><span class="line">    message: <span class="string">&#x27;登录中...&#x27;</span> <span class="comment">// 提示消息</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> login(<span class="built_in">this</span>.user)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// res.data.data =&gt; &#123; token: &#x27;xxx&#x27;, refresh_token: &#x27;xxx&#x27; &#125;</span></span><br><span class="line">+    <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;setUser&#x27;</span>, res.data.data)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提示 success 或者 fail 的时候，会先把其它的 toast 先清除</span></span><br><span class="line">    <span class="built_in">this</span>.$toast.success(<span class="string">&#x27;登录成功&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;登录失败&#x27;</span>, err)</span><br><span class="line">    <span class="built_in">this</span>.$toast.fail(<span class="string">&#x27;登录失败，手机号或验证码错误&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 停止 loading，它会把当前页面中所有的 toast 都给清除</span></span><br><span class="line">  <span class="comment">// loginToast.clear()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完了，在浏览器中点击登录，通过 VueDevTools 查看数据是否能正常的存储到 Vuex 容器中。</p>
<p>二、持久化 token 存储</p>
<p>Vuex 容器中的数据只是为了方便在其他任何地方能获取登录状态数据，但是页面刷新还是会丢失数据状态，所以我们还要把数据进行持久化中以防止页面刷新丢失状态的问题。</p>
<p>前端持久化常见的方式就是：</p>
<ul>
<li>本地存储</li>
<li>Cookie</li>
</ul>
<p>这里我们以使用本地存储持久化用户状态为例。</p>
<p>为了方便，这里先封装一个用于操作本地存储的工具模块。</p>
<p>1、创建 <code>src/utils/storage.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装操作本地存储的工具方法模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getItem = <span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="built_in">window</span>.localStorage.getItem(name)</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(data)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;转换失败&#x27;</span>, err)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> setItem = <span class="function">(<span class="params">name, value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">typeof</span> value === <span class="string">&#x27;object&#x27;</span></span><br><span class="line">    ? <span class="built_in">JSON</span>.stringify(value)</span><br><span class="line">    : value</span><br><span class="line">  <span class="built_in">window</span>.localStorage.setItem(name, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> removeItem = <span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">window</span>.localStorage.removeItem(name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、然后在容器中使用使用本地存储持久化 token 数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line">+ <span class="keyword">import</span> &#123; setItem, getItem &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/storage&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    <span class="comment">// 登录用户，一个对象，包含 token 信息</span></span><br><span class="line">+    user: getItem(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">    <span class="comment">// user: null</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    setUser (state, data) &#123;</span><br><span class="line">      state.user = data</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 为了防止刷新丢失 state 中的 user 状态，我们把它放到本地存储</span></span><br><span class="line">+      setItem(<span class="string">&#x27;user&#x27;</span>, state.user)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  modules: &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>测试：重新登录，查看本地存储是否有 token 数据，刷新浏览器，查看 Vuex 容器是否有 token 数据。</p>
<p>经过以上处理之后，接下来我们项目中所有需要使用 token 的业务，直接找 Vuex 容器拿，不需要关心数据从哪儿来的。</p>
<h2 id="解析-Token"><a href="#解析-Token" class="headerlink" title="解析 Token"></a>解析 Token</h2><p>有时候我们需要使用到登录用户的相关信息，例如用户 ID，正常的话建议由后端返回，但是如果后端没有提供的话，我们也可以通过解析 JWT token 来获取。</p>
<blockquote>
<p>提示：token 中一定有表示用户身份的信息，例如 ID。</p>
</blockquote>
<p>这里主要使用到一个第三方工具包：<a target="_blank" rel="noopener" href="https://github.com/auth0/jwt-decode">jwt-decode</a>。</p>
<p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i jwt-decode</span><br></pre></td></tr></table></figure>

<p>2、然后在容器中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> decodeJwt <span class="keyword">from</span> <span class="string">&#x27;jwt-decode&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">setUser (state, data) &#123;</span><br><span class="line">  <span class="comment">// 解析 JWT 中的数据（需要使用用户ID）</span></span><br><span class="line">  <span class="keyword">if</span> (data &amp;&amp; data.token) &#123;</span><br><span class="line">    data.id = decodeJwt(data.token).user_id</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  state.user = data</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 为了防止刷新丢失 state 中的 user 状态，我们把它放到本地存储</span></span><br><span class="line">  setItem(<span class="string">&#x27;user&#x27;</span>, state.user)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>之后就可以直接通过 <code>store.state.user.id</code> 来访问使用了。</p>
<h2 id="发送-Token"><a href="#发送-Token" class="headerlink" title="发送 Token"></a>发送 Token</h2><p>很多接口都需要提供 token（用户的登录状态） 才能访问。</p>
<p>方式一：在每次请求的时候手动添加（麻烦）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">  method: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  url: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    token数据</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>方式二：使用请求拦截器统一添加（推荐，更方便）</p>
<p>在 <code>src/utils/request.js</code> 中添加拦截器统一设置 token：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line">request.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// config 请求配置对象，我们可以通过修改 config 来实现统一请求数据处理</span></span><br><span class="line">  <span class="keyword">const</span> &#123; user &#125; = store.state</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 统一添加 token</span></span><br><span class="line">  <span class="keyword">if</span> (user) &#123;</span><br><span class="line">    <span class="comment">// config.headers 获取操作请求头对象</span></span><br><span class="line">    <span class="comment">// Authorization 是后端要求的字段名称</span></span><br><span class="line">    <span class="comment">// 数据值后端要求提供：Bearer token数据</span></span><br><span class="line">    <span class="comment">//    注意：Bearer 后面有个空格</span></span><br><span class="line">    <span class="comment">// 老师，为啥？后端要求的</span></span><br><span class="line">    config.headers.Authorization = <span class="string">`Bearer <span class="subst">$&#123;user.token&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Do something with request error</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="处理-Token-过期（在功能优化中进行讲解）"><a href="#处理-Token-过期（在功能优化中进行讲解）" class="headerlink" title="处理 Token 过期（在功能优化中进行讲解）"></a>处理 Token 过期（在功能优化中进行讲解）</h2><ul>
<li>为什么 token 过期时间这么短？<ul>
<li>为了安全</li>
</ul>
</li>
<li>过期了怎么办？<ul>
<li>通过登录页面重新登录获取 token</li>
<li>使用 refresh_token 重新获取新的 token</li>
</ul>
</li>
</ul>
<img src="https://yhx0507.github.io/wxapp_static/app/1567481874811.png" class="">

<p>在请求的响应拦截器中统一处理 token 过期：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装 axios 请求模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> jsonBig <span class="keyword">from</span> <span class="string">&quot;json-bigint&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;@/store&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;@/router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// axios.create 方法：复制一个 axios</span></span><br><span class="line"><span class="keyword">const</span> request = axios.create(&#123;</span><br><span class="line">  baseURL: <span class="string">&quot;http://ttapi.research.itcast.cn/&quot;</span> <span class="comment">// 基础路径</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置处理后端返回数据中超出 js 安全整数范围问题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">request.defaults.transformResponse = [</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> jsonBig.parse(data);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line">request.interceptors.request.use(</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> user = store.state.user;</span><br><span class="line">    <span class="keyword">if</span> (user) &#123;</span><br><span class="line">      config.headers.Authorization = <span class="string">`Bearer <span class="subst">$&#123;user.token&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Do something before request is sent</span></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do something with request error</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">request.interceptors.response.use(</span><br><span class="line">  <span class="comment">// 响应成功进入第1个函数</span></span><br><span class="line">  <span class="comment">// 该函数的参数是响应对象</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Any status code that lie within the range of 2xx cause this function to trigger</span></span><br><span class="line">    <span class="comment">// Do something with response data</span></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 响应失败进入第2个函数，该函数的参数是错误对象</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Any status codes that falls outside the range of 2xx cause this function to trigger</span></span><br><span class="line">    <span class="comment">// Do something with response error</span></span><br><span class="line">    <span class="comment">// 如果响应码是 401 ，则请求获取新的 token</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 响应拦截器中的 error 就是那个响应的错误对象</span></span><br><span class="line">    <span class="built_in">console</span>.dir(error);</span><br><span class="line">    <span class="keyword">if</span> (error.response &amp;&amp; error.response.status === <span class="number">401</span>) &#123;</span><br><span class="line">      <span class="comment">// 校验是否有 refresh_token</span></span><br><span class="line">      <span class="keyword">const</span> user = store.state.user;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!user || !user.refresh_token) &#123;</span><br><span class="line">        router.push(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 代码不要往后执行了</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果有refresh_token，则请求获取新的 token</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> axios(&#123;</span><br><span class="line">          method: <span class="string">&quot;PUT&quot;</span>,</span><br><span class="line">          url: <span class="string">&quot;http://ttapi.research.itcast.cn/app/v1_0/authorizations&quot;</span>,</span><br><span class="line">          headers: &#123;</span><br><span class="line">            Authorization: <span class="string">`Bearer <span class="subst">$&#123;user.refresh_token&#125;</span>`</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果获取成功，则把新的 token 更新到容器中</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;刷新 token  成功&quot;</span>, res);</span><br><span class="line">        store.commit(<span class="string">&quot;setUser&quot;</span>, &#123;</span><br><span class="line">          token: res.data.data.token, <span class="comment">// 最新获取的可用 token</span></span><br><span class="line">          refresh_token: user.refresh_token <span class="comment">// 还是原来的 refresh_token</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 把之前失败的用户请求继续发出去</span></span><br><span class="line">        <span class="comment">// config 是一个对象，其中包含本次失败请求相关的那些配置信息，例如 url、method 都有</span></span><br><span class="line">        <span class="comment">// return 把 request 的请求结果继续返回给发请求的具体位置</span></span><br><span class="line">        <span class="keyword">return</span> request(error.config);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="comment">// 如果获取失败，直接跳转 登录页</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;请求刷线 token 失败&quot;</span>, err);</span><br><span class="line">        router.push(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request;</span><br></pre></td></tr></table></figure>

<h1 id="四、个人中心（我的）"><a href="#四、个人中心（我的）" class="headerlink" title="四、个人中心（我的）"></a>四、个人中心（我的）</h1><img src="https://yhx0507.github.io/wxapp_static/app/1566431827166.png" class="">

<h2 id="TabBar"><a href="#TabBar" class="headerlink" title="TabBar"></a>TabBar</h2><p>通过分析页面，我们可以看到，首页、问答、视频、我的 都使用的是同一个底部标签栏，我们没必要在每个页面中都写一个，所以为了通用方便，我们可以使用 Vue Router 的嵌套路由来处理。</p>
<ul>
<li>父路由：一个空页面，包含一个 tabbar，中间留子路由出口</li>
<li>子路由<ul>
<li>首页</li>
<li>问答</li>
<li>视频</li>
<li>我的</li>
</ul>
</li>
</ul>
<h3 id="创建-tabbar-组件并配置路由"><a href="#创建-tabbar-组件并配置路由" class="headerlink" title="创建 tabbar 组件并配置路由"></a>创建 tabbar 组件并配置路由</h3><img src="https://yhx0507.github.io/wxapp_static/app/image-20200109153050432.png" class="">

<p>这里主要使用到的 Vant 组件：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/tabbar">Tabbar 标签栏</a></li>
</ul>
<p>1、创建 <code>src/views/tabbar/index.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tabbar-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 子路由出口 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /子路由出口 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- tab-bar 标签栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-tabbar</span> <span class="attr">route</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-tabbar-item</span> <span class="attr">icon</span>=<span class="string">&quot;wap-home-o&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">van-tabbar-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-tabbar-item</span> <span class="attr">icon</span>=<span class="string">&quot;comment-o&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/qa&quot;</span>&gt;</span>问答<span class="tag">&lt;/<span class="name">van-tabbar-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-tabbar-item</span> <span class="attr">icon</span>=<span class="string">&quot;video-o&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/video&quot;</span>&gt;</span>视频<span class="tag">&lt;/<span class="name">van-tabbar-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-tabbar-item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">icon</span>=<span class="string">&quot;user-o&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">to</span>=<span class="string">&quot;/my&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span>&#123;&#123; $store.state.user ? &#x27;我的&#x27; : &#x27;未登录&#x27; &#125;&#125;<span class="tag">&lt;/<span class="name">van-tabbar-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-tabbar</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /tab-bar 标签栏 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;TabBar&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、然后将 tab-bar 组件配置到一级路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/tab-bar&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问 <code>/</code> 测试。</p>
<h3 id="分别创建首页、问答、视频、我的页面组件"><a href="#分别创建首页、问答、视频、我的页面组件" class="headerlink" title="分别创建首页、问答、视频、我的页面组件"></a>分别创建首页、问答、视频、我的页面组件</h3><p>一、分别创建四个主页面</p>
<p>1、首页</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home-container&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;HomePage&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、问答</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;qa-container&quot;</span>&gt;</span>问答<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;QaPage&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>3、视频</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;video-container&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;VideoPage&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4、我的</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;my-container&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;MyPage&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>二、将四个主页面配置为 tab-bar 的子路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  name: <span class="string">&#x27;tab-bar&#x27;</span>,</span><br><span class="line">  component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/tab-bar&#x27;</span>),</span><br><span class="line">  children: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 默认子路由</span></span><br><span class="line">      name: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">      component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/home&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&#x27;qa&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;qa&#x27;</span>,</span><br><span class="line">      component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/qa&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&#x27;video&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;video&#x27;</span>,</span><br><span class="line">      component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/video&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&#x27;my&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;my&#x27;</span>,</span><br><span class="line">      component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/my&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="我的页面布局"><a href="#我的页面布局" class="headerlink" title="我的页面布局"></a>我的页面布局</h2><ul>
<li>注册组件<ul>
<li>Image</li>
<li>Grid</li>
<li>GridItem</li>
<li>Icon</li>
</ul>
</li>
<li>把该页面需要的两个图片放到页面组件目录中<ul>
<li>banner.png</li>
<li>mobile.png</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;my-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 已登录：用户信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;user-info-wrap&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;base-info-wrap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;avatar-title-wrap&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">round</span></span></span><br><span class="line"><span class="tag">            <span class="attr">fit</span>=<span class="string">&quot;cover&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">&quot;https://img.yzcdn.cn/vant/cat.jpeg&quot;</span></span></span><br><span class="line"><span class="tag">          /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>黑马程序员<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">round</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span>&gt;</span>编辑资料<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-grid</span> <span class="attr">class</span>=<span class="string">&quot;data-info&quot;</span> <span class="attr">:border</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-grid-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>头条<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-grid-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-grid-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>关注<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-grid-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-grid-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>粉丝<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-grid-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-grid-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>获赞<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">van-grid-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-grid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /已登录：用户信息 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 未登录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;not-login&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mobile&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>点击登录<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /未登录 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 其它 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-grid</span> <span class="attr">clickable</span> <span class="attr">:column-num</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-grid-item</span> <span class="attr">text</span>=<span class="string">&quot;我的收藏&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">slot</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">name</span>=<span class="string">&quot;star-o&quot;</span> <span class="attr">color</span>=<span class="string">&quot;#eb5253&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-grid-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-grid-item</span> <span class="attr">text</span>=<span class="string">&quot;浏览历史&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">slot</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">name</span>=<span class="string">&quot;browsing-history-o&quot;</span> <span class="attr">color</span>=<span class="string">&quot;#ffa023&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-grid-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-grid-item</span> <span class="attr">text</span>=<span class="string">&quot;作品&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">slot</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">name</span>=<span class="string">&quot;edit&quot;</span> <span class="attr">color</span>=<span class="string">&quot;#678eff&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-grid-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-grid</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">:border</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;消息通知&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;小智同学&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">title</span>=<span class="string">&quot;退出登录&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">clickable</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /其它 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;MyPage&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.my-container</span> &#123;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.user-info-wrap</span> &#123;</span></span><br><span class="line">    background: url(&quot;./banner.png&quot;) no-repeat;</span><br><span class="line">    height: 182px;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">    background-size: cover;</span><br><span class="line">    padding: 40px 20px;</span><br><span class="line">    font-size: 15px;</span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.base-info-wrap</span> &#123;</span></span><br><span class="line">      display: flex;</span><br><span class="line">      justify-content: space-between;</span><br><span class="line">      align-items: center;</span><br><span class="line"><span class="css">      <span class="selector-class">.avatar-title-wrap</span> &#123;</span></span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: center;</span><br><span class="line"><span class="css">        <span class="selector-class">.avatar</span> &#123;</span></span><br><span class="line">          margin-right: 15px;</span><br><span class="line">          width: 66px;</span><br><span class="line">          height: 66px;</span><br><span class="line">          padding: 2px;</span><br><span class="line"><span class="css">          <span class="selector-tag">background</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.data-info</span> &#123;</span></span><br><span class="line"><span class="css">      <span class="selector-pseudo">::v-deep</span> <span class="selector-class">.van-grid-item__content</span> &#123;</span></span><br><span class="line">        background: none;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">  <span class="selector-class">.not-login</span> &#123;</span></span><br><span class="line">    background: url(&quot;./banner.png&quot;) no-repeat;</span><br><span class="line">    height: 182px;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">    background-size: cover;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    align-items: center;</span><br><span class="line">    flex-direction: column;</span><br><span class="line"><span class="css">    <span class="selector-class">.mobile</span> &#123;</span></span><br><span class="line">      background: url(&quot;./mobile.png&quot;) no-repeat;</span><br><span class="line">      background-size: cover;</span><br><span class="line">      width: 66px;</span><br><span class="line">      height: 66px;</span><br><span class="line">      margin-bottom: 10px;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.text</span> &#123;</span></span><br><span class="line">      font-size: 14px;</span><br><span class="line"><span class="css">      <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">  &gt; <span class="selector-class">.van-cell-group</span> &#123;</span></span><br><span class="line">    margin-top: 10px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="处理已登录和未登录的展示状态"><a href="#处理已登录和未登录的展示状态" class="headerlink" title="处理已登录和未登录的展示状态"></a>处理已登录和未登录的展示状态</h2><ul>
<li>未登录，展示登录按钮</li>
<li>已登录，展示登录用户信息</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 已登录：用户信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;$store.state.user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;user-info-wrap&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /已登录：用户信息 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 未登录 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span> <span class="attr">class</span>=<span class="string">&quot;not-login&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;$router.push(&#x27;/login&#x27;)&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /未登录 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 退出 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">v-if</span>=<span class="string">&quot;$store.state.user&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /退出 --&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="展示当前登录用户信息"><a href="#展示当前登录用户信息" class="headerlink" title="展示当前登录用户信息"></a>展示当前登录用户信息</h2><img src="https://yhx0507.github.io/wxapp_static/app/image-20200109133717775.png" class="">

<p>步骤：</p>
<ul>
<li>封装接口</li>
<li>请求获取数据</li>
<li>模板绑定</li>
</ul>
<p>1、在 <code>api/user.js</code> 中添加封装数据接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取当前登录用户个人信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getUserInfo = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;/app/v1_0/user&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在 <code>views/my/index.vue</code> 请求加载数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">import</span> &#123; getUserInfo &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/user&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;MyPage&#x27;</span>,</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">+      user: &#123;&#125; <span class="comment">// 用户信息</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">+++  created () &#123;</span><br><span class="line">    <span class="comment">// 初始化的时候，如果用户登录了，我才请求获取当前登录用户的信息</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.$store.state.user) &#123;</span><br><span class="line">      <span class="built_in">this</span>.loadUser()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">+++    <span class="keyword">async</span> loadUser () &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getUserInfo()</span><br><span class="line">        <span class="built_in">this</span>.user = data.data</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">        <span class="built_in">this</span>.$toast(<span class="string">&#x27;获取数据失败&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、模板绑定</p>
<h2 id="用户退出"><a href="#用户退出" class="headerlink" title="用户退出"></a>用户退出</h2><img src="https://yhx0507.github.io/wxapp_static/app/out-1578559616164.gif" class="">

<p>1、给退出按钮注册点击事件</p>
<p>2、退出处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onLogout () &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">this</span>.$dialog.confirm(&#123;</span><br><span class="line">    title: <span class="string">&#x27;退出提示&#x27;</span>,</span><br><span class="line">    message: <span class="string">&#x27;确认退出吗？&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 清除登录状态</span></span><br><span class="line">  <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;setUser&#x27;</span>, <span class="literal">null</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后测试。</p>
<h1 id="五、用户页面"><a href="#五、用户页面" class="headerlink" title="五、用户页面"></a>五、用户页面</h1><img src="https://yhx0507.github.io/wxapp_static/app/image-20200111104547462.png" class="">

<h2 id="准备-1"><a href="#准备-1" class="headerlink" title="准备"></a>准备</h2><h3 id="创建组件并配置路由"><a href="#创建组件并配置路由" class="headerlink" title="创建组件并配置路由"></a>创建组件并配置路由</h3><p>1、创建 <code>views/user/index.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;user-container&quot;</span>&gt;</span>用户页面<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;UserPage&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、配置到根路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: <span class="string">&#x27;/user/:userId&#x27;</span>,</span><br><span class="line">  name: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">  component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/user&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后访问 <code>/user/用户ID</code> 测试。</p>
<h3 id="页面布局"><a href="#页面布局" class="headerlink" title="页面布局"></a>页面布局</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;user-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">title</span>=<span class="string">&quot;黑马头条号&quot;</span> <span class="attr">left-arrow</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 用户信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;user-info-container&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;col1&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">fit</span>=<span class="string">&quot;cover&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">round</span></span></span><br><span class="line"><span class="tag">          <span class="attr">src</span>=<span class="string">&quot;https://img.yzcdn.cn/vant/cat.jpeg&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col2&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row1&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>发布<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>关注<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>粉丝<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;count&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>获赞<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;action&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">              <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">            &gt;</span>私信<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">              <span class="attr">type</span>=<span class="string">&quot;default&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">            &gt;</span>编辑资料<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;intro-wrap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>认证：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>用户的认证信息<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>简介：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>用户的简介信息<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /用户信息 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 文章列表 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /文章列表 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;UserPage&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.user-container</span> &#123;</span></span><br><span class="line">  font-size: 14px;</span><br><span class="line"><span class="css">  <span class="selector-class">.user-info-container</span> &#123;</span></span><br><span class="line">    padding: 12px;</span><br><span class="line"><span class="css">    <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">    margin-bottom: 10px;</span><br><span class="line"><span class="css">    &gt;<span class="selector-class">.row1</span> &#123;</span></span><br><span class="line">      display: flex;</span><br><span class="line">      justify-content: space-between;</span><br><span class="line">      align-items: center;</span><br><span class="line">      margin-bottom: 10px;</span><br><span class="line"><span class="css">      <span class="selector-class">.item</span> &#123;</span></span><br><span class="line">        text-align: center;</span><br><span class="line"><span class="css">        <span class="selector-class">.text</span> &#123;</span></span><br><span class="line">          font-size: 12px;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      &gt;<span class="selector-class">.col1</span> &#123;</span></span><br><span class="line">        width: 80px;</span><br><span class="line">        height: 80px;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      &gt;<span class="selector-class">.col2</span> &#123;</span></span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: column;</span><br><span class="line">        justify-content: space-evenly;</span><br><span class="line">        width: 70%;</span><br><span class="line">        height: 80px;</span><br><span class="line">        padding: 0 12px;</span><br><span class="line"><span class="css">        &gt;<span class="selector-class">.row1</span> &#123;</span></span><br><span class="line">          display: flex;</span><br><span class="line">          justify-content: space-between;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.action</span> &#123;</span></span><br><span class="line">          display: flex;</span><br><span class="line">          justify-content: space-between;</span><br><span class="line"><span class="css">          <span class="selector-class">.van-button</span> &#123;</span></span><br><span class="line">            width: 45%;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="展示用户信息"><a href="#展示用户信息" class="headerlink" title="展示用户信息"></a>展示用户信息</h2><p>步骤：</p>
<ul>
<li>封装数据接口</li>
<li>请求获取数据</li>
<li>模板绑定</li>
</ul>
<p>1、在 <code>api/user.js</code> 中添加获取指定用户信息的数据接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取指定用户信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getUserById = <span class="function"><span class="params">userId</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    url: <span class="string">`/app/v1_0/users/<span class="subst">$&#123;userId&#125;</span>`</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、在用户页面中请求获取数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">import</span> &#123; getUserById &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/user&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;UserPage&#x27;</span>,</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">+      user: &#123;&#125; <span class="comment">// 用户信息</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;</span><br><span class="line">+    <span class="built_in">this</span>.loadUser()</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">+++    <span class="keyword">async</span> loadUser () &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getUserById(<span class="built_in">this</span>.$route.params.userId)</span><br><span class="line">        <span class="built_in">this</span>.user = data.data</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">        <span class="built_in">this</span>.$toast(<span class="string">&#x27;获取用户数据失败&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、模板绑定</p>
<h2 id="展示用户文章列表"><a href="#展示用户文章列表" class="headerlink" title="展示用户文章列表"></a>展示用户文章列表</h2><h3 id="列表组件"><a href="#列表组件" class="headerlink" title="列表组件"></a>列表组件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;van-list</span><br><span class="line">  v-model=<span class="string">&quot;loading&quot;</span></span><br><span class="line">  :finished=<span class="string">&quot;finished&quot;</span></span><br><span class="line">  finished-text=<span class="string">&quot;没有更多了&quot;</span></span><br><span class="line">  @load=<span class="string">&quot;onLoad&quot;</span></span><br><span class="line">&gt;</span><br><span class="line">  &lt;van-cell</span><br><span class="line">    v-<span class="keyword">for</span>=<span class="string">&quot;item in list&quot;</span></span><br><span class="line">    :key=<span class="string">&quot;item&quot;</span></span><br><span class="line">    :title=<span class="string">&quot;item&quot;</span></span><br><span class="line">  /&gt;</span><br><span class="line">&lt;/van-list&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      list: [],</span><br><span class="line">      loading: <span class="literal">false</span>,</span><br><span class="line">      finished: <span class="literal">false</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    onLoad() &#123;</span><br><span class="line">      <span class="comment">// 异步更新数据</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">          <span class="built_in">this</span>.list.push(<span class="built_in">this</span>.list.length + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 加载状态结束</span></span><br><span class="line">        <span class="built_in">this</span>.loading = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数据全部加载完成</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.list.length &gt;= <span class="number">40</span>) &#123;</span><br><span class="line">          <span class="built_in">this</span>.finished = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="分析列表组件使用"><a href="#分析列表组件使用" class="headerlink" title="分析列表组件使用"></a>分析列表组件使用</h3><p>1、List 的运行机制是什么？</p>
<p>List 会监听浏览器的滚动事件并计算列表的位置，当列表底部与可视区域的距离小于offset时，List 会触发一次 load 事件。</p>
<p>2、为什么 List 初始化后会立即触发 load 事件？</p>
<p>List 初始化后会触发一次 load 事件，用于加载第一屏的数据，这个特性可以通过<code>immediate-check</code>属性关闭。</p>
<p>3、为什么会连续触发 load 事件？</p>
<p>如果一次请求加载的数据条数较少，导致列表内容无法铺满当前屏幕，List 会继续触发 load 事件，直到内容铺满屏幕或数据全部加载完成。因此你需要调整每次获取的数据条数，理想情况下每次请求获取的数据条数应能够填满一屏高度。</p>
<p>loading 和 finished 分别是什么含义？</p>
<blockquote>
<p><code>List</code>有以下三种状态，理解这些状态有助于你正确地使用<code>List</code>组件：</p>
<ul>
<li>非加载中，<code>loading</code>为<code>false</code>，此时会根据列表滚动位置判断是否触发<code>load</code>事件（列表内容不足一屏幕时，会直接触发）</li>
<li>加载中，<code>loading</code>为<code>true</code>，表示正在发送异步请求，此时不会触发<code>load</code>事件</li>
<li>加载完成，<code>finished</code>为<code>true</code>，此时不会触发<code>load</code>事件</li>
</ul>
<p>在每次请求完毕后，需要手动将<code>loading</code>设置为<code>false</code>，表示本次 load 加载结束</p>
</blockquote>
<p>4、使用 float 布局后一直触发加载？</p>
<p>若 List 的内容使用了 float 布局，可以在容器上添加van-clearfix类名来清除浮动，使得 List 能正确判断元素位置</p>
<h3 id="展示文章列表"><a href="#展示文章列表" class="headerlink" title="展示文章列表"></a>展示文章列表</h3><p>1、封装获取用户文章列表的数据接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取指定用户的文章列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getArticlesByUser = <span class="function">(<span class="params">userId, params</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    url: <span class="string">`/app/v1_0/users/<span class="subst">$&#123;userId&#125;</span>/articles`</span>,</span><br><span class="line">    params</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在用户页面中请求获取数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getUserById &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/user&#x27;</span></span><br><span class="line">+ <span class="keyword">import</span> &#123; getArticlesByUser &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/article&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;UserPage&#x27;</span>,</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      user: &#123;&#125;, <span class="comment">// 用户信息</span></span><br><span class="line">      list: [], <span class="comment">// 列表数据</span></span><br><span class="line">      loading: <span class="literal">false</span>, <span class="comment">// 控制上拉加载更多的 loading</span></span><br><span class="line">      finished: <span class="literal">false</span>, <span class="comment">// 控制是否加载结束了</span></span><br><span class="line">+      page: <span class="number">1</span> <span class="comment">// 获取下一页数据的页码</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;</span><br><span class="line">    <span class="built_in">this</span>.loadUser()</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="keyword">async</span> loadUser () &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getUserById(<span class="built_in">this</span>.$route.params.userId)</span><br><span class="line">        <span class="built_in">this</span>.user = data.data</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">        <span class="built_in">this</span>.$toast(<span class="string">&#x27;获取用户数据失败&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">+++    <span class="keyword">async</span> onLoad () &#123;</span><br><span class="line">      <span class="comment">// 1. 请求获取数据</span></span><br><span class="line">      <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getArticlesByUser(<span class="built_in">this</span>.$route.params.userId, &#123;</span><br><span class="line">        page: <span class="built_in">this</span>.page, <span class="comment">// 可选的，默认是第 1 页</span></span><br><span class="line">        per_page: <span class="number">20</span> <span class="comment">// 可选的，默认每页 10 条</span></span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 2. 把数据添加到列表中</span></span><br><span class="line">      <span class="comment">// list []</span></span><br><span class="line">      <span class="comment">// data.data.results []</span></span><br><span class="line">      <span class="comment">// ...[1, 2, 3] 会把数组给展开，所谓的展开就是一个一个的拿出来</span></span><br><span class="line">      <span class="keyword">const</span> &#123; results &#125; = data.data</span><br><span class="line">      <span class="built_in">this</span>.list.push(...results)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 3. 加载状态结束</span></span><br><span class="line">      <span class="built_in">this</span>.loading = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 4. 判断数据是否全部加载完毕</span></span><br><span class="line">      <span class="keyword">if</span> (results.length) &#123;</span><br><span class="line">        <span class="built_in">this</span>.page++ <span class="comment">// 更新获取下一页数据的页码</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.finished = <span class="literal">true</span> <span class="comment">// 没有数据了，不需要加载更多了</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="六、首页—文章列表"><a href="#六、首页—文章列表" class="headerlink" title="六、首页—文章列表"></a>六、首页—文章列表</h1><img src="https://yhx0507.github.io/wxapp_static/app/1566539328996.png" class="">

<p>该模块主要处理两部分：</p>
<ul>
<li>频道列表</li>
<li>频道的文章列表</li>
</ul>
<h2 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;nav-bar&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;search-btn&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">round</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">&quot;info&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">icon</span>=<span class="string">&quot;search&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span>搜索<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 频道列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-tabs</span> <span class="attr">v-model</span>=<span class="string">&quot;active&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-tab</span> <span class="attr">title</span>=<span class="string">&quot;标签 1&quot;</span>&gt;</span></span><br><span class="line">      	<span class="comment">&lt;!-- <span class="doctag">TODO:</span> 文章列表 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-tab</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-tab</span> <span class="attr">title</span>=<span class="string">&quot;标签 2&quot;</span>&gt;</span>内容 2<span class="tag">&lt;/<span class="name">van-tab</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-tab</span> <span class="attr">title</span>=<span class="string">&quot;标签 3&quot;</span>&gt;</span>内容 3<span class="tag">&lt;/<span class="name">van-tab</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-tab</span> <span class="attr">title</span>=<span class="string">&quot;标签 4&quot;</span>&gt;</span>内容 4<span class="tag">&lt;/<span class="name">van-tab</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-tabs</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /频道列表 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;HomePage&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      active: <span class="number">0</span> <span class="comment">// 控制标签页的激活项</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.home-container</span> &#123;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.nav-bar</span> &#123;</span></span><br><span class="line">    position: fixed;</span><br><span class="line">    top: 0;</span><br><span class="line">    left: 0;</span><br><span class="line">    right: 0;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">    padding: 0 15px;</span><br><span class="line">    height: 46px;</span><br><span class="line"><span class="css">    <span class="selector-tag">background-color</span>: <span class="selector-id">#3196fa</span>;</span></span><br><span class="line">    z-index: 1;</span><br><span class="line"><span class="css">    <span class="selector-class">.logo</span> &#123;</span></span><br><span class="line">      background: url(&quot;./logo-light.png&quot;) no-repeat;</span><br><span class="line">      background-size: cover;</span><br><span class="line">      width: 100px;</span><br><span class="line">      height: 30px;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.search-btn</span> &#123;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">background-color</span>: <span class="selector-id">#5babfb</span>;</span></span><br><span class="line">      width: 50%;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="展示频道列表"><a href="#展示频道列表" class="headerlink" title="展示频道列表"></a>展示频道列表</h2><p>思路：</p>
<ul>
<li>封装请求方法</li>
<li>请求获取数据</li>
<li>模板绑定</li>
</ul>
<p>1、在 <code>src/api/channel.js</code> 中新增一个请求方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取用户频道列表</span></span><br><span class="line"><span class="comment"> * 如果登录了：获取用户频道列表</span></span><br><span class="line"><span class="comment"> * 没有登录：获取默认推荐的频道列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getUserChannels = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;/app/v1_0/user/channels&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在首页中请求获取数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">import</span> &#123; getUserChannels &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/channel&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;HomePage&#x27;</span>,</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      active: <span class="number">0</span>,</span><br><span class="line">+      userChannels: [] <span class="comment">// 用户频道列表</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;</span><br><span class="line">+    <span class="built_in">this</span>.loadUserChannels()</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">+++    <span class="keyword">async</span> loadUserChannels () &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getUserChannels()</span><br><span class="line">      <span class="built_in">this</span>.userChannels = data.data.channels</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>提示：代码写完以后在浏览器的调试工具中查看是否能够加载获取到 channels 数据，确保能正常获取到数据以后，再进行模板绑定。</p>
</blockquote>
<p>3、拿到数据，渲染模板</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 频道标签列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-tabs</span> <span class="attr">v-model</span>=<span class="string">&quot;active&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-tab</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:title</span>=<span class="string">&quot;channel.name&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">&quot;channel.id&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">&quot;channel in channels&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; channel.name &#125;&#125; 频道内容<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-tab</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-tabs</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /频道标签列表 --&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="文章列表"><a href="#文章列表" class="headerlink" title="文章列表"></a>文章列表</h2><p>我们想要的功能是：</p>
<ul>
<li>当查看某个频道的时候才初始加载</li>
<li>加载过的不要重新加载</li>
</ul>
<p>就像手机版今日头条中的列表一样。</p>
<img src="https://yhx0507.github.io/wxapp_static/app/image-20200111124415227.png" class="">

<blockquote>
<p>你的思路</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/image-20200111124530323.png" class="">

<blockquote>
<p>多个列表</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/image-20200111124539391.png" class="">

<blockquote>
<p>封装组件。</p>
</blockquote>
<p>最好的方式就是封装组件，同样的外观，不同的数据。</p>
<h3 id="文章列表组件"><a href="#文章列表组件" class="headerlink" title="文章列表组件"></a>文章列表组件</h3><p>1、创建 <code>views/home/components/article-list.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; channel.name &#125;&#125;频道的文章列表<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;ArticleList&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line"><span class="javascript">    <span class="comment">// 频道对象，父组件提供</span></span></span><br><span class="line">    channel: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">      required: <span class="literal">true</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在首页中注册使用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;home-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">title</span>=<span class="string">&quot;首页&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 频道列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-tabs</span> <span class="attr">v-model</span>=<span class="string">&quot;active&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-tab</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:title</span>=<span class="string">&quot;channel.name&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">&quot;channel in userChannels&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:key</span>=<span class="string">&quot;channel.id&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">+        <span class="tag">&lt;<span class="name">article-list</span> <span class="attr">:channel</span>=<span class="string">&quot;channel&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-tab</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-tabs</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /频道列表 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; getUserChannels &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/user&#x27;</span></span></span><br><span class="line"><span class="javascript">+ <span class="keyword">import</span> ArticleList <span class="keyword">from</span> <span class="string">&#x27;./components/article-list&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;HomePage&#x27;</span>,</span></span><br><span class="line">  components: &#123;</span><br><span class="line">+    ArticleList</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="文章列表组件布局"><a href="#文章列表组件布局" class="headerlink" title="文章列表组件布局"></a>文章列表组件布局</h3><p>这里主要使用到 <a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/list">List 列表</a> 组件，该组件支持上拉加载更多功能。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-list</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-model</span>=<span class="string">&quot;loading&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:finished</span>=<span class="string">&quot;finished&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">finished-text</span>=<span class="string">&quot;没有更多了&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">load</span>=<span class="string">&quot;onLoad&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in list&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:key</span>=<span class="string">&quot;item&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:title</span>=<span class="string">&quot;item&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;ArticleList&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line"><span class="javascript">    <span class="comment">// 频道对象，父组件提供</span></span></span><br><span class="line">    channel: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">      required: <span class="literal">true</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      list: [], <span class="comment">// 列表数据</span></span></span><br><span class="line"><span class="javascript">      loading: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">      finished: <span class="literal">false</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    onLoad() &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 异步更新数据</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.list.push(<span class="built_in">this</span>.list.length + <span class="number">1</span>)</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="comment">// 加载状态结束</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.loading = <span class="literal">false</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 数据全部加载完成</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="built_in">this</span>.list.length &gt;= <span class="number">40</span>) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.finished = <span class="literal">true</span></span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, 500)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="加载文章列表"><a href="#加载文章列表" class="headerlink" title="加载文章列表"></a>加载文章列表</h3><p>实现思路：</p>
<ul>
<li>封装获取数据接口</li>
<li>请求加载</li>
<li>模板绑定</li>
</ul>
<p>1、创建 <code>src/api/article.js</code> 封装获取文章列表数据的接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章接口模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取频道的文章列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getArticles = <span class="function"><span class="params">params</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;/app/v1_1/articles&#x27;</span>,</span><br><span class="line">    params</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：使用接口文档中最下面的 <strong>频道新闻推荐_V1.1</strong></p>
</blockquote>
<p>2、然后在首页文章列表组件 <code>onload</code> 的时候请求加载文章列表</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-list</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-model</span>=<span class="string">&quot;loading&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:finished</span>=<span class="string">&quot;finished&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">finished-text</span>=<span class="string">&quot;没有更多了&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">load</span>=<span class="string">&quot;onLoad&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">+      <span class="attr">v-for</span>=<span class="string">&quot;(article, index) in list&quot;</span></span></span><br><span class="line"><span class="tag">+      <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span></span></span><br><span class="line"><span class="tag">+      <span class="attr">:title</span>=<span class="string">&quot;article.title&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">+ <span class="keyword">import</span> &#123; getArticles &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/article&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;ArticleList&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line"><span class="javascript">    <span class="comment">// 频道对象，父组件提供</span></span></span><br><span class="line">    channel: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">      required: <span class="literal">true</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      list: [], <span class="comment">// 列表数据</span></span></span><br><span class="line"><span class="javascript">      loading: <span class="literal">false</span>, <span class="comment">// 上拉加载更多的 loading 状态</span></span></span><br><span class="line"><span class="javascript">      finished: <span class="literal">false</span>, <span class="comment">// 数据是否加载完毕</span></span></span><br><span class="line"><span class="javascript">+      timestamp: <span class="literal">null</span> <span class="comment">// 用于获取下一页数据的时间戳</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">+++    <span class="keyword">async</span> onLoad () &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 1. 请求获取数据</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getArticles(&#123;</span></span><br><span class="line"><span class="javascript">        channel_id: <span class="built_in">this</span>.channel.id, <span class="comment">// 频道id</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 第1次使用 Date.now() 获取最新数据</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 下一页的数据使用本次返回的数据中的 timestamp</span></span></span><br><span class="line"><span class="javascript">        timestamp: <span class="built_in">this</span>.timestamp || <span class="built_in">Date</span>.now(), <span class="comment">// 时间戳，请求新的推荐数据传当前的时间戳，请求历史推荐传指定的时间戳</span></span></span><br><span class="line"><span class="javascript">        with_top: <span class="number">1</span> <span class="comment">// 是否包含置顶，进入页面第一次请求时要包含置顶文章，1-包含置顶，0-不包含</span></span></span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 2. 把请求获取到的数据添加到数组列表中</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> results = data.data.results</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.list.push(...results)</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 3. 加载状态结束</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.loading = <span class="literal">false</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 4. 数据全部加载完成</span></span></span><br><span class="line">      if (results.length) &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// 更新获取下一页数据的时间戳</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.timestamp = data.data.pre_timestamp</span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 没有数据了，把 finished 设置为 true，不再加载更多</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.finished = <span class="literal">true</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>标签页组件本身就具有延迟渲染的功能：</p>
<ul>
<li>首次切换到标签时才触发内容渲染</li>
<li>而且对于渲染过的就不再重新渲染</li>
</ul>
</blockquote>
<h3 id="下拉刷新"><a href="#下拉刷新" class="headerlink" title="下拉刷新"></a>下拉刷新</h3><img src="https://yhx0507.github.io/wxapp_static/app/list-pull.gif" class="">

<p>这里主要使用到 Vant 中的 <a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/pull-refresh">PullRefresh 下拉刷新</a> 组件。</p>
<p>思路：</p>
<ul>
<li>注册下拉刷新事件（组件）的处理函数</li>
<li>发送请求获取文章列表数据</li>
<li>把获取到的数据添加到当前频道的文章列表的顶部</li>
<li>提示用户刷新成功！</li>
</ul>
<p>下拉刷新时会触发组件的 <code>refresh</code> 事件，在事件的回调函数中可以进行同步或异步操作，操作完成后将 <code>v-model</code> 设置为 <code>false</code>，表示加载完成。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onRefresh () &#123;</span><br><span class="line">  <span class="comment">// 1. 请求获取数据</span></span><br><span class="line">  <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getArticles(&#123;</span><br><span class="line">    channel_id: <span class="built_in">this</span>.channel.id, <span class="comment">// 频道id</span></span><br><span class="line">    timestamp: <span class="built_in">Date</span>.now(), <span class="comment">// 时间戳，请求新的推荐数据传当前的时间戳，请求历史推荐传指定的时间戳</span></span><br><span class="line">    with_top: <span class="number">1</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 如果有最新数据，则把数据放到列表的顶部</span></span><br><span class="line">  <span class="keyword">const</span> &#123; results &#125; = data.data</span><br><span class="line">  <span class="built_in">this</span>.list.unshift(...results)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 关闭下拉刷新的 loading 状态</span></span><br><span class="line">  <span class="built_in">this</span>.isLoading = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 提示更新成功</span></span><br><span class="line">  <span class="built_in">this</span>.$toast(<span class="string">`更新了<span class="subst">$&#123;results.length&#125;</span>条数据`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="样式调整"><a href="#样式调整" class="headerlink" title="样式调整"></a>样式调整</h2><p>我们的需求：</p>
<ul>
<li>头部固定定位</li>
<li>频道列表固定定位</li>
</ul>
<p>1、让头部导航栏固定定位</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">title</span>=<span class="string">&quot;首页&quot;</span> <span class="attr">fixed</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、让频道列表固定定位</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.home-container</span> &#123;</span><br><span class="line">  /deep/ .van-tabs__wrap &#123;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">46px</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://vue-loader.vuejs.org/zh/guide/scoped-css.html">关于 .vue 文件中的作用域样式</a></p>
</blockquote>
<p>3、给页面容器添加上下内边距</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.home-container</span> &#123;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">90px</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>如果想要在父组件中影响子组件样式：</p>
<ul>
<li><p>要么不要有作用域，那就是全局，影响任何组件</p>
</li>
<li><p>如果有作用域</p>
<ul>
<li>默认只能影响到自子组件的根节点<ul>
<li>审查元素找到子组件根节点类名使用</li>
<li>或者手动给子组件添加一个 class，它会自动添加到子组件根节点的 class 中</li>
</ul>
</li>
<li>如果需要影响的更深，则使用深度选择器：<code>&gt;&gt;&gt;</code>、<code>/deep/</code>、<code>::v-deep</code><ul>
<li><code>&gt;&gt;&gt;</code> 在 less、sass、stylus 等 CSS 预处理器中会报错</li>
<li>所以建议使用 <code>/deep/</code> 或者 <code>::v-deep</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="七、首页—频道编辑"><a href="#七、首页—频道编辑" class="headerlink" title="七、首页—频道编辑"></a>七、首页—频道编辑</h1><img src="https://yhx0507.github.io/wxapp_static/app/1566541118035.png" class="">

<h2 id="准备-2"><a href="#准备-2" class="headerlink" title="准备"></a>准备</h2><h3 id="弹出层组件"><a href="#弹出层组件" class="headerlink" title="弹出层组件"></a>弹出层组件</h3><p>Vant 中内置了 <a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/popup">Popup 弹出层</a> 组件。</p>
<p>1、在首页模板中的频道列表后面添加弹出层组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">&quot;isChannelEditShow&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">&quot;bottom&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">closeable</span></span></span><br><span class="line"><span class="tag">  <span class="attr">close-icon-position</span>=<span class="string">&quot;top-left&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:style</span>=<span class="string">&quot;&#123; height: &#x27;100%&#x27; &#125;&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、然后在 <code>data</code>中添加一个数据用来控制弹层的显示和隐藏</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    isChannelEditShow: <span class="literal">true</span> <span class="comment">// 这里我们先设置为 true 就能看到弹窗的页面了</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>测试查看结果。</p>
<h3 id="点击面包按钮展示弹出层"><a href="#点击面包按钮展示弹出层" class="headerlink" title="点击面包按钮展示弹出层"></a>点击面包按钮展示弹出层</h3><p>通过标签页的插槽插入一个面包菜单图标到频道列表中。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-tabs</span> <span class="attr">v-model</span>=<span class="string">&quot;active&quot;</span>&gt;</span></span><br><span class="line">+  <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">+    <span class="attr">class</span>=<span class="string">&quot;wap-nav&quot;</span></span></span><br><span class="line"><span class="tag">+    <span class="attr">slot</span>=<span class="string">&quot;nav-right&quot;</span></span></span><br><span class="line"><span class="tag">+    <span class="attr">name</span>=<span class="string">&quot;wap-nav&quot;</span></span></span><br><span class="line"><span class="tag">+    @<span class="attr">click</span>=<span class="string">&quot;isChannelEditShow = true&quot;</span></span></span><br><span class="line"><span class="tag">+  /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-tab</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:title</span>=<span class="string">&quot;channel.name&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">&quot;channel in userChannels&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">&quot;channel.id&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">article-list</span> <span class="attr">:channel</span>=<span class="string">&quot;channel&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-tab</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-tabs</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：我们这里是把面包按钮通过 van-tabs 组件的 nav-right 插槽插入进去的。</p>
</blockquote>
<p>别忘了给它设置一下样式，定位到右侧不动：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.wap-nav</span> &#123;</span><br><span class="line">	<span class="attribute">position</span>: fixed;</span><br><span class="line">	<span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">line-height</span>: <span class="number">44px</span>;</span><br><span class="line">	<span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>测试查看结果。</p>
<h3 id="频道编辑组件"><a href="#频道编辑组件" class="headerlink" title="频道编辑组件"></a>频道编辑组件</h3><p>1、创建 <code>views/home/components/channel-edit.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;channel-edit&quot;</span>&gt;</span>频道编辑<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;ChannelEdit&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在首页中加载注册</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ChannelEdit <span class="keyword">from</span> <span class="string">&#x27;./components/channel-edit&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  components: &#123;</span><br><span class="line">    ...</span><br><span class="line">    ChannelEdit</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>3、在弹出层中使用频道编辑组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 频道编辑 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">&quot;isChannelEditShow&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">&quot;bottom&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">closeable</span></span></span><br><span class="line"><span class="tag">  <span class="attr">close-icon-position</span>=<span class="string">&quot;top-left&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:style</span>=<span class="string">&quot;&#123; height: &#x27;100%&#x27; &#125;&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">+  <span class="tag">&lt;<span class="name">channel-edit</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /频道编辑 --&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="组件布局"><a href="#组件布局" class="headerlink" title="组件布局"></a>组件布局</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;channel-edit&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;我的频道&quot;</span> <span class="attr">:border</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">round</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> <span class="attr">plain</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-grid</span> <span class="attr">:gutter</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-grid-item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">&quot;value in 8&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:key</span>=<span class="string">&quot;value&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">text</span>=<span class="string">&quot;文字&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-grid</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;推荐频道&quot;</span> <span class="attr">:border</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-grid</span> <span class="attr">:gutter</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-grid-item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">&quot;value in 8&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:key</span>=<span class="string">&quot;value&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">text</span>=<span class="string">&quot;文字&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-grid</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;ChannelEdit&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.channel-edit</span> &#123;</span></span><br><span class="line">  padding: 40px 0;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="展示我的频道"><a href="#展示我的频道" class="headerlink" title="展示我的频道"></a>展示我的频道</h2><p>1、父组件给子组件传递数据</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 频道编辑 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">&quot;isChannelEditShow&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">&quot;bottom&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">closeable</span></span></span><br><span class="line"><span class="tag">  <span class="attr">close-icon-position</span>=<span class="string">&quot;top-left&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:style</span>=<span class="string">&quot;&#123; height: &#x27;100%&#x27; &#125;&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">channel-edit</span></span></span><br><span class="line"><span class="tag">+		<span class="attr">:user-channels</span>=<span class="string">&quot;userChannels&quot;</span></span></span><br><span class="line"><span class="tag">	/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /频道编辑 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>2、在子组件中声明接收父组件的 <code>userChannels</code> 频道列表数据并遍历展示</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;channel-edit&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;我的频道&quot;</span> <span class="attr">:border</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">round</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> <span class="attr">plain</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-grid</span> <span class="attr">:gutter</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-grid-item</span></span></span><br><span class="line"><span class="tag">+        <span class="attr">v-for</span>=<span class="string">&quot;channel in userChannels&quot;</span></span></span><br><span class="line"><span class="tag">+        <span class="attr">:key</span>=<span class="string">&quot;channel.id&quot;</span></span></span><br><span class="line"><span class="tag">+        <span class="attr">:text</span>=<span class="string">&quot;channel.name&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-grid</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;推荐频道&quot;</span> <span class="attr">:border</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-grid</span> <span class="attr">:gutter</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-grid-item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">&quot;value in 8&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:key</span>=<span class="string">&quot;value&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">text</span>=<span class="string">&quot;文字&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-grid</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;ChannelEdit&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">+    userChannels: &#123;</span><br><span class="line"><span class="javascript">+      type: <span class="built_in">Array</span>,</span></span><br><span class="line"><span class="javascript">+      required: <span class="literal">true</span></span></span><br><span class="line">+    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.channel-edit</span> &#123;</span></span><br><span class="line">  padding: 40px 0;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>简单写法：props: []</p>
<p>推荐写法：props: {}</p>
</blockquote>
<h2 id="展示推荐频道列表"><a href="#展示推荐频道列表" class="headerlink" title="展示推荐频道列表"></a>展示推荐频道列表</h2><img src="https://yhx0507.github.io/wxapp_static/app/1571040968593.png" class="">

<p>没有用来获取推荐频道的数据接口，但是我们有获取所有频道列表的数据接口。</p>
<p>所以：<code>所有频道列表 - 我的频道 = 剩余推荐的频道</code>。</p>
<p>实现过程所以一共分为两大步：</p>
<ul>
<li>获取所有频道</li>
<li>基于所有频道和我的频道计算获取剩余的推荐频道</li>
</ul>
<h3 id="获取所有频道"><a href="#获取所有频道" class="headerlink" title="获取所有频道"></a>获取所有频道</h3><p>1、在 <code>src/api/channel.js</code> 中添加封装请求模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getAllChannels = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;/app/v1_0/channels&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、请求获取所有频道</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">import</span> &#123; getAllChannels &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/channel&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;ChannelEdit&#x27;</span>,</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    userChannels: &#123;</span><br><span class="line">      type: <span class="built_in">Array</span>,</span><br><span class="line">      required: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">+      allChannels: [] <span class="comment">// 所有频道</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;</span><br><span class="line">+    <span class="built_in">this</span>.loadAllChannels()</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">+    <span class="keyword">async</span> loadAllChannels () &#123;</span><br><span class="line">+      <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getAllChannels()</span><br><span class="line">+      <span class="built_in">this</span>.allChannels = data.data.channels</span><br><span class="line">+    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="处理获取展示剩余推荐频道"><a href="#处理获取展示剩余推荐频道" class="headerlink" title="处理获取展示剩余推荐频道"></a>处理获取展示剩余推荐频道</h3><p>思路：<code>剩余频道 = 所有频道 - 我的频道</code></p>
<ul>
<li>遍历所有频道</li>
<li>对每一个频道都判断：该频道是否属于我的频道</li>
<li>如果不属于我的频道，则收集起来</li>
<li>直到遍历结束，剩下来就是那些剩余的推荐频道</li>
</ul>
<p>1、封装一个<strong>计算属性</strong>用来获取剩余频道</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  remainingChannels () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; allChannels, userChannels &#125; = <span class="built_in">this</span></span><br><span class="line">    <span class="comment">// 剩余频道 = 所有频道 - 我的频道</span></span><br><span class="line">    <span class="keyword">const</span> channels = []</span><br><span class="line">    <span class="comment">// 遍历所有频道</span></span><br><span class="line">    allChannels.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 如果我的频道中不包含当前被遍历的频道，则要</span></span><br><span class="line">      <span class="keyword">if</span> (!userChannels.find(<span class="function"><span class="params">c</span> =&gt;</span> c.id === item.id)) &#123;</span><br><span class="line">        channels.push(item)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> channels</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、模板绑定进行展示</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;推荐频道&quot;</span> <span class="attr">:border</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-grid</span> <span class="attr">:gutter</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-grid-item</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">&quot;channel in remainingChannels&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">&quot;channel.id&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:text</span>=<span class="string">&quot;channel.name&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-grid</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="添加频道"><a href="#添加频道" class="headerlink" title="添加频道"></a>添加频道</h2><img src="https://yhx0507.github.io/wxapp_static/app/chanel-add.gif" class="">

<p>思路：</p>
<ul>
<li>给推荐频道列表中每一项注册点击事件</li>
<li>获取点击的频道项</li>
<li>将频道项添加到我的频道中</li>
<li><del>将当前点击的频道项从推荐频道中移除</del><ul>
<li>不需要删除，因为我们获取数据使用的是计算属性，当我频道发生改变，计算属性重新求值了</li>
</ul>
</li>
</ul>
<p>1、给推荐频道中的频道注册点击事件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 推荐频道 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;推荐频道&quot;</span> <span class="attr">:border</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-grid</span> <span class="attr">:gutter</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-grid-item</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">&quot;channel in recommendChannels&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">&quot;channel.id&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:text</span>=<span class="string">&quot;channel.name&quot;</span></span></span><br><span class="line"><span class="tag">    + @<span class="attr">click</span>=<span class="string">&quot;onChannelAdd(channel)&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-grid</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /推荐频道 --&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在添加频道事件处理函数中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">onChannelAdd (channel) &#123;</span><br><span class="line">  <span class="comment">// 将点击的频道项添加到我的频道列表中</span></span><br><span class="line">  <span class="built_in">this</span>.channels.push(channel)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 不需要删除，我的频道改变，计算属性 recommendChannels 重新调用求值</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后你会神奇的发现点击的那个推荐频道跑到我的频道中了，我们并没有去手动的删除点击的这个推荐频道，但是它没了！主要是因为推荐频道是通过一个计算属性获取的，计算属性中使用了 channels（我的频道）数据，所以只要我的频道中的数据发生变化，那么计算属性就会重新运算获取最新的数据。</p>
<h2 id="编辑频道"><a href="#编辑频道" class="headerlink" title="编辑频道"></a>编辑频道</h2><h3 id="处理编辑状态"><a href="#处理编辑状态" class="headerlink" title="处理编辑状态"></a>处理编辑状态</h3><p>1、在 data 中添加数据用来控制关闭按钮的显示隐藏</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    isEditShow: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>2、通过组件插槽将关闭图标放到频道项中</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-grid</span> <span class="attr">:gutter</span>=<span class="string">&quot;10&quot;</span> <span class="attr">clickable</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-grid-item</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">&quot;(channel, index) in userChannels&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">&quot;channel.id&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:text</span>=<span class="string">&quot;channel.name&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click</span>=<span class="string">&quot;onUserChannelClick(index)&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">v-show</span>=<span class="string">&quot;isEditShow &amp;&amp; index !== 0&quot;</span> <span class="attr">slot</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">name</span>=<span class="string">&quot;close&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-grid-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-grid</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、将关闭的图标定位到频道项的右上角</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/deep/ .van-grid-item__icon-wrapper &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: -<span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">right</span>: -<span class="number">5px</span>;</span><br><span class="line">  <span class="selector-class">.van-icon-close</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4、处理编辑按钮</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">  <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">round</span></span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">plain</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">click</span>=<span class="string">&quot;isEditShow = !isEditShow&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span>&#123;&#123; isEditShow ? &#x27;完成&#x27; : &#x27;编辑&#x27;&#125;&#125;<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后测试。</p>
<h3 id="删除频道"><a href="#删除频道" class="headerlink" title="删除频道"></a>删除频道</h3><p>两个功能需求：</p>
<ul>
<li>切换频道</li>
<li>删除频道</li>
</ul>
<p>1、给我的频道中的频道项注册点击事件</p>
<p>2、处理函数如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">onUserChannelClick (index) &#123;</span><br><span class="line">  <span class="comment">// 如果是编辑状态，则执行删除操作</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.isEditShow &amp;&amp; index !== <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.userChannels.splice(index, <span class="number">1</span>) <span class="comment">// 从索引处开始(包括索引本身)，删除指定的个数</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 如果是非编辑状态，则执行切换频道操作</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后测试结果。</p>
<h3 id="切换频道"><a href="#切换频道" class="headerlink" title="切换频道"></a>切换频道</h3><p>1、在父组件中</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  这里使用 v-model 绑定了 active 数据</span></span><br><span class="line"><span class="comment">		子组件在内部需要声明 value 属性接收使用</span></span><br><span class="line"><span class="comment">		子组件需要在内部通过 this.$emit(&#x27;input&#x27;, 数据) 修改该数据</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">channel-edit</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:user-channels</span>=<span class="string">&quot;userChannels&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">:value</span>=<span class="string">&quot;active&quot;</span></span></span><br><span class="line"><span class="tag">	@<span class="attr">input</span>=<span class="string">&quot;active = $event&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">close</span>=<span class="string">&quot;isChannelEditShow = false&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 这里的写法等价于上面的写法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">channel-edit</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:user-channels</span>=<span class="string">&quot;userChannels&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">v-model</span>=<span class="string">&quot;active&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">close</span>=<span class="string">&quot;isChannelEditShow = false&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><a href="%5Bhttps://cn.vuejs.org/v2/guide/components-custom-events.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E7%9A%84-v-model%5D(https://cn.vuejs.org/v2/guide/components-custom-events.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E7%9A%84-v-model)">在组件上使用 v-model</a></p>
</blockquote>
<p>2、然后在子组件中切换频道</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">onUserChannelClick (index) &#123;</span><br><span class="line">  <span class="comment">// 如果是编辑状态，则删除频道</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.isEditShow) &#123;</span><br><span class="line">    <span class="built_in">this</span>.userChannels.splice(index, <span class="number">1</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 如果是非编辑状态，则切换频道</span></span><br><span class="line">    <span class="built_in">this</span>.$emit(<span class="string">&#x27;input&#x27;</span>, index) <span class="comment">// 修改激活的标签</span></span><br><span class="line">    <span class="built_in">this</span>.$emit(<span class="string">&#x27;close&#x27;</span>) <span class="comment">// 关闭弹层</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、最后测试结果</p>
<h2 id="频道数据持久化"><a href="#频道数据持久化" class="headerlink" title="频道数据持久化"></a>频道数据持久化</h2><p>正常的话我们需要调用接口对数据进行持久化存储，但是这里的项目接口暂时有问题。</p>
<p>我们这里先用本地存储来处理一下。</p>
<p>1、当我们添加或是删除频道的时候都需要对频道数据进行持久化，一种方式就是在分别在添加和删除或者比的修改 channels 数据变化的地方调用本次存储存储数据；一种方式，我们可以使用 Vue 中的 watch 功能来监视频道数据的变化，当数据发生改变，就把数据重新存储到本地存储。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getItem, setItem &#125; <span class="keyword">from</span> <span class="string">&quot;@/utils/storage&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">watch: &#123;</span><br><span class="line">  <span class="comment">// 当 userChannels 发生改变的时候，将该数据存储到本地存储</span></span><br><span class="line">  userChannels () &#123;</span><br><span class="line">    setItem(<span class="string">&#x27;user-channels&#x27;</span>, <span class="built_in">this</span>.userChannels)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、因为我们把数据持久化到了本次存储，所以我们需要在页面初始化的时候优先从本地存储来获取频道数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简单一句话：优先使用本地的，没有就使用线上的</span></span><br><span class="line"><span class="keyword">async</span> loadUserChannels () &#123;</span><br><span class="line">  <span class="comment">// 1. 定义一个变量用来存储频道列表</span></span><br><span class="line">  <span class="keyword">let</span> channels = []</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 获取本地存储的频道列表</span></span><br><span class="line">  <span class="keyword">const</span> localUserChannles = getItem(<span class="string">&#x27;user-channels&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 如果本地存储有，就使用本地存储的</span></span><br><span class="line">  <span class="keyword">if</span> (localUserChannles) &#123;</span><br><span class="line">    channels = localUserChannles</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 4. 如果本地存储没有，则请求获取接口推荐的频道列表</span></span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getUserChannels()</span><br><span class="line">    channels = data.data.channels</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 5. 最后，把数据赋值到当前组件中</span></span><br><span class="line">  <span class="built_in">this</span>.userChannels = channels</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="八、文章搜索"><a href="#八、文章搜索" class="headerlink" title="八、文章搜索"></a>八、文章搜索</h1><img src="https://yhx0507.github.io/wxapp_static/app/1566431801892.png" class="">

<img src="https://yhx0507.github.io/wxapp_static/app/wx_20190828082340.jpg" class="">


<h2 id="准备-3"><a href="#准备-3" class="headerlink" title="准备"></a>准备</h2><h3 id="创建组件并配置路由-1"><a href="#创建组件并配置路由-1" class="headerlink" title="创建组件并配置路由"></a>创建组件并配置路由</h3><p>1、创建 <code>src/views/search/index.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;search-container&quot;</span>&gt;</span>搜索页面<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;SearchPage&quot;</span>,</span></span><br><span class="line">    components: &#123;&#125;,</span><br><span class="line">    props: &#123;&#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;&#125;;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;&#125;,</span><br><span class="line">    watch: &#123;&#125;,</span><br><span class="line">    created() &#123;&#125;,</span><br><span class="line">    methods: &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、然后把搜索页面的路由配置到根组件路由（一级路由）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: <span class="string">&#x27;/search&#x27;</span>,</span><br><span class="line">  omponent: Search</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后访问 <code>/search</code> 测试。</p>
<h3 id="页面布局-1"><a href="#页面布局-1" class="headerlink" title="页面布局"></a>页面布局</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;search-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 搜索栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-search</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model</span>=<span class="string">&quot;searchContent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">placeholder</span>=<span class="string">&quot;请输入搜索关键词&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">show-action</span></span></span><br><span class="line"><span class="tag">				<span class="attr">background</span>=<span class="string">&quot;#3296fa&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">search</span>=<span class="string">&quot;onSearch&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">cancel</span>=<span class="string">&quot;onCancel&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /搜索栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 联想建议 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">icon</span>=<span class="string">&quot;search&quot;</span> <span class="attr">title</span>=<span class="string">&quot;单元格&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">icon</span>=<span class="string">&quot;search&quot;</span> <span class="attr">title</span>=<span class="string">&quot;单元格&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">icon</span>=<span class="string">&quot;search&quot;</span> <span class="attr">title</span>=<span class="string">&quot;单元格&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">icon</span>=<span class="string">&quot;search&quot;</span> <span class="attr">title</span>=<span class="string">&quot;单元格&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">icon</span>=<span class="string">&quot;search&quot;</span> <span class="attr">title</span>=<span class="string">&quot;单元格&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">icon</span>=<span class="string">&quot;search&quot;</span> <span class="attr">title</span>=<span class="string">&quot;单元格&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /联想建议 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 历史记录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;历史记录&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">&quot;delete&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>全部删除<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>完成<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;单元格&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">&quot;close&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">van-icon</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;单元格&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">&quot;close&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">van-icon</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;单元格&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">&quot;close&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">van-icon</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;单元格&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">&quot;close&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">van-icon</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;单元格&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">&quot;close&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">van-icon</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /历史记录 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 搜索结果 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-list</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">&quot;loading&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:finished</span>=<span class="string">&quot;finished&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">finished-text</span>=<span class="string">&quot;没有更多了&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">load</span>=<span class="string">&quot;onLoad&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">&quot;item in list&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:key</span>=<span class="string">&quot;item&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:title</span>=<span class="string">&quot;item&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-list</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /搜索结果 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;SearchPage&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      searchContent: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 搜索内容</span></span></span><br><span class="line">      list: [],</span><br><span class="line"><span class="javascript">      loading: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">      finished: <span class="literal">false</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    onSearch () &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;onSearch&#x27;</span>)</span></span><br><span class="line">    &#125;,</span><br><span class="line">    onCancel () &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;onCancel&#x27;</span>)</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    onLoad () &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 异步更新数据</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.list.push(<span class="built_in">this</span>.list.length + <span class="number">1</span>)</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="comment">// 加载状态结束</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.loading = <span class="literal">false</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 数据全部加载完成</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="built_in">this</span>.list.length &gt;= <span class="number">40</span>) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.finished = <span class="literal">true</span></span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, 500)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.search-container</span> &#123;</span></span><br><span class="line">  padding-top: 54px;</span><br><span class="line">  // 让搜索栏固定在顶部</span><br><span class="line"><span class="css">  <span class="selector-class">.search-form</span> &#123;</span></span><br><span class="line">    position: fixed;</span><br><span class="line">    top: 0;</span><br><span class="line">    left: 0;</span><br><span class="line">    right: 0;</span><br><span class="line">    z-index: 1;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.van-search__action</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="处理-历史记录-联想建议-搜索结果-显示状态"><a href="#处理-历史记录-联想建议-搜索结果-显示状态" class="headerlink" title="处理(历史记录/联想建议/搜索结果)显示状态"></a>处理(历史记录/联想建议/搜索结果)显示状态</h2><p>1、在 <code>data</code> 中添加数据用来控制搜索结果的显示状态</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  ...</span><br><span class="line">  isResultShow: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在模板中绑定条件渲染</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 搜索结果 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">search-result</span> <span class="attr">v-if</span>=<span class="string">&quot;isResultShow&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /搜索结果 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 联想建议 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">v-else-if</span>=<span class="string">&quot;searchText&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /联想建议 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 历史记录 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /历史记录 --&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="搜索联想建议"><a href="#搜索联想建议" class="headerlink" title="搜索联想建议"></a>搜索联想建议</h2><p>思路：</p>
<ul>
<li>当搜索输入变化的时候，请求加载联想建议的数据</li>
<li>将请求得到的结果绑定到模板中</li>
</ul>
<p>1、封装数据接口，创建 <code>api/serach.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getSuggestions = <span class="function"><span class="params">q</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;/app/v1_0/suggestion&#x27;</span>,</span><br><span class="line">    params: &#123;</span><br><span class="line">      q</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、给搜索组件注册 <code>input</code> 事件</p>
<p>3、在事件处理函数中请求获取数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SearchResult <span class="keyword">from</span> <span class="string">&#x27;./components/search-result&#x27;</span></span><br><span class="line">+ <span class="keyword">import</span> &#123; getSuggestions &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/search&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;SearchPage&#x27;</span>,</span><br><span class="line">  components: &#123;</span><br><span class="line">    SearchResult</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      searchText: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      isResultShow: <span class="literal">false</span>,</span><br><span class="line">+      suggestions: [] <span class="comment">// 联想建议列表</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    onSearch () &#123;</span><br><span class="line">      <span class="built_in">this</span>.isResultShow = <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">+++    <span class="keyword">async</span> onSearchInput () &#123;</span><br><span class="line">      <span class="keyword">const</span> searchText = <span class="built_in">this</span>.searchText</span><br><span class="line">      <span class="keyword">if</span> (!searchText) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getSuggestions(searchText)</span><br><span class="line">      <span class="built_in">this</span>.suggestions = data.data.options</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4、模板绑定</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 联想建议 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">v-else-if</span>=<span class="string">&quot;searchText&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:title</span>=<span class="string">&quot;item&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">icon</span>=<span class="string">&quot;search&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in suggestions&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /联想建议 --&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="搜索关键字高亮"><a href="#搜索关键字高亮" class="headerlink" title="搜索关键字高亮"></a>搜索关键字高亮</h3><p>如何将字符串中的指定字符在<strong>网页</strong>中高亮展示？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将需要高亮的字符包裹 HTML 标签，为其单独设置颜色。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;Hello &lt;span style=&quot;</span>color: red<span class="string">&quot;&gt;World&lt;/span&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在 Vue 中如何渲染带有 HTML 标签的字符串？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    htmlStr: <span class="string">&#x27;Hello &lt;span style=&quot;color: red&quot;&gt;World&lt;/span&gt;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; htmlStr &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-html</span>=<span class="string">&quot;htmlStr&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="https://yhx0507.github.io/wxapp_static/app/image-20200112154732044.png" class="">

<p>如何把字符串中指定字符统一替换为高亮（包裹了 HTML）的字符？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&quot;Hello World&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果：&lt;span style=&quot;color: red&quot;&gt;Hello&lt;/span&gt; World</span></span><br><span class="line"><span class="string">&quot;Hello World&quot;</span>.replace(<span class="string">&#x27;Hello&#x27;</span>, <span class="string">&#x27;&lt;span style=&quot;color: red&quot;&gt;Hello&lt;/span&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要注意的是，replace 方法的字符串匹配只能替换第1个满足的字符</span></span><br><span class="line"><span class="comment">// &lt;span style=&quot;color: red&quot;&gt;Hello&lt;/span&gt; World Hello abc</span></span><br><span class="line"><span class="string">&quot;Hello World Hello abc&quot;</span>.replace(<span class="string">&#x27;Hello&#x27;</span>, <span class="string">&#x27;&lt;span style=&quot;color: red&quot;&gt;Hello&lt;/span&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果想要全文替换，使用正则表达式</span></span><br><span class="line"><span class="comment">// g 全局</span></span><br><span class="line"><span class="comment">// i 忽略大小写</span></span><br><span class="line"><span class="comment">// &lt;span style=&quot;color: red&quot;&gt;Hello&lt;/span&gt; World &lt;span style=&quot;color: red&quot;&gt;Hello&lt;/span&gt; abc</span></span><br><span class="line"><span class="string">&quot;Hello World Hello abc&quot;</span>.replace(<span class="regexp">/Hello/gi</span>, <span class="string">&#x27;&lt;span style=&quot;color: red&quot;&gt;Hello&lt;/span&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>一个小扩展：使用字符串的 split 结合数组的 join 方法实现高亮</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&quot;hello world 你好 hello&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// [&quot;&quot;, &quot; world 你好 &quot;, &quot;&quot;]</span></span><br><span class="line"><span class="keyword">const</span> arr = str.split(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;&lt;span&gt;hello&lt;/span&gt; world 你好 &lt;span&gt;hello&lt;/span&gt;&quot;</span></span><br><span class="line">arr.join(<span class="string">&quot;&lt;span&gt;hello&lt;/span&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<p>下面是具体的处理。</p>
<p>1、在 methods 中添加一个方法处理高亮</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数 source: 原始字符串</span></span><br><span class="line"><span class="comment">// 参数 keyword: 需要高亮的关键词</span></span><br><span class="line"><span class="comment">// 返回值：替换之后的高亮字符串</span></span><br><span class="line">highlight (source, keyword) &#123;</span><br><span class="line">  <span class="comment">// /searchContent/ 正则表达式中的一切内容都会当做字符串使用</span></span><br><span class="line">  <span class="comment">// 这里可以 new RegExp 方式根据字符串创建一个正则表达式</span></span><br><span class="line">  <span class="comment">// RegExp 是原生 JavaScript 的内置构造函数</span></span><br><span class="line">  <span class="comment">// 参数1：字符串，注意，这里不要加 //</span></span><br><span class="line">  <span class="comment">// 参数2：匹配模式，g 全局，i 忽略大小写</span></span><br><span class="line">  <span class="keyword">const</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(keyword, <span class="string">&#x27;gi&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> source.replace(reg, <span class="string">`&lt;span style=&quot;color: #3296fa&quot;&gt;<span class="subst">$&#123;keyword&#125;</span>&lt;/span&gt;`</span>)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、然后在联想建议列表项中绑定调用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 联想建议 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">v-else-if</span>=<span class="string">&quot;searchContent&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">    <span class="attr">icon</span>=<span class="string">&quot;search&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in suggestions&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click</span>=<span class="string">&quot;onSearch(item)&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span> <span class="attr">v-html</span>=<span class="string">&quot;highlight(item, searchContent)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /联想建议 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="防抖处理（最后处理）"><a href="#防抖处理（最后处理）" class="headerlink" title="防抖处理（最后处理）"></a>防抖处理（最后处理）</h3><p>1、安装 lodash</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yarn add lodash</span></span><br><span class="line">npm i lodash</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、防抖处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lodash 支持按需加载，有利于打包结果优化</span></span><br><span class="line"><span class="keyword">import</span> &#123; debounce &#125; <span class="keyword">from</span> <span class="string">&quot;lodash&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>不建议下面这样使用，因为这样会加载整个模块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line">_.debounce()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// debounce 函数</span></span><br><span class="line"><span class="comment">// 参数1：函数</span></span><br><span class="line"><span class="comment">// 参数2：防抖时间</span></span><br><span class="line"><span class="comment">// 返回值：防抖之后的函数，和参数1功能是一样的</span></span><br><span class="line">onSearchInput: debounce(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> searchContent = <span class="built_in">this</span>.searchContent</span><br><span class="line">  <span class="keyword">if</span> (!searchContent) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. 请求获取数据</span></span><br><span class="line">  <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getSuggestions(searchContent)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 将数据添加到组件实例中</span></span><br><span class="line">  <span class="built_in">this</span>.suggestions = data.data.options</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 模板绑定</span></span><br><span class="line">&#125;, <span class="number">200</span>),</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="搜索结果"><a href="#搜索结果" class="headerlink" title="搜索结果"></a>搜索结果</h2><p>思路：</p>
<ul>
<li>请求获取数据</li>
<li>将数据展示到模板中</li>
</ul>
<p>一、获取搜索关键字</p>
<p>1、声明接收父组件中的搜索框输入的内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">props: &#123;</span><br><span class="line">  q: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    <span class="built_in">require</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>2、在父组件给子组件传递数据</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 搜索结果 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">search-result</span> <span class="attr">v-if</span>=<span class="string">&quot;isResultShow&quot;</span> <span class="attr">:q</span>=<span class="string">&quot;searchText&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /搜索结果 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>最后在调试工具中查看确认是否接收到 props 数据。</p>
<img src="https://yhx0507.github.io/wxapp_static/app/image-20200112162223915.png" class="">

<p>二、请求获取数据</p>
<p>1、在 <code>api/serach.js</code> 添加封装获取搜索结果的请求方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取搜索结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getSearch</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    url: <span class="string">&quot;/app/v1_0/search&quot;</span>,</span><br><span class="line">    params</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、请求获取</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">import</span> &#123; getSearch &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/search&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;SearchResult&#x27;</span>,</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    q: &#123;</span><br><span class="line">      type: <span class="built_in">String</span>,</span><br><span class="line">      <span class="built_in">require</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      list: [],</span><br><span class="line">      loading: <span class="literal">false</span>,</span><br><span class="line">      finished: <span class="literal">false</span>,</span><br><span class="line">+      page: <span class="number">1</span>,</span><br><span class="line">+      perPage: <span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">+++    <span class="keyword">async</span> onLoad () &#123;</span><br><span class="line">      <span class="comment">// 1. 请求获取数据</span></span><br><span class="line">      <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getSearch(&#123;</span><br><span class="line">        page: <span class="built_in">this</span>.page, <span class="comment">// 页码</span></span><br><span class="line">        per_page: <span class="built_in">this</span>.perPage, <span class="comment">// 每页大小</span></span><br><span class="line">        q: <span class="built_in">this</span>.q <span class="comment">// 搜索关键字</span></span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 2. 将数据添加到列表中</span></span><br><span class="line">      <span class="keyword">const</span> &#123; results &#125; = data.data</span><br><span class="line">      <span class="built_in">this</span>.list.push(...results)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 3. 设置加载状态结束</span></span><br><span class="line">      <span class="built_in">this</span>.loading = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 4. 判断数据是否加载完毕</span></span><br><span class="line">      <span class="keyword">if</span> (results.length) &#123;</span><br><span class="line">        <span class="built_in">this</span>.page++ <span class="comment">// 更新获取下一页数据的页码</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.finished = <span class="literal">true</span> <span class="comment">// 没有数据了，将加载状态设置结束，不再 onLoad</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>三、最后，模板绑定</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-list</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">&quot;loading&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:finished</span>=<span class="string">&quot;finished&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">finished-text</span>=<span class="string">&quot;没有更多了&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">load</span>=<span class="string">&quot;onLoad&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">+    <span class="attr">v-for</span>=<span class="string">&quot;(article, index) in list&quot;</span></span></span><br><span class="line"><span class="tag">+    <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span></span></span><br><span class="line"><span class="tag">+    <span class="attr">:title</span>=<span class="string">&quot;article.title&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-list</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="搜索历史记录"><a href="#搜索历史记录" class="headerlink" title="搜索历史记录"></a>搜索历史记录</h2><h3 id="添加历史记录"><a href="#添加历史记录" class="headerlink" title="添加历史记录"></a>添加历史记录</h3><p>当发生搜索的时候我们才需要记录历史记录。</p>
<p>1、在 data 中添加一个数据用来存储历史记录</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    searchHistories: []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在触发搜索的时候，记录历史记录</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">onSearch (q) &#123;</span><br><span class="line">  <span class="comment">// 1. 更新搜索文本框的数据</span></span><br><span class="line">  <span class="built_in">this</span>.searchContent = q</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 记录搜索历史记录</span></span><br><span class="line">  <span class="keyword">const</span> searchHistories = <span class="built_in">this</span>.searchHistories</span><br><span class="line">  <span class="keyword">const</span> index = searchHistories.indexOf(q)</span><br><span class="line">  <span class="keyword">if</span> (index !== <span class="number">-1</span>) &#123;</span><br><span class="line">    searchHistories.splice(index)</span><br><span class="line">  &#125;</span><br><span class="line">  searchHistories.unshift(q)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 展示搜索结果</span></span><br><span class="line">  <span class="built_in">this</span>.isSearchResultShow = <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="展示历史记录"><a href="#展示历史记录" class="headerlink" title="展示历史记录"></a>展示历史记录</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 历史记录 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;历史记录&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">&quot;delete&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>全部删除<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>完成<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:title</span>=<span class="string">&quot;item&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in searchHistories&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">name</span>=<span class="string">&quot;close&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">van-icon</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /历史记录 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="删除历史记录"><a href="#删除历史记录" class="headerlink" title="删除历史记录"></a>删除历史记录</h3><p>一、处理删除相关元素的展示状态</p>
<p>1、在 data 中添加一个数据用来控制删除相关元素的显示状态</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    isDeleteShow: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、绑定使用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 历史记录 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;历史记录&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;isDeleteShow&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> @<span class="attr">click</span>=<span class="string">&quot;searchHistories = []&quot;</span>&gt;</span>全部删除<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> @<span class="attr">click</span>=<span class="string">&quot;isDeleteShow = false&quot;</span>&gt;</span>完成<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">v-else</span> <span class="attr">name</span>=<span class="string">&quot;delete&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;isDeleteShow = true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">van-icon</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:title</span>=<span class="string">&quot;item&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in searchHistories&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click</span>=<span class="string">&quot;onSearch(item)&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-show</span>=<span class="string">&quot;isDeleteShow&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">name</span>=<span class="string">&quot;close&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">click</span>=<span class="string">&quot;searchHistories.splice(index, 1)&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">van-icon</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /历史记录 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>二、处理删除操作</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 历史记录 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;历史记录&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;isDeleteShow&quot;</span>&gt;</span></span><br><span class="line">+      <span class="tag">&lt;<span class="name">span</span> @<span class="attr">click</span>=<span class="string">&quot;searchHistories = []&quot;</span>&gt;</span>全部删除<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> @<span class="attr">click</span>=<span class="string">&quot;isDeleteShow = false&quot;</span>&gt;</span>完成<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">v-else</span> <span class="attr">name</span>=<span class="string">&quot;delete&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;isDeleteShow = true&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:title</span>=<span class="string">&quot;item&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in searchHistories&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span></span></span><br><span class="line"><span class="tag">+    @<span class="attr">click</span>=<span class="string">&quot;onHistoryClick(item, index)&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">v-show</span>=<span class="string">&quot;isDeleteShow&quot;</span> <span class="attr">name</span>=<span class="string">&quot;close&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">van-icon</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /历史记录 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">onHistoryClick (item, index) &#123;</span><br><span class="line">  <span class="comment">// 如果是删除状态，则执行删除操作</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.isDeleteShow) &#123;</span><br><span class="line">    <span class="built_in">this</span>.searchHistories.splice(index, <span class="number">1</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 否则执行搜索操作</span></span><br><span class="line">    <span class="built_in">this</span>.onSearch(item)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="数据持久化"><a href="#数据持久化" class="headerlink" title="数据持久化"></a>数据持久化</h3><p>1、利用 watch 监视统一存储数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">watch: &#123;</span><br><span class="line">  searchHistories (val) &#123;</span><br><span class="line">    <span class="comment">// 同步到本地存储</span></span><br><span class="line">    setItem(<span class="string">&#x27;serach-histories&#x27;</span>, val)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>2、初始化的时候从本地存储获取数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    searchHistories: getItem(<span class="string">&#x27;serach-histories&#x27;</span>) || [],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="扩展：函数防抖和函数节流"><a href="#扩展：函数防抖和函数节流" class="headerlink" title="扩展：函数防抖和函数节流"></a>扩展：函数防抖和函数节流</h2><p>干嘛的？限制函数调用的频率。</p>
<p>为什么要限制？例如搜索的时候请求联想建议，没必要每次内容改变就发请求，当用户输入的很快的时候，中间的请求都是无意义的，浪费资源，没必要。</p>
<h3 id="函数防抖（Debounce）"><a href="#函数防抖（Debounce）" class="headerlink" title="函数防抖（Debounce）"></a>函数防抖（Debounce）</h3><p><strong>概念：</strong> <code>在事件被触发n秒后再执行，如果在这n秒内又被触发，则重新计时。</code></p>
<p><strong>生活中的实例：</strong> <code>如果有人进电梯（触发事件），那电梯将在10秒钟后出发（执行事件监听器），这时如果又有人进电梯了（在10秒内再次触发该事件），我们又得等10秒再出发（重新计时）。</code></p>
<p>我们先使用第三方包 <a href="">lodash</a> 来体验什么是函数防抖：</p>
<p>首先把 lodash 安装到项目中：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yarn add lodash</span></span><br><span class="line">npm i lodash</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/lodash/lodash.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// lodash 会在全局提供一个成员：_</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// _ 对象中有很多方法，其中有一个方法专门用于处理函数防抖</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 方法名：debounce</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 作用：函数防抖</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 使用方式：</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">foo</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;hello&quot;</span>, foo);</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 正常的函数调用：立即调用，而且是一定会调用</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// fn()</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// fn()</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// fn()</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 我们可以使用函数防抖把一个正常的函数变得不正常</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 两个参数：</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//   参数1：函数</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//   参数2：时间，单位是毫秒</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 返回值：函数</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//   返回值函数的功能和 fn 和的功能是一样</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//   唯一的区别就是经过了防抖处理</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> newFn = _.debounce(fn, <span class="number">1000</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 计时 1s</span></span></span><br><span class="line"><span class="javascript">      newFn(<span class="string">&quot;a&quot;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 当你不到 1s 的时候，再次调用</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 先把之前的废掉，重新计时 1s</span></span></span><br><span class="line"><span class="javascript">      newFn(<span class="string">&quot;b&quot;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      newFn(<span class="string">&quot;b&quot;</span>);</span></span><br><span class="line"><span class="javascript">      newFn(<span class="string">&quot;b&quot;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="comment">// newFn()</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// he</span></span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="函数防抖实现原理"><a href="#函数防抖实现原理" class="headerlink" title="函数防抖实现原理"></a>函数防抖实现原理</h3><p>函数防抖的实现原理：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">foo</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;hello&quot;</span>, foo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newFn = debounce(fn, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计时 1s</span></span><br><span class="line">newFn(<span class="number">123</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果在 1s 之内重新调用</span></span><br><span class="line"><span class="comment">//   先把之前的废除</span></span><br><span class="line"><span class="comment">//   重新计时</span></span><br><span class="line">newFn(<span class="string">&quot;world&quot;</span>);</span><br><span class="line"><span class="comment">// newFn()</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">callback, time</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// 函数参数中的 ... 表示接收剩余参数</span></span><br><span class="line">  <span class="comment">// 它会把所有的参数收集到一个数组中</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(args);</span><br><span class="line">    <span class="built_in">window</span>.clearTimeout(timer);</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 这里的 ... 表示数组展示操作符</span></span><br><span class="line">      <span class="comment">// args[0], args[1], args[2] .........</span></span><br><span class="line">      callback(...args);</span><br><span class="line">    &#125;, time);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="函数节流（Throttle）"><a href="#函数节流（Throttle）" class="headerlink" title="函数节流（Throttle）"></a>函数节流（Throttle）</h3><p><strong>概念：</strong> <code>规定一个单位时间，在这个单位时间内，只能有一次触发事件的回调函数执行，如果在同一个单位时间内某事件被触发多次，只有一次能生效。</code></p>
<p>生活中的例子：<code>函数节流就是开枪游戏的射速，就算一直按着鼠标射击，也只会在规定射速内射出子弹。</code></p>
<p>我们先用 lodash 来体验节流的使用方式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;------ fire ------&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数1：函数</span></span><br><span class="line"><span class="comment">// 参数2：间隔时间</span></span><br><span class="line"><span class="comment">// 返回值：函数（它的功能和保证的 fn 的功能是一样的，但是被进行了节流处理）</span></span><br><span class="line"><span class="comment">// 第1次直接调用，之后的按照一定频率进行调用</span></span><br><span class="line"><span class="keyword">const</span> newFn = _.throttle(fn, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// newFn()</span></span><br><span class="line"><span class="comment">// newFn()</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;鼠标点击&quot;</span>);</span><br><span class="line">  newFn();</span><br><span class="line">&#125;, <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一上来就调用一次</span></span><br><span class="line"><span class="comment">// newFn()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// // 之后的调用，开始计时 1s</span></span><br><span class="line"><span class="comment">// newFn()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// // 1s 之内所有的调用只有1次</span></span><br><span class="line"><span class="comment">// newFn()</span></span><br><span class="line"><span class="comment">// newFn()</span></span><br><span class="line"><span class="comment">// newFn()</span></span><br><span class="line"><span class="comment">// newFn()</span></span><br><span class="line"><span class="comment">// newFn()</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="函数节流实现原理"><a href="#函数节流实现原理" class="headerlink" title="函数节流实现原理"></a>函数节流实现原理</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">callback, interval</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 最后一次的调用时间</span></span><br><span class="line">  <span class="keyword">let</span> lastTime = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定时器</span></span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回一个函数</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 清除定时器</span></span><br><span class="line">    <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当前最新时间</span></span><br><span class="line">    <span class="keyword">let</span> nowTime = <span class="built_in">Date</span>.now();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果当前最新时间 - 上一次时间 &gt;= 时间间隔</span></span><br><span class="line">    <span class="comment">// 或者没有上一次时间，那就立即调用</span></span><br><span class="line">    <span class="keyword">if</span> (nowTime - lastTime &gt;= interval) &#123;</span><br><span class="line">      callback();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 记录最后一次的调用时间</span></span><br><span class="line">      <span class="comment">// 1</span></span><br><span class="line">      lastTime = nowTime;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        callback();</span><br><span class="line">      &#125;, interval);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fn = throttle(函数, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">fn();</span><br><span class="line"></span><br><span class="line">fn();</span><br><span class="line"></span><br><span class="line">fn();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="函数节流或者防抖的相关场景"><a href="#函数节流或者防抖的相关场景" class="headerlink" title="函数节流或者防抖的相关场景"></a>函数节流或者防抖的相关场景</h3><ul>
<li>建议</li>
<li>window.resize 事件处理</li>
<li>页面的滚动事件</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>函数防抖和函数节流都是防止某一时间频繁触发，但是这两兄弟之间的特性却不一样。<ul>
<li>search 搜索联想，用户在不断输入值时，用防抖来节约请求资源。</li>
<li>window 触发 resize 的时候，不断的调整浏览器窗口大小会不断的触发这个事件，用防抖来让其只触发一次</li>
</ul>
</li>
<li>函数防抖是某一段时间内只执行一次，而函数节流是间隔时间执行。<ul>
<li>鼠标不断点击触发，mousedown(单位时间内只触发一次)</li>
<li>监听滚动事件，比如是否滑到底部自动加载更多，用 throttle 来判断</li>
</ul>
</li>
</ul>
<h2 id="扩展：lodash-函数库"><a href="#扩展：lodash-函数库" class="headerlink" title="扩展：lodash 函数库"></a>扩展：lodash 函数库</h2><p>lodash 是一个常用工具函数库，它里面封装了好多常用的工具函数：</p>
<ul>
<li>官方文档： <a target="_blank" rel="noopener" href="https://lodash.com/">https://lodash.com/</a></li>
<li>翻译的中文文档：<a target="_blank" rel="noopener" href="https://www.lodashjs.com/">https://www.lodashjs.com/</a></li>
</ul>
<blockquote>
<p>在 lodash 之前还有一个 JavaScript 工具函数库：<a target="_blank" rel="noopener" href="https://underscorejs.org/">underscore</a>，lodash 模仿 underscope 自己重新实现了一遍，它相比 underscore 最大的好处是它支持按需加载。</p>
<p>underscope 不支持按需加载。</p>
</blockquote>
<h1 id="九、文章详情"><a href="#九、文章详情" class="headerlink" title="九、文章详情"></a>九、文章详情</h1><img src="https://yhx0507.github.io/wxapp_static/app/1566972493322.png" class="">

<h2 id="准备-4"><a href="#准备-4" class="headerlink" title="准备"></a>准备</h2><h3 id="创建组件并配置路由-2"><a href="#创建组件并配置路由-2" class="headerlink" title="创建组件并配置路由"></a>创建组件并配置路由</h3><p>1、创建 <code>views/article/index.vue</code> 组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;article-container&quot;</span>&gt;</span>文章详情<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;ArticlePage&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    articleId: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">String</span>,</span></span><br><span class="line"><span class="javascript">      required: <span class="literal">true</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、然后将该页面配置到根级路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: <span class="string">&#x27;/article/:articleId&#x27;</span>,</span><br><span class="line">  name: <span class="string">&#x27;article&#x27;</span>,</span><br><span class="line">  component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/article&#x27;</span>),</span><br><span class="line">  <span class="comment">// 将路由动态参数映射到组件的 props 中，更推荐这种做法</span></span><br><span class="line">  props: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://router.vuejs.org/zh/guide/essentials/passing-props.html">官方文档：路由 props 传参</a></p>
</blockquote>
<p>最后访问 <code>/article/*</code> 测试。</p>
<h3 id="布局-1"><a href="#布局-1" class="headerlink" title="布局"></a>布局</h3><p>一、注册组件</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/loading">Loading 加载</a></li>
</ul>
<p>二、导入素材到文章组件目录</p>
<ul>
<li>no-network.png</li>
<li><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/sindresorhus/github-markdown-css/gh-pages/github-markdown.css">github-markdown.css</a></li>
</ul>
<p>三、布局</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;article-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span></span></span><br><span class="line"><span class="tag">      <span class="attr">title</span>=<span class="string">&quot;文章详情&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">left-arrow</span></span></span><br><span class="line"><span class="tag">      <span class="attr">fixed</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">click-left</span>=<span class="string">&quot;$router.back()&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">van-nav-bar</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 加载中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-loading</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;loading&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">color</span>=<span class="string">&quot;#1989fa&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">vertical</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">slot</span>&gt;</span>加载中...<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-loading</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /加载中 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 文章详情 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;detail&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>一个合格的中级前端工程师需要掌握的 28 个 JavaScript 技巧<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;author-wrap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;base-info&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">round</span></span></span><br><span class="line"><span class="tag">            <span class="attr">fit</span>=<span class="string">&quot;cover&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">&quot;https://img.yzcdn.cn/vant/cat.jpeg&quot;</span></span></span><br><span class="line"><span class="tag">          /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;name&quot;</span>&gt;</span>黑马头条号<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;time&quot;</span>&gt;</span>4 小时前<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">class</span>=<span class="string">&quot;follow-btn&quot;</span> <span class="attr">type</span>=<span class="string">&quot;info&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">round</span>&gt;</span>+ 关注<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;markdown-body&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>作为战斗在业务一线的前端，要想少加班，就要想办法提高工作效率。这里提一个小点，我们在业务开发过程中，经常会重复用到日期格式化、url参数转对象、浏览器类型判断、节流函数等一类函数，这些工具类函数，基本上在每个项目都会用到，为避免不同项目多次复制粘贴的麻烦，我们可以统一封装，发布到npm，以提高开发效率。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>使用 Object.prototype.toString 配合闭包，通过传入不同的判断类型来返回不同的判断函数，一行代码，简洁优雅灵活（注意传入 type 参数时首字母大写）<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>使用 Object.prototype.toString 配合闭包，通过传入不同的判断类型来返回不同的判断函数，一行代码，简洁优雅灵活（注意传入 type 参数时首字母大写）<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>使用 Object.prototype.toString 配合闭包，通过传入不同的判断类型来返回不同的判断函数，一行代码，简洁优雅灵活（注意传入 type 参数时首字母大写）<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>使用 Object.prototype.toString 配合闭包，通过传入不同的判断类型来返回不同的判断函数，一行代码，简洁优雅灵活（注意传入 type 参数时首字母大写）<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /文章详情 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 加载失败提示 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;error&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./no-network.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;no-network&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>亲，网络不给力哦~<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">&quot;default&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span>点击重试<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /加载失败提示 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 底部区域 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;write-btn&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">&quot;default&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">round</span></span></span><br><span class="line"><span class="tag">        <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span>写评论<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;comment-icon&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;comment-o&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">info</span>=<span class="string">&quot;9&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">        <span class="attr">color</span>=<span class="string">&quot;orange&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;star&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">        <span class="attr">color</span>=<span class="string">&quot;#e5645f&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;good-job&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">class</span>=<span class="string">&quot;share-icon&quot;</span> <span class="attr">name</span>=<span class="string">&quot;share&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /底部区域 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;ArticlePage&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    articleId: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">String</span>,</span></span><br><span class="line"><span class="javascript">      required: <span class="literal">true</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span>&gt;</span></span><br><span class="line"><span class="css"><span class="keyword">@import</span> <span class="string">&quot;./github-markdown.css&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="css"><span class="selector-class">.article-container</span> &#123;</span></span><br><span class="line">  padding: 46px 20px 50px;</span><br><span class="line"><span class="css">  <span class="selector-tag">background</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.loading</span> &#123;</span></span><br><span class="line">    padding-top: 100px;</span><br><span class="line">    text-align: center;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.detail</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.title</span> &#123;</span></span><br><span class="line">      margin: 0;</span><br><span class="line">      padding-top: 24px;</span><br><span class="line">      font-size: 20px;</span><br><span class="line"><span class="css">      <span class="selector-tag">color</span>: <span class="selector-id">#3A3A3A</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.author-wrap</span> &#123;</span></span><br><span class="line">      display: flex;</span><br><span class="line">      justify-content: space-between;</span><br><span class="line">      align-items: center;</span><br><span class="line">      padding: 20px 0;</span><br><span class="line">      height: 40px;</span><br><span class="line"><span class="css">      <span class="selector-class">.base-info</span> &#123;</span></span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: center;</span><br><span class="line"><span class="css">        <span class="selector-class">.avatar</span> &#123;</span></span><br><span class="line">          width: 40px;</span><br><span class="line">          height: 40px;</span><br><span class="line">          margin-right: 8px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.text</span> &#123;</span></span><br><span class="line"><span class="css">          <span class="selector-tag">line-height</span>: 1<span class="selector-class">.5</span>;</span></span><br><span class="line"><span class="css">          <span class="selector-class">.name</span> &#123;</span></span><br><span class="line">            margin: 0;</span><br><span class="line">            font-size: 14px;</span><br><span class="line">          &#125;</span><br><span class="line"><span class="css">          <span class="selector-class">.time</span> &#123;</span></span><br><span class="line">            margin: 0;</span><br><span class="line">            font-size: 12px;</span><br><span class="line"><span class="css">            <span class="selector-tag">color</span>: <span class="selector-id">#999</span>;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.follow-btn</span> &#123;</span></span><br><span class="line">        width: 85px;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.error</span> &#123;</span></span><br><span class="line">    padding-top: 100px;</span><br><span class="line">    text-align: center;</span><br><span class="line"><span class="css">    <span class="selector-class">.text</span> &#123;</span></span><br><span class="line">      font-size: 15px;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.btn</span> &#123;</span></span><br><span class="line">      width: 30%;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.footer</span> &#123;</span></span><br><span class="line">    position: fixed;</span><br><span class="line">    left: 0;</span><br><span class="line">    right: 0;</span><br><span class="line">    bottom: 0;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-around;</span><br><span class="line">    align-items: center;</span><br><span class="line">    height: 44px;</span><br><span class="line"><span class="css">    <span class="selector-tag">border-top</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#d8d8d8</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background-color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.write-btn</span> &#123;</span></span><br><span class="line">      width: 160px;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.van-icon</span> &#123;</span></span><br><span class="line">      font-size: 20px;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.comment-icon</span> &#123;</span></span><br><span class="line">      bottom: -2px;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.share-icon</span> &#123;</span></span><br><span class="line">      bottom: -2px;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="页面-loading-组件"><a href="#页面-loading-组件" class="headerlink" title="页面 loading 组件"></a>页面 loading 组件</h2><h2 id="页面错误组件"><a href="#页面错误组件" class="headerlink" title="页面错误组件"></a>页面错误组件</h2><h2 id="图片预览"><a href="#图片预览" class="headerlink" title="图片预览"></a>图片预览</h2><h2 id="展示文章详情"><a href="#展示文章详情" class="headerlink" title="展示文章详情"></a>展示文章详情</h2><p>这里我们主要实现两个主要功能：</p>
<ul>
<li>获取展示文章详情</li>
<li>处理加载中 loading</li>
</ul>
<p>一、请求并展示文章详情</p>
<p>1、在 <code>api/article.js</code> 中新增封装接口方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据 id 获取指定文章</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getArticleById = <span class="function"><span class="params">articleId</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    url: <span class="string">`/app/v1_0/articles/<span class="subst">$&#123;articleId&#125;</span>`</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在组件中调用获取文章详情</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">import</span> &#123; getArticleById &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/article&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;ArticlePage&#x27;</span>,</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    articleId: &#123;</span><br><span class="line">      type: <span class="built_in">String</span>,</span><br><span class="line">      required: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">+      article: &#123;&#125; <span class="comment">// 文章详情</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;</span><br><span class="line">+    <span class="built_in">this</span>.loadArticle()</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">+++    <span class="keyword">async</span> loadArticle () &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getArticleById(<span class="built_in">this</span>.articleId)</span><br><span class="line">        <span class="built_in">this</span>.article = data.data</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、模板绑定</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 文章详情 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;detail&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123; article.title &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;author-wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;base-info&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">round</span></span></span><br><span class="line"><span class="tag">        <span class="attr">fit</span>=<span class="string">&quot;cover&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:src</span>=<span class="string">&quot;article.aut_photo&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;name&quot;</span>&gt;</span>&#123;&#123; article.aut_name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;time&quot;</span>&gt;</span>&#123;&#123; article.pubdate &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">class</span>=<span class="string">&quot;follow-btn&quot;</span> <span class="attr">type</span>=<span class="string">&quot;info&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">round</span>&gt;</span>+ 关注<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;markdown-body&quot;</span> <span class="attr">v-html</span>=<span class="string">&quot;article.content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /文章详情 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 底部区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;write-btn&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">type</span>=<span class="string">&quot;default&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">round</span></span></span><br><span class="line"><span class="tag">    <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span>写评论<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;comment-icon&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">name</span>=<span class="string">&quot;comment-o&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">info</span>=<span class="string">&quot;9&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">    <span class="attr">color</span>=<span class="string">&quot;orange&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:name</span>=<span class="string">&quot;article.is_collected ? &#x27;star&#x27; : &#x27;star-o&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click</span>=<span class="string">&quot;onCollect&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">    <span class="attr">color</span>=<span class="string">&quot;#e5645f&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">name</span>=<span class="string">&quot;good-job&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:name</span>=<span class="string">&quot;article.attitude === 1 ? &#x27;good-job&#x27; : &#x27;good-job-o&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">class</span>=<span class="string">&quot;share-icon&quot;</span> <span class="attr">name</span>=<span class="string">&quot;share&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /底部区域 --&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>二、处理加载中 loading</p>
<p>需求：</p>
<ul>
<li>加载中，显示 loading</li>
<li>加载成功，显示文章详情</li>
<li>加载失败，显示错误提示</li>
</ul>
<p>步骤：</p>
<ul>
<li>添加 loading 数据用来控制 loading 展示</li>
<li>在请求获取数据处理函数中处理 loading<ul>
<li>请求开始，loading = true</li>
<li>请求结束，loading = false</li>
</ul>
</li>
<li>在模板中绑定处理</li>
</ul>
<p>下面是具体实现过程。</p>
<p>1、在 data 中添加数据用来控制加载中的 loading 状态</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    loading: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在请求获取文章的处理函数中处理 loading 状态</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> loadArticle () &#123;</span><br><span class="line">  <span class="built_in">this</span>.loading = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getArticleById(<span class="built_in">this</span>.articleId)</span><br><span class="line">    <span class="built_in">this</span>.article = data.data</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.loading = <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、在模板中绑定条件渲染</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 加载中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-loading</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-if</span>=<span class="string">&quot;loading&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">&quot;loading&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">color</span>=<span class="string">&quot;#1989fa&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">vertical</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span>加载中...<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-loading</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /加载中 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 文章详情 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else-if</span>=<span class="string">&quot;article.title&quot;</span> <span class="attr">class</span>=<span class="string">&quot;detail&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /文章详情 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 加载失败提示 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span> <span class="attr">class</span>=<span class="string">&quot;error&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /加载失败提示 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="文章收藏"><a href="#文章收藏" class="headerlink" title="文章收藏"></a>文章收藏</h2><p>思路：</p>
<ul>
<li>给收藏按钮注册点击事件</li>
<li>如果已经收藏了，则取消收藏</li>
<li>如果没有收藏，则添加收藏</li>
</ul>
<p>下面是具体实现。</p>
<p>1、在 <code>api/article.js</code> 添加封装数据接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 收藏文章</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addCollect = <span class="function"><span class="params">target</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;/app/v1_0/article/collections&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      target</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 取消收藏文章</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> deleteCollect = <span class="function"><span class="params">target</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;DELETE&#x27;</span>,</span><br><span class="line">    url: <span class="string">`/app/v1_0/article/collections/<span class="subst">$&#123;target&#125;</span>`</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、给收藏按钮注册点击事件</p>
<p>3、处理函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onCollect () &#123;</span><br><span class="line">  <span class="comment">// 这里 loading 不仅仅是为了交互提示，更重要的是请求期间禁用背景点击功能，防止用户不断的操作界面发出请求</span></span><br><span class="line">  <span class="built_in">this</span>.$toast.loading(&#123;</span><br><span class="line">    duration: <span class="number">0</span>, <span class="comment">// 持续展示 toast</span></span><br><span class="line">    message: <span class="string">&#x27;操作中...&#x27;</span>,</span><br><span class="line">    forbidClick: <span class="literal">true</span> <span class="comment">// 是否禁止背景点击</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 如果已收藏，则取消收藏</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.article.is_collected) &#123;</span><br><span class="line">      <span class="keyword">await</span> deleteCollect(<span class="built_in">this</span>.articleId)</span><br><span class="line">      <span class="comment">// this.article.is_collected = false</span></span><br><span class="line">      <span class="built_in">this</span>.$toast.success(<span class="string">&#x27;取消收藏&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 添加收藏</span></span><br><span class="line">      <span class="keyword">await</span> addCollect(<span class="built_in">this</span>.articleId)</span><br><span class="line">      <span class="comment">// this.article.is_collected = true</span></span><br><span class="line">      <span class="built_in">this</span>.$toast.success(<span class="string">&#x27;收藏成功&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.article.is_collected = !<span class="built_in">this</span>.article.is_collected</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="built_in">this</span>.$toast.fail(<span class="string">&#x27;操作失败&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="文章点赞"><a href="#文章点赞" class="headerlink" title="文章点赞"></a>文章点赞</h2><p>article 中的 <code>attitude</code> 表示用户对文章的态度</p>
<ul>
<li><code>-1</code> 无态度</li>
<li><code>0</code> 不喜欢</li>
<li><code>1</code> 已点赞</li>
</ul>
<p>思路：</p>
<ul>
<li>给点赞按钮注册点击事件</li>
<li>如果已经点赞，则请求取消点赞</li>
<li>如果没有点赞，则请求点赞</li>
</ul>
<p>1、添加封装数据接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 点赞</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addLike = <span class="function"><span class="params">articleId</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;/app/v1_0/article/likings&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      target: articleId</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 取消点赞</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> deleteLike = <span class="function"><span class="params">articleId</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;DELETE&#x27;</span>,</span><br><span class="line">    url: <span class="string">`/app/v1_0/article/likings/<span class="subst">$&#123;articleId&#125;</span>`</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、给点赞按钮注册点击事件</p>
<p>3、处理函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onLike () &#123;</span><br><span class="line">  <span class="comment">// 两个作用：1、交互提示 2、防止网络慢用户连续不断的点击按钮请求</span></span><br><span class="line">  <span class="built_in">this</span>.$toast.loading(&#123;</span><br><span class="line">    duration: <span class="number">0</span>, <span class="comment">// 持续展示 toast</span></span><br><span class="line">    message: <span class="string">&#x27;操作中...&#x27;</span>,</span><br><span class="line">    forbidClick: <span class="literal">true</span> <span class="comment">// 是否禁止背景点击</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 如果已经点赞，则取消点赞</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.article.attitude === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> deleteLike(<span class="built_in">this</span>.articleId)</span><br><span class="line">      <span class="built_in">this</span>.article.attitude = <span class="number">-1</span></span><br><span class="line">      <span class="built_in">this</span>.$toast.success(<span class="string">&#x27;取消点赞&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 否则添加点赞</span></span><br><span class="line">      <span class="keyword">await</span> addLike(<span class="built_in">this</span>.articleId)</span><br><span class="line">      <span class="built_in">this</span>.article.attitude = <span class="number">1</span></span><br><span class="line">      <span class="built_in">this</span>.$toast.success(<span class="string">&#x27;点赞成功&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="built_in">this</span>.$toast.fail(<span class="string">&#x27;操作失败&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="关注用户"><a href="#关注用户" class="headerlink" title="关注用户"></a>关注用户</h2><h3 id="用户不能关注自己"><a href="#用户不能关注自己" class="headerlink" title="用户不能关注自己"></a>用户不能关注自己</h3><p>什么情况下展示关注按钮？</p>
<ul>
<li>如果用户没有登录</li>
<li>如果当前文章作者不是当前登录用户</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v-if=&quot;!$store.state.user || article.aut_id !== 当前登录用户.id&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>下面是具体的实现。</p>
<p>一、获取当前登录用户的 ID</p>
<p>详见：<a href="/03-Token%E5%A4%84%E7%90%86?id=%E8%A7%A3%E6%9E%90-token" title=":target=_blank">三、Token 处理—解析 Token</a></p>
<p>二、条件绑定展示</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-if</span>=<span class="string">&quot;!$store.state.user || article.aut_id !== $store.state.user.id&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">&quot;follow-btn&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:type</span>=<span class="string">&quot;article.is_followed ? &#x27;default&#x27; : &#x27;info&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">round</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:loading</span>=<span class="string">&quot;isFollowLoading&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">click</span>=<span class="string">&quot;onFollow&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span>&#123;&#123; article.is_followed ? &#x27;已关注&#x27; : &#x27;+ 关注&#x27; &#125;&#125;<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后测试。</p>
<h3 id="关注-取消关注"><a href="#关注-取消关注" class="headerlink" title="关注|取消关注"></a>关注|取消关注</h3><p>思路：</p>
<ul>
<li>给按钮注册点击事件</li>
<li>在事件处理函数中<ul>
<li>如果已关注，则取消关注</li>
<li>如果没有关注，则添加关注</li>
</ul>
</li>
</ul>
<p>下面是具体实现。</p>
<p>1、在 <code>api/user.js</code> 中添加封装请求方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加关注</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addFollow = <span class="function"><span class="params">userId</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;/app/v1_0/user/followings&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      target: userId</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 取消关注</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> deleteFollow = <span class="function"><span class="params">userId</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;DELETE&#x27;</span>,</span><br><span class="line">    url: <span class="string">`/app/v1_0/user/followings/<span class="subst">$&#123;userId&#125;</span>`</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、给关注/取消关注按钮注册点击事件</p>
<p>3、在事件处理函数中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; addFollow, deleteFollow &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/user&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onFollow () &#123;</span><br><span class="line">  <span class="comment">// 开启按钮的 loading 状态</span></span><br><span class="line">  <span class="built_in">this</span>.isFollowLoading = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 如果已关注，则取消关注</span></span><br><span class="line">    <span class="keyword">const</span> authorId = <span class="built_in">this</span>.article.aut_id</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.article.is_followed) &#123;</span><br><span class="line">      <span class="keyword">await</span> deleteFollow(authorId)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 否则添加关注</span></span><br><span class="line">      <span class="keyword">await</span> addFollow(authorId)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新视图</span></span><br><span class="line">    <span class="built_in">this</span>.article.is_followed = !<span class="built_in">this</span>.article.is_followed</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="built_in">this</span>.$toast.fail(<span class="string">&#x27;操作失败&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 关闭按钮的 loading 状态</span></span><br><span class="line">  <span class="built_in">this</span>.isFollowLoading = <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后测试。</p>
<h2 id="日期格式化"><a href="#日期格式化" class="headerlink" title="日期格式化"></a>日期格式化</h2><p><a target="_blank" rel="noopener" href="https://momentjs.com/">moment</a> 是一个专门处理日期时间的一个纯 JavaScript 工具函数库，它不仅可以在浏览器中使用，也可以在 Node.js 中使用。</p>
<p>1、安装 moment</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i moment</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、创建 <code>utils/datetime.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * moment 日期处理封装</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;moment&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置中文语言</span></span><br><span class="line">moment.locale(<span class="string">&#x27;zh-cn&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相对时间</span></span><br><span class="line">Vue.filter(<span class="string">&#x27;relativeTime&#x27;</span>, <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 参考文档：http://momentjs.cn/docs/#/manipulating/start-of/</span></span><br><span class="line">  <span class="keyword">return</span> moment(value).startOf(<span class="string">&#x27;second&#x27;</span>).fromNow()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 日期格式化</span></span><br><span class="line">Vue.filter(<span class="string">&#x27;datetime&#x27;</span>, <span class="function">(<span class="params">value, format = <span class="string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> moment(value).format(format)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、在 <code>main.js</code> 中加载初始化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./utils/datetime&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>之后在任何组件的模板中直接调用过滤器函数即可，例如。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;time&quot;</span>&gt;</span>&#123;&#123; article.pubdate | relativeTime &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="十、文章评论"><a href="#十、文章评论" class="headerlink" title="十、文章评论"></a>十、文章评论</h1><img src="https://yhx0507.github.io/wxapp_static/app/1566972493322.png" class="">

<h2 id="文章评论"><a href="#文章评论" class="headerlink" title="文章评论"></a>文章评论</h2><h3 id="准备文章评论组件"><a href="#准备文章评论组件" class="headerlink" title="准备文章评论组件"></a>准备文章评论组件</h3><p>为了更好的开发和维护，这里我们把文章评论单独封装到一个组件中来处理。</p>
<p>1、创建 <code>src/views/article/components/article-comment.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;article-comments&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 评论列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-list</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">&quot;loading&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:finished</span>=<span class="string">&quot;finished&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">finished-text</span>=<span class="string">&quot;没有更多了&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">load</span>=<span class="string">&quot;onLoad&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">v-for</span>=<span class="string">&quot;item in list&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item&quot;</span> <span class="attr">:title</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">          <span class="attr">slot</span>=<span class="string">&quot;icon&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">round</span></span></span><br><span class="line"><span class="tag">          <span class="attr">width</span>=<span class="string">&quot;30&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">height</span>=<span class="string">&quot;30&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">style</span>=<span class="string">&quot;margin-right: 10px;&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">src</span>=<span class="string">&quot;https://img.yzcdn.cn/vant/cat.jpeg&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #466b9d;&quot;</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;label&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color: #363636;&quot;</span>&gt;</span>我出去跟别人说我的是。。。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 10px;&quot;</span>&gt;</span>3天前<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">type</span>=<span class="string">&quot;default&quot;</span>&gt;</span>回复<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">slot</span>=<span class="string">&quot;right-icon&quot;</span> <span class="attr">name</span>=<span class="string">&quot;like-o&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-list</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 评论列表 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 发布评论 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">class</span>=<span class="string">&quot;publish-wrap&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-field</span> <span class="attr">clearable</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入评论内容&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">slot</span>=<span class="string">&quot;button&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">type</span>=<span class="string">&quot;info&quot;</span>&gt;</span>发布<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /发布评论 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;ArticleComment&quot;</span>,</span></span><br><span class="line">    props: &#123;&#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        list: [], <span class="comment">// 评论列表</span></span></span><br><span class="line"><span class="javascript">        loading: <span class="literal">false</span>, <span class="comment">// 上拉加载更多的 loading</span></span></span><br><span class="line"><span class="javascript">        finished: <span class="literal">false</span> <span class="comment">// 是否加载结束</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    methods: &#123;</span><br><span class="line">      onLoad() &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// 异步更新数据</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.list.push(<span class="built_in">this</span>.list.length + <span class="number">1</span>);</span></span><br><span class="line">          &#125;</span><br><span class="line"><span class="javascript">          <span class="comment">// 加载状态结束</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.loading = <span class="literal">false</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">          <span class="comment">// 数据全部加载完成</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (<span class="built_in">this</span>.list.length &gt;= <span class="number">40</span>) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.finished = <span class="literal">true</span>;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, 500);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.publish-wrap</span> &#123;</span></span><br><span class="line">    position: fixed;</span><br><span class="line">    left: 0;</span><br><span class="line">    bottom: 0;</span><br><span class="line">    width: 100%;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">  <span class="selector-class">.van-list</span> &#123;</span></span><br><span class="line">    margin-bottom: 45px;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在文章详情页面中加载注册文章评论子组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ArticleComment <span class="keyword">from</span> <span class="string">&#x27;./components/article-comment&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  components: &#123;</span><br><span class="line">    ArticleComment</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、在文章详情页面的加载失败提示消息后面使用文章评论子组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 文章评论 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">article-comment</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /文章评论 --&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最终页面效果如下：</p>
<img src="https://yhx0507.github.io/wxapp_static/app/image-20191206152846065.png" class="">

<h3 id="展示文章评论列表"><a href="#展示文章评论列表" class="headerlink" title="展示文章评论列表"></a>展示文章评论列表</h3><blockquote>
<p>提示：有评论数据的文章 id：<code>139987</code>。</p>
</blockquote>
<p>步骤：</p>
<ul>
<li>封装接口</li>
<li>请求获取数据</li>
<li>处理模板</li>
</ul>
<p>实现：</p>
<p>1、在 <code>api/comment.js</code> 中添加封装请求方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 评论接口模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&quot;@/utils/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取文章列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getComments</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    url: <span class="string">&quot;/app/v1_0/comments&quot;</span>,</span><br><span class="line">    params</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、请求获取数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    articleComment: &#123; <span class="comment">// 文章评论相关数据</span></span><br><span class="line">      list: [],</span><br><span class="line">      loading: <span class="literal">false</span>,</span><br><span class="line">      finished: <span class="literal">false</span>,</span><br><span class="line">      offset: <span class="literal">null</span>, <span class="comment">// 请求下一页数据的页码</span></span><br><span class="line">      totalCount: <span class="number">0</span> <span class="comment">// 总数据条数</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onLoad () &#123;</span><br><span class="line">  <span class="keyword">const</span> articleComment = <span class="built_in">this</span>.articleComment</span><br><span class="line">  <span class="comment">// 1. 请求获取数据</span></span><br><span class="line">  <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getComments(&#123;</span><br><span class="line">    type: <span class="string">&#x27;a&#x27;</span>, <span class="comment">// 评论类型，a-对文章(article)的评论，c-对评论(comment)的回复</span></span><br><span class="line">    source: <span class="built_in">this</span>.articleId, <span class="comment">// 源id，文章id或评论id</span></span><br><span class="line">    offset: articleComment.offset, <span class="comment">// 获取评论数据的偏移量，值为评论id，表示从此id的数据向后取，不传表示从第一页开始读取数据</span></span><br><span class="line">    limit: <span class="number">10</span> <span class="comment">// 每页大小</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 将数据添加到列表中</span></span><br><span class="line">  <span class="keyword">const</span> &#123; results &#125; = data.data</span><br><span class="line">  articleComment.list.push(...results)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新总数据条数</span></span><br><span class="line">  articleComment.totalCount = data.data.total_count</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 将加载更多的 loading 设置为 false</span></span><br><span class="line">  articleComment.loading = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4. 判断是否还有数据</span></span><br><span class="line">  <span class="keyword">if</span> (results.length) &#123;</span><br><span class="line">    articleComment.offset = data.data.last_id <span class="comment">// 更新获取下一页数据的页码</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    articleComment.finished = <span class="literal">true</span> <span class="comment">// 没有数据了，关闭加载更多</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、模板绑定</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 评论列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-list</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">&quot;loading&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:finished</span>=<span class="string">&quot;finished&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">finished-text</span>=<span class="string">&quot;没有更多了&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">load</span>=<span class="string">&quot;onLoad&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">v-for</span>=<span class="string">&quot;item in list&quot;</span> + <span class="attr">:key</span>=<span class="string">&quot;item.com_id.toString()&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">      <span class="attr">slot</span>=<span class="string">&quot;icon&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">round</span></span></span><br><span class="line"><span class="tag">      <span class="attr">width</span>=<span class="string">&quot;30&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">height</span>=<span class="string">&quot;30&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">style</span>=<span class="string">&quot;margin-right: 10px;&quot;</span></span></span><br><span class="line"><span class="tag">      +</span></span><br><span class="line"><span class="tag">      <span class="attr">:src</span>=<span class="string">&quot;item.aut_photo&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    + <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #466b9d;&quot;</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123; item.aut_name &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;label&quot;</span>&gt;</span></span><br><span class="line">      +</span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color: #363636;&quot;</span>&gt;</span>&#123;&#123; item.content &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        +</span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 10px;&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span>&#123;&#123; item.pubdate | relativeTime &#125;&#125;<span class="tag">&lt;/<span class="name">span</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">type</span>=<span class="string">&quot;default&quot;</span>&gt;</span>回复<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">slot</span>=<span class="string">&quot;right-icon&quot;</span> <span class="attr">name</span>=<span class="string">&quot;like-o&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-list</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 评论列表 --&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="文章评论项组件"><a href="#文章评论项组件" class="headerlink" title="文章评论项组件"></a>文章评论项组件</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">class</span>=<span class="string">&quot;comment-item&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 评论作者头像 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">      <span class="attr">slot</span>=<span class="string">&quot;icon&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">round</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:src</span>=<span class="string">&quot;comment.aut_photo&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 评论作者头像 --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 评论作者名字 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #466b9d;&quot;</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123; comment.aut_name &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 评论作者名字 --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;label&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 评论内容 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color: #363636;&quot;</span>&gt;</span>&#123;&#123; comment.content &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- /评论内容 --&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 评论发布日期 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 10px;&quot;</span>&gt;</span>&#123;&#123; comment.pubdate &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 评论发布日期 --&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">          <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">type</span>=<span class="string">&quot;default&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span>回复 &#123;&#123; comment.reply_count &#125;&#125;<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;right-icon&quot;</span> <span class="attr">class</span>=<span class="string">&quot;like-container&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:color</span>=<span class="string">&quot;comment.is_liking ? &#x27;#e5645f&#x27; : &#x27;&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:name</span>=<span class="string">&quot;comment.is_liking ? &#x27;good-job&#x27; : &#x27;good-job-o&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; comment.like_count ? comment.like_count : &#x27;赞&#x27; &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;CommentItem&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    comment: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">      required: <span class="literal">true</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.comment-item</span> &#123;</span></span><br><span class="line">  display: flex;</span><br><span class="line">  align-items: flex-start;</span><br><span class="line"><span class="css">  <span class="selector-class">.avatar</span> &#123;</span></span><br><span class="line">    width: 30px;</span><br><span class="line">    height: 30px;</span><br><span class="line">    margin-right: 10px;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.like-container</span> &#123;</span></span><br><span class="line">    width: 30px;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    font-size: 13px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="发布文章评论"><a href="#发布文章评论" class="headerlink" title="发布文章评论"></a>发布文章评论</h2><h2 id="发布组件"><a href="#发布组件" class="headerlink" title="发布组件"></a>发布组件</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;post-comment&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      模板中的 $event 表示事件参数</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-field</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;post-field&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:value</span>=<span class="string">&quot;value&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">input</span>=<span class="string">&quot;$emit(&#x27;input&#x27;, $event)&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">rows</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">autosize</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">&quot;textarea&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">maxlength</span>=<span class="string">&quot;50&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">placeholder</span>=<span class="string">&quot;优质评论将会被优先展示&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">show-word-limit</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">click</span>=<span class="string">&quot;$emit(&#x27;click-post&#x27;)&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span>发布<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;PostComment&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    value: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">String</span>,</span></span><br><span class="line"><span class="javascript">      required: <span class="literal">true</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      message: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    onInput (value) &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$emit(<span class="string">&#x27;input&#x27;</span>, value)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.post-comment</span> &#123;</span></span><br><span class="line">  display: flex;</span><br><span class="line">  padding: 15px;</span><br><span class="line">  align-items: flex-end;</span><br><span class="line"><span class="css">  <span class="selector-class">.post-field</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background</span>: <span class="selector-id">#f5f7f9</span>;</span></span><br><span class="line">    margin-right: 15px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="发布文章评论-1"><a href="#发布文章评论-1" class="headerlink" title="发布文章评论"></a>发布文章评论</h2><p>步骤：</p>
<ul>
<li>注册发布点击事件</li>
<li>请求提交表单</li>
<li>根据响应结果进行后续处理</li>
</ul>
<p>一、使用弹层展示发布评论</p>
<p>1、添加弹层组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    isPostShow: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 发布文章评论 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">&quot;isPostShow&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">&quot;bottom&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /发布文章评论 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>提示：不设置高度的时候，内容会自动撑开弹层高度</p>
</blockquote>
<p>2、点击发评论按钮的时候显示弹层</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">&quot;write-btn&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">&quot;default&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">round</span></span></span><br><span class="line"><span class="tag">  <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">click</span>=<span class="string">&quot;isPostShow = true&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span>写评论<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>二、封装发布评论组件</p>
<p>1、创建 <code>post-comment.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;post-comment&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-field</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;post-field&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">&quot;message&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">rows</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">autosize</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">&quot;textarea&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">maxlength</span>=<span class="string">&quot;50&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">placeholder</span>=<span class="string">&quot;优质评论将会被优先展示&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">show-word-limit</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span>发布<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;PostComment&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      message: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.post-comment</span> &#123;</span></span><br><span class="line">  display: flex;</span><br><span class="line">  padding: 15px;</span><br><span class="line">  align-items: flex-end;</span><br><span class="line"><span class="css">  <span class="selector-class">.post-field</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background</span>: <span class="selector-id">#f5f7f9</span>;</span></span><br><span class="line">    margin-right: 15px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在详情页加载注册</p>
<p>3、在发布评论的弹层中使用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 发布文章评论 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">&quot;isPostShow&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">&quot;bottom&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">post-comment</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /发布文章评论 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>三、发布评论</p>
<p>1、在 <code>api/comment.js</code> 中添加封装数据接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加评论或评论回复</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addComment</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    url: <span class="string">&quot;/app/v1_0/comments&quot;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、绑定获取添加评论的输入框数据并且注册发布按钮的点击事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    inputComment: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 发布评论 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">class</span>=<span class="string">&quot;publish-wrap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-field</span> + <span class="attr">v-model</span>=<span class="string">&quot;inputComment&quot;</span> <span class="attr">clearable</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入评论内容&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">slot</span>=<span class="string">&quot;button&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">type</span>=<span class="string">&quot;info&quot;</span> + @<span class="attr">click</span>=<span class="string">&quot;onAddComment&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span>发布<span class="tag">&lt;/<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /发布评论 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、在事件处理函数中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">	getComments,</span><br><span class="line">+  addComment</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/comment&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onAddComment () &#123;</span><br><span class="line">  <span class="keyword">const</span> inputComment = <span class="built_in">this</span>.inputComment.trim()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 非空校验</span></span><br><span class="line">  <span class="keyword">if</span> (!inputComment.length) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 请求添加</span></span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> addComment(&#123;</span><br><span class="line">    target: <span class="built_in">this</span>.$route.params.articleId, <span class="comment">// 评论的目标id（评论文章即为文章id，对评论进行回复则为评论id）</span></span><br><span class="line">    content: inputComment <span class="comment">// 评论内容</span></span><br><span class="line">    <span class="comment">// art_id // 文章id，对评论内容发表回复时，需要传递此参数，表明所属文章id。对文章进行评论，不要传此参数。</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将发布的最新评论展示到列表顶部</span></span><br><span class="line">  <span class="built_in">this</span>.list.unshift(res.data.data.new_obj)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 清空文本框</span></span><br><span class="line">  <span class="built_in">this</span>.inputComment = <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="发布文章评论-2"><a href="#发布文章评论-2" class="headerlink" title="发布文章评论"></a>发布文章评论</h3><p>1、封装数据接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 发布评论</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addComment = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;/app/v1_0/comments&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>2、给发布按钮点击事件</p>
<p>3、事件处理函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onAddComment () &#123;</span><br><span class="line">  <span class="comment">// 1. 拿到数据</span></span><br><span class="line">  <span class="keyword">const</span> postMessage = <span class="built_in">this</span>.postMessage</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 非空校验</span></span><br><span class="line">  <span class="keyword">if</span> (!postMessage) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.$toast.loading(&#123;</span><br><span class="line">    duration: <span class="number">0</span>, <span class="comment">// 持续展示 toast</span></span><br><span class="line">    message: <span class="string">&#x27;发布中...&#x27;</span>,</span><br><span class="line">    forbidClick: <span class="literal">true</span> <span class="comment">// 是否禁止背景点击</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 2. 请求提交</span></span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> addComment(&#123;</span><br><span class="line">      target: <span class="built_in">this</span>.articleId, <span class="comment">// 评论的目标id（评论文章即为文章id，对评论进行回复则为评论id）</span></span><br><span class="line">      content: postMessage</span><br><span class="line">      <span class="comment">// art_id: // 文章id，对评论内容发表回复时，需要传递此参数，表明所属文章id。对文章进行评论，不要传此参数。</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭发布评论的弹层</span></span><br><span class="line">    <span class="built_in">this</span>.isPostShow = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将最新发布的评论展示到列表的顶部</span></span><br><span class="line">    <span class="built_in">this</span>.articleComment.list.unshift(data.data.new_obj)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新文章评论的总数量</span></span><br><span class="line">    <span class="built_in">this</span>.articleComment.totalCount++</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清空文本框</span></span><br><span class="line">    <span class="built_in">this</span>.postMessage = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.$toast.success(<span class="string">&#x27;发布成功&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="built_in">this</span>.$toast.fail(<span class="string">&#x27;发布失败&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="文章评论点赞"><a href="#文章评论点赞" class="headerlink" title="文章评论点赞"></a>文章评论点赞</h3><p>1、在 <code>api/comment.js</code> 中添加封装两个数据接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对评论或评论回复点赞</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addCommentLike</span>(<span class="params">commentId</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    url: <span class="string">&quot;/app/v1_0/comment/likings&quot;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      target: commentId</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 取消对评论或评论回复点赞</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteCommentLike</span>(<span class="params">commentId</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&quot;DELETE&quot;</span>,</span><br><span class="line">    url: <span class="string">`/app/v1_0/comment/likings/<span class="subst">$&#123;commentId&#125;</span>`</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、然后给评论项中的 <code>like</code> 图标注册点击事件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">  <span class="attr">slot</span>=<span class="string">&quot;right-icon&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">color</span>=<span class="string">&quot;red&quot;</span></span></span><br><span class="line"><span class="tag">  +</span></span><br><span class="line"><span class="tag">  <span class="attr">:name</span>=<span class="string">&quot;item.is_liking ? &#x27;like&#x27; : &#x27;like-o&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">  +</span></span><br><span class="line"><span class="tag">  @<span class="attr">click</span>=<span class="string">&quot;onCommentLike(item)&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、在事件处理函数中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  getComments,</span><br><span class="line">  addComment,</span><br><span class="line">+  addCommentLike,</span><br><span class="line">+  deleteCommentLike</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/comment&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onCommentLike (comment) &#123;</span><br><span class="line">  <span class="comment">// 如果已经赞了则取消点赞</span></span><br><span class="line">  <span class="keyword">if</span> (comment.is_liking) &#123;</span><br><span class="line">    <span class="keyword">await</span> deleteCommentLike(comment.com_id)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 如果没有赞，则点赞</span></span><br><span class="line">    <span class="keyword">await</span> addCommentLike(comment.com_id)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新视图状态</span></span><br><span class="line">  comment.is_liking = !comment.is_liking</span><br><span class="line">  <span class="built_in">this</span>.$toast(<span class="string">&#x27;操作成功&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="评论回复"><a href="#评论回复" class="headerlink" title="评论回复"></a>评论回复</h2><h3 id="展示回复弹层"><a href="#展示回复弹层" class="headerlink" title="展示回复弹层"></a>展示回复弹层</h3><p>一、在详情页中使用弹层用来展示文章的回复</p>
<p>1、在 data 中添加数据用来控制展示回复弹层的显示状态</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    isReplyShow: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在详情页中添加使用弹层组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 评论回复 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">&quot;isReplyShow&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">&quot;bottom&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">style</span>=<span class="string">&quot;height: 95%&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  评论回复</span><br><span class="line"><span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /评论回复 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>二、当点击评论项组件中的回复按钮的时候展示弹层</p>
<p>1、在 <code>comment-item.vue</code> 组件中点击回复按钮的时候，对外发布自定义事件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;van-button</span><br><span class="line">  size&#x3D;&quot;mini&quot;</span><br><span class="line">  type&#x3D;&quot;default&quot;</span><br><span class="line">  @click&#x3D;&quot;$emit(&#39;click-reply&#39;)&quot;</span><br><span class="line">&gt;回复 &#123;&#123; comment.reply_count &#125;&#125;&lt;&#x2F;van-button&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在详情页组件中使用的位置监听处理</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">comment-item</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-for</span>=<span class="string">&quot;(comment, index) in articleComment.list&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:comment</span>=<span class="string">&quot;comment&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">click-reply</span>=<span class="string">&quot;isReplyShow = true&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="布局-2"><a href="#布局-2" class="headerlink" title="布局"></a>布局</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;comment-reply&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">:title</span>=<span class="string">&quot;`$&#123;comment.reply_count&#125;条回复`&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">        <span class="attr">slot</span>=<span class="string">&quot;left&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;cross&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">&quot;$emit(&#x27;click-close&#x27;)&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-nav-bar</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 当前评论项 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /当前评论项 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;所有回复&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 评论的回复列表 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /评论的回复列表 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 底部 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /底部 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;CommentReply&#x27;</span>,</span></span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="展示点击回复的当前评论"><a href="#展示点击回复的当前评论" class="headerlink" title="展示点击回复的当前评论"></a>展示点击回复的当前评论</h3><p>一、让 <code>comment-reply.vue</code> 组件拿到点击回复的评论对象</p>
<p>1、在 <code>comment-item.vue</code> 组件中点击回复按钮的时候把评论对象给传出来</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">  <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">&quot;default&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">click</span>=<span class="string">&quot;$emit(&#x27;click-reply&#x27;, comment)&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span>回复 &#123;&#123; comment.reply_count &#125;&#125;<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在文章详情组件中接收处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    currentComment: &#123;&#125; <span class="comment">// 点击回复的那个评论对象</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">comment-item</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-for</span>=<span class="string">&quot;(comment, index) in articleComment.list&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:comment</span>=<span class="string">&quot;comment&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">click-reply</span>=<span class="string">&quot;onReplyShow&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onReplyShow (comment) &#123;</span><br><span class="line">  <span class="comment">// 将子组件中传给我评论对象存储到当前组件</span></span><br><span class="line">  <span class="built_in">this</span>.currentComment = comment</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 展示评论回复弹层</span></span><br><span class="line">  <span class="built_in">this</span>.isReplyShow = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、在详情组件中将 <code>currentComment</code> 传递给 <code>comment-reply.vue</code> 组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 评论回复 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">&quot;isReplyShow&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">&quot;bottom&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">style</span>=<span class="string">&quot;height: 95%&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">comment-reply</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click-close</span>=<span class="string">&quot;isReplyShow = false&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:comment</span>=<span class="string">&quot;currentComment&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /评论回复 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4、在 <code>comment-reply.vue</code> 组件中声明接收</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">props: &#123;</span><br><span class="line">  comment: &#123;</span><br><span class="line">    type: <span class="built_in">Object</span>,</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后使用调试工具查看 props 数据是否接收正确。</p>
<p>二、在 <code>comment-reply.vue</code> 组件中展示当前评论</p>
<p>1、加载注册 <code>comment-item.vue</code> 组件</p>
<p>2、使用展示</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;comment-reply&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">:title</span>=<span class="string">&quot;`$&#123;comment.reply_count&#125;条回复`&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">        <span class="attr">slot</span>=<span class="string">&quot;left&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;cross&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">&quot;$emit(&#x27;click-close&#x27;)&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-nav-bar</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 当前评论项 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">comment-item</span> <span class="attr">:comment</span>=<span class="string">&quot;comment&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /当前评论项 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 评论的回复列表 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /评论的回复列表 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 底部 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /底部 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>一：把点击回复的评论对象传递给评论回复组件</p>
<p>1、在 data 中添加一个数据用来存储点击回复的评论对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    currentComment: &#123;&#125; <span class="comment">// 存储当前点击回复的评论对象</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在点击回复的处理函数中评论对象存储到数据中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onReplyShow (comment) &#123;</span><br><span class="line">+  <span class="built_in">this</span>.currentComment = comment</span><br><span class="line">  <span class="comment">// 显示回复的弹层</span></span><br><span class="line">  <span class="built_in">this</span>.isReplyShow = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、把当前组件的 <code>currentComment</code> 传递给评论回复组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 评论回复 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">&quot;isReplyShow&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">get-container</span>=<span class="string">&quot;body&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">round</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">&quot;bottom&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:style</span>=<span class="string">&quot;&#123; height: &#x27;90%&#x27; &#125;&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 回复列表 --&gt;</span></span><br><span class="line">  + <span class="tag">&lt;<span class="name">comment-reply</span> <span class="attr">:comment</span>=<span class="string">&quot;currentComment&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- /回复列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 评论回复 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4、在评论回复组件中声明 <code>props</code> 接收数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">props: &#123;</span><br><span class="line">  comment: &#123;</span><br><span class="line">    type: <span class="built_in">Object</span>,</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>测试：点击不同的评论回复按钮，查看子组件中的 props 数据 <code>comment</code> 是否是当前点击回复所在的评论对象。</p>
<p>二、数据绑定：在评论回复组件中展示当前评论</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">+</span><br><span class="line"><span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">:title</span>=<span class="string">&quot;comment.reply_count + &#x27;条回复&#x27;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">slot</span>=<span class="string">&quot;left&quot;</span> <span class="attr">name</span>=<span class="string">&quot;cross&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-nav-bar</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 当前评论 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;当前评论&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">    <span class="attr">slot</span>=<span class="string">&quot;icon&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">round</span></span></span><br><span class="line"><span class="tag">    <span class="attr">width</span>=<span class="string">&quot;30&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">height</span>=<span class="string">&quot;30&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">style</span>=<span class="string">&quot;margin-right: 10px;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:src</span>=<span class="string">&quot;comment.aut_photo&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  + <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: #466b9d;&quot;</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123; comment.aut_name &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;label&quot;</span>&gt;</span></span><br><span class="line">    +</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color: #363636;&quot;</span>&gt;</span>&#123;&#123; comment.content &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">      +</span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 10px;&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span>&#123;&#123; comment.pubdate | relativeTime &#125;&#125;<span class="tag">&lt;/<span class="name">span</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">type</span>=<span class="string">&quot;default&quot;</span> +</span></span><br><span class="line"><span class="tag">        &gt;</span>回复 &#123;&#123; comment.reply_count &#125;&#125;<span class="tag">&lt;/<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">slot</span>=<span class="string">&quot;right-icon&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /当前评论 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="展示评论回复列表"><a href="#展示评论回复列表" class="headerlink" title="展示评论回复列表"></a>展示评论回复列表</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;comment-reply&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">:title</span>=<span class="string">&quot;`$&#123;comment.reply_count&#125;条回复`&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-icon</span></span></span><br><span class="line"><span class="tag">        <span class="attr">slot</span>=<span class="string">&quot;left&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;cross&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">&quot;$emit(&#x27;click-close&#x27;)&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-nav-bar</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 当前评论项 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">comment-item</span> <span class="attr">:comment</span>=<span class="string">&quot;comment&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /当前评论项 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;所有回复&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 评论的回复列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-list</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">&quot;loading&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:finished</span>=<span class="string">&quot;finished&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">finished-text</span>=<span class="string">&quot;没有更多了&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">load</span>=<span class="string">&quot;onLoad&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">comment-item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">&quot;(comment, index) in list&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:comment</span>=<span class="string">&quot;comment&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-list</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /评论的回复列表 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 底部 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /底部 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> CommentItem <span class="keyword">from</span> <span class="string">&#x27;./comment-item&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; getComments &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/comment&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;CommentReply&#x27;</span>,</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    CommentItem</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    comment: &#123;</span><br><span class="line"><span class="javascript">      type: <span class="built_in">Object</span>,</span></span><br><span class="line"><span class="javascript">      required: <span class="literal">true</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      list: [],</span><br><span class="line"><span class="javascript">      loading: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">      finished: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">      offset: <span class="literal">null</span>,</span></span><br><span class="line">      limit: 20</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">async</span> onLoad () &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 1. 请求获取数据</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getComments(&#123;</span></span><br><span class="line"><span class="javascript">        type: <span class="string">&#x27;c&#x27;</span>, <span class="comment">// 评论类型，a-对文章(article)的评论，c-对评论(comment)的回复</span></span></span><br><span class="line"><span class="javascript">        source: <span class="built_in">this</span>.comment.com_id.toString(), <span class="comment">// 源id，文章id或评论id</span></span></span><br><span class="line"><span class="javascript">        offset: <span class="built_in">this</span>.offset, <span class="comment">// 获取评论数据的偏移量，值为评论id，表示从此id的数据向后取，不传表示从第一页开始读取数据</span></span></span><br><span class="line"><span class="javascript">        limit: <span class="built_in">this</span>.limit <span class="comment">// 获取的评论数据个数，不传表示采用后端服务设定的默认每页数据量</span></span></span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 2. 将数据添加到列表中</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> &#123; results &#125; = data.data</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.list.push(...results)</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 3. 关闭 loading</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.loading = <span class="literal">false</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 4. 判断数据是否加载完毕</span></span></span><br><span class="line">      if (results.length) &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.offset = data.data.last_id</span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.finished = <span class="literal">true</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="解决弹层中组件内容不更新问题"><a href="#解决弹层中组件内容不更新问题" class="headerlink" title="解决弹层中组件内容不更新问题"></a>解决弹层中组件内容不更新问题</h3><p>弹层组件：</p>
<ul>
<li>如果初始的条件是 false，则弹层的内容不会渲染</li>
<li>程序运行期间，当条件变为 true 的时候，弹层才渲染了内容</li>
<li>之后切换弹层的展示，弹层只是通过 CSS 控制隐藏和显示</li>
</ul>
<p>弹层渲染出来以后就只是简单的切换显示和隐藏，里面的内容也不再重新渲染了，所以会导致我们的评论的回复列表不会动态更新了。解决办法就是在每次弹层显示的时候重新渲染组件。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 评论回复 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">&quot;isReplyShow&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">get-container</span>=<span class="string">&quot;body&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">round</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">&quot;bottom&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:style</span>=<span class="string">&quot;&#123; height: &#x27;90%&#x27; &#125;&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 回复列表 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">comment-reply</span> <span class="attr">:comment</span>=<span class="string">&quot;currentComment&quot;</span> + <span class="attr">v-if</span>=<span class="string">&quot;isReplyShow&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- /回复列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 评论回复 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="在评论回复组件中关闭弹层"><a href="#在评论回复组件中关闭弹层" class="headerlink" title="在评论回复组件中关闭弹层"></a>在评论回复组件中关闭弹层</h3><p>1、在评论回复组件中发布一个自定义事件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">:title</span>=<span class="string">&quot;comment.reply_count + &#x27;条回复&#x27;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-icon</span> <span class="attr">slot</span>=<span class="string">&quot;left&quot;</span> <span class="attr">name</span>=<span class="string">&quot;cross&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;$emit(&#x27;close-reply&#x27;)&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-nav-bar</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在文章评论组件中监听处理</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 评论回复 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-popup</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model</span>=<span class="string">&quot;isReplyShow&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">get-container</span>=<span class="string">&quot;body&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">round</span></span></span><br><span class="line"><span class="tag">  <span class="attr">position</span>=<span class="string">&quot;bottom&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:style</span>=<span class="string">&quot;&#123; height: &#x27;90%&#x27; &#125;&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 回复列表 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">comment-reply</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:comment</span>=<span class="string">&quot;currentComment&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-if</span>=<span class="string">&quot;isReplyShow&quot;</span></span></span><br><span class="line"><span class="tag">    +</span></span><br><span class="line"><span class="tag">    @<span class="attr">close-reply</span>=<span class="string">&quot;isReplyShow = false&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- /回复列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-popup</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 评论回复 --&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="发布回复"><a href="#发布回复" class="headerlink" title="发布回复"></a>发布回复</h3><h1 id="十一、编辑用户资料"><a href="#十一、编辑用户资料" class="headerlink" title="十一、编辑用户资料"></a>十一、编辑用户资料</h1><img src="https://yhx0507.github.io/wxapp_static/app/1566431661910.png" class="">

<h2 id="准备-5"><a href="#准备-5" class="headerlink" title="准备"></a>准备</h2><h3 id="创建组件并配置路由-3"><a href="#创建组件并配置路由-3" class="headerlink" title="创建组件并配置路由"></a>创建组件并配置路由</h3><p>1、创建 <code>views/user/index.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span> <span class="attr">title</span>=<span class="string">&quot;个人信息&quot;</span> <span class="attr">left-arrow</span> <span class="attr">right-text</span>=<span class="string">&quot;保存&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;头像&quot;</span> <span class="attr">is-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">          <span class="attr">round</span></span></span><br><span class="line"><span class="tag">          <span class="attr">width</span>=<span class="string">&quot;30&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">height</span>=<span class="string">&quot;30&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">fit</span>=<span class="string">&quot;cover&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">src</span>=<span class="string">&quot;http://toutiao.meiduo.site/FgSTA3msGyxp5-Oufnm5c0kjVgW7&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;昵称&quot;</span> <span class="attr">value</span>=<span class="string">&quot;abc&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;性别&quot;</span> <span class="attr">value</span>=<span class="string">&quot;男&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;生日&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2019-9-27&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;UserIndex&quot;</span></span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、将该页面配置到根路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  name: <span class="string">&#x27;user-profile&#x27;</span>,</span><br><span class="line">  path: <span class="string">&#x27;/user/profile&#x27;</span>,</span><br><span class="line">  component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/user-profile&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="展示用户资料"><a href="#展示用户资料" class="headerlink" title="展示用户资料"></a>展示用户资料</h2><p>思路：</p>
<ul>
<li>请求获取数据</li>
<li>模板绑定</li>
</ul>
<p>1、在 <code>api/user.js</code> 中添加封装数据接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取用户资料</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> updateUserPhoto = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;PATCH&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;/app/v1_0/user/photo&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在 <code>views/user/index.vue</code> 组件中请求获取数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getUserProfile &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/user&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;UserProfile&#x27;</span>,</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      user: &#123;&#125;, <span class="comment">// 用户资料</span></span><br><span class="line">      isPreviewShow: <span class="literal">false</span>,</span><br><span class="line">      images: [] <span class="comment">// 预览的图片列表</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  watch: &#123;&#125;,</span><br><span class="line">  created () &#123;</span><br><span class="line">    <span class="built_in">this</span>.loadUserProfile()</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="keyword">async</span> loadUserProfile () &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getUserProfile()</span><br><span class="line">        <span class="built_in">this</span>.user = data.data</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">        <span class="built_in">this</span>.$toast.fail(<span class="string">&#x27;获取数据失败&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、模板绑定</p>
<h2 id="修改头像"><a href="#修改头像" class="headerlink" title="修改头像"></a>修改头像</h2><p>思路：</p>
<p>一、点击选择文件</p>
<p>二、图片预览</p>
<p>三、保存修改</p>
<h3 id="点击选择文件"><a href="#点击选择文件" class="headerlink" title="点击选择文件"></a>点击选择文件</h3><p>1、在模板中添加一个 file 类型的 input</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&quot;file&quot;</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">hidden</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>提示</p>
<p>如果是移动端，则会提示用户拍照、照片、文件</p>
</blockquote>
<p>2、当点击头像的时候手动调用 input 的 click 点击事件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">is-link</span> <span class="attr">title</span>=<span class="string">&quot;头像&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onAvatarClick&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">round</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:src</span>=<span class="string">&quot;user.photo&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">onAvatarClick () &#123;</span><br><span class="line">  <span class="comment">// 手动触发 input 的点击事件</span></span><br><span class="line">  <span class="built_in">this</span>.$refs[<span class="string">&#x27;file&#x27;</span>].click()</span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后测试。</p>
<h3 id="图片上传预览"><a href="#图片上传预览" class="headerlink" title="图片上传预览"></a>图片上传预览</h3><p>方式一：结合服务器的图片上传预览</p>
<ul>
<li>优点：兼容好</li>
<li>缺点：麻烦，需要结合服务端</li>
</ul>
<img src="https://yhx0507.github.io/wxapp_static/app/1567067894388.png" class="">

<p>方式二：纯客户端实现上传图片预览</p>
<ul>
<li>优点：简单方便</li>
<li>缺点：兼容性</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取文文件对象</span></span><br><span class="line"><span class="keyword">const</span> file = file类型input.files[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置图片的 src</span></span><br><span class="line">img.src = <span class="built_in">window</span>.URL.createObjectURL(file)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>下面我们使用纯客户端的方式处理用户头像上传预览。</p>
<p>1、在模板中添加预览组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 头像预览 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-image-preview</span> <span class="attr">v-model</span>=<span class="string">&quot;isPreviewShow&quot;</span> <span class="attr">:images</span>=<span class="string">&quot;images&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-nav-bar</span></span></span><br><span class="line"><span class="tag">    <span class="attr">slot</span>=<span class="string">&quot;cover&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">left-text</span>=<span class="string">&quot;取消&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">right-text</span>=<span class="string">&quot;确定&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click-left</span>=<span class="string">&quot;isPreviewShow = false&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click-right</span>=<span class="string">&quot;onUpdateAvatar&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-image-preview</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /头像预览 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">data &#123;</span><br><span class="line">  ...</span><br><span class="line">  isPreviewShow: <span class="literal">false</span>, <span class="comment">// 是否显示图片预览</span></span><br><span class="line">  images: [] <span class="comment">// 预览的图片列表</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、给 file-input 注册 change 事件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&quot;file&quot;</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">hidden</span> @<span class="attr">change</span>=<span class="string">&quot;onFileChange&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>change 事件只有在用户所选的文件发生变化之后会出触发，如果选择了同一个文件不会触发。所以为了解决该问题，我们可以在图片预览关闭的时候，手动将 file-input 的 value 清除。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 头像预览 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-image-preview</span> <span class="attr">v-model</span>=<span class="string">&quot;isPreviewShow&quot;</span> <span class="attr">:images</span>=<span class="string">&quot;images&quot;</span> @<span class="attr">close</span>=<span class="string">&quot;$refs.file.value = &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-nav-bar</span></span></span><br><span class="line"><span class="tag">        <span class="attr">slot</span>=<span class="string">&quot;cover&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">left-text</span>=<span class="string">&quot;取消&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">right-text</span>=<span class="string">&quot;确定&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click-left</span>=<span class="string">&quot;isPreviewShow = false&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click-right</span>=<span class="string">&quot;onUpdateAvatar&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-image-preview</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /头像预览 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>3、在事件处理函数中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">onFileChange () &#123;</span><br><span class="line">  <span class="comment">// 1. 拿到 file 类型 input 选择的文件对象</span></span><br><span class="line">  <span class="keyword">const</span> fileObj = <span class="built_in">this</span>.file.files[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 使用 window.URL.createObjectURL(file) 得到文件数据</span></span><br><span class="line">  <span class="keyword">const</span> fileData = <span class="built_in">window</span>.URL.createObjectURL(fileObj)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 将 img.src = 第2步的结果</span></span><br><span class="line">  <span class="built_in">this</span>.images = [fileData] <span class="comment">// 这里直接重置数组，防止出现多个预览图片</span></span><br><span class="line">  <span class="built_in">this</span>.isPreviewShow = <span class="literal">true</span> <span class="comment">// 显示图片预览</span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后测试。</p>
<h3 id="保存更新"><a href="#保存更新" class="headerlink" title="保存更新"></a>保存更新</h3><p>1、在 <code>api/user.js</code> 中添加封装数据接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新用户头像</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">updateUserPhoto</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;PATCH&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;/app/v1_0/user/photo&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>总结：</p>
<ul>
<li>如果 <code>Content-Type</code> 是 <code>application/json</code>，则传递普通 JavaScript 对象，例如 <code>&#123;&#125;</code></li>
<li>如果 <code>Content-Type</code> 是 <code>multipart/form-data</code>，则传递 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/FormData">FormData</a> 对象，这种情况常见于文件上传的数据接口。</li>
</ul>
</blockquote>
<p>2、给图片预览中的确定注册点击事件</p>
<p>3、在事件处理函数中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onUpdateAvatar () &#123;</span><br><span class="line">  <span class="comment">// 1. 构造包含文件数据的表单对象 FormData</span></span><br><span class="line">  <span class="comment">// 注意：含有文件的数据务必要放到 FormData 中</span></span><br><span class="line">  <span class="keyword">const</span> fd = <span class="keyword">new</span> FormData()</span><br><span class="line">  fd.append(<span class="string">&#x27;photo&#x27;</span>, <span class="built_in">this</span>.file.files[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.$toast.loading(&#123;</span><br><span class="line">    duration: <span class="number">0</span>, <span class="comment">// 持续展示 toast</span></span><br><span class="line">    message: <span class="string">&#x27;保存中...&#x27;</span>,</span><br><span class="line">    forbidClick: <span class="literal">true</span> <span class="comment">// 是否禁止背景点击</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 请求提交</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> updateUserPhoto(fd)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新页面</span></span><br><span class="line">    <span class="built_in">this</span>.user.photo = data.data.photo</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭图片预览</span></span><br><span class="line">    <span class="built_in">this</span>.isPreviewShow = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.$toast.success(<span class="string">&#x27;更新成功&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="built_in">this</span>.$toast.fail(<span class="string">&#x27;更新失败&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 根据响应结果执行后续处理</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="修改昵称"><a href="#修改昵称" class="headerlink" title="修改昵称"></a>修改昵称</h2><h3 id="布局-3"><a href="#布局-3" class="headerlink" title="布局"></a>布局</h3><h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><p>1、封装 API 请求方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新用户资料</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> updateUserProfile = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    method: <span class="string">&#x27;PATCH&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;/app/v1_0/user/profile&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>2、封装业务请求(更新用户昵称、性别、生日等都使用该方法)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// field: 要修改的数据字段</span></span><br><span class="line"><span class="comment">// value：数据值</span></span><br><span class="line"><span class="keyword">async</span> updateUserProfile (field, value) &#123;</span><br><span class="line">  <span class="built_in">this</span>.$toast.loading(&#123;</span><br><span class="line">    duration: <span class="number">0</span>, <span class="comment">// 持续展示 toast</span></span><br><span class="line">    message: <span class="string">&#x27;更新中...&#x27;</span>,</span><br><span class="line">    forbidClick: <span class="literal">true</span> <span class="comment">// 是否禁止背景点击</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> updateUserProfile(&#123;</span><br><span class="line">      [field]: value <span class="comment">// 注意属性名使用中括号包裹，否则会当做字符串来使用而不是变量</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">this</span>.$toast.success(<span class="string">&#x27;更新成功&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">    <span class="built_in">this</span>.$toast.fail(<span class="string">&#x27;更新失败&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>3、注册确定按钮点击事件</p>
<p>4、在事件处理函数中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onUpdateName () &#123;</span><br><span class="line">  <span class="comment">// 请求提交表单</span></span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">this</span>.updateUserProfile(<span class="string">&#x27;name&#x27;</span>, <span class="built_in">this</span>.inputName)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新视图</span></span><br><span class="line">  <span class="built_in">this</span>.user.name = <span class="built_in">this</span>.inputName</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 关闭弹层</span></span><br><span class="line">  <span class="built_in">this</span>.isEditNameShow = <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="修改性别"><a href="#修改性别" class="headerlink" title="修改性别"></a>修改性别</h2><h2 id="修改生日"><a href="#修改生日" class="headerlink" title="修改生日"></a>修改生日</h2><h1 id="十二、我的收藏-历史-作品"><a href="#十二、我的收藏-历史-作品" class="headerlink" title="十二、我的收藏/历史/作品"></a>十二、我的收藏/历史/作品</h1><img src="https://yhx0507.github.io/wxapp_static/app/image-20200203094246747.png" class="">

<h2 id="准备-6"><a href="#准备-6" class="headerlink" title="准备"></a>准备</h2><h2 id="我的收藏"><a href="#我的收藏" class="headerlink" title="我的收藏"></a>我的收藏</h2><h2 id="我的历史"><a href="#我的历史" class="headerlink" title="我的历史"></a>我的历史</h2><h2 id="我的作品"><a href="#我的作品" class="headerlink" title="我的作品"></a>我的作品</h2><h1 id="十三、小智同学"><a href="#十三、小智同学" class="headerlink" title="十三、小智同学"></a>十三、小智同学</h1><img src="https://yhx0507.github.io/wxapp_static/app/1566431856572.png" class="">

<h2 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><img src="https://yhx0507.github.io/wxapp_static/app/bg2017051501.png" class="">

<ul>
<li>WebSocket 是一种数据通信协议，类似于我们常见的 http</li>
<li>既然有 http，为啥还要 WebSocket</li>
<li>http 通信是单向的<ul>
<li>请求 + 响应</li>
<li>没有请求也就没有响应</li>
</ul>
</li>
</ul>
<p>初次接触 WebSocket 的人，都会问同样的问题：我们已经有了 HTTP 协议，为什么还需要另一个协议？它能带来什么好处？</p>
<p>答案很简单，因为 HTTP 协议有一个缺陷：通信只能由客户端发起。</p>
<p>举例来说，我们想了解今天的天气，只能是客户端向服务器发出请求，服务器返回查询结果。HTTP 协议做不到服务器主动向客户端推送信息。</p>
<p>这种单向请求的特点，注定了如果服务器有连续的状态变化，客户端要获知就非常麻烦。我们只能使用<a target="_blank" rel="noopener" href="https://www.pubnub.com/blog/2014-12-01-http-long-polling/">“轮询”</a>：每隔一段时候，就发出一个询问，了解服务器有没有新的信息。最典型的场景就是聊天室。</p>
<p>轮询的效率低，非常浪费资源（因为必须不停连接，或者 HTTP 连接始终打开）。因此，工程师们一直在思考，有没有更好的方法。WebSocket 就是这样发明的。</p>
<p>WebSocket 协议在 2008 年诞生，2011 年成为国际标准。所有浏览器都已经支持了。</p>
<p>它的最大特点就是，<strong>服务器可以主动向客户端推送信息</strong>，<strong>客户端也可以主动向服务器发送信息</strong>，是真正的<strong>双向平等对话</strong>，属于<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Push_technology">服务器推送技术</a>的一种。</p>
<p>简单理解：</p>
<p>HTTP 打电话：</p>
<ul>
<li>我问一句</li>
<li>你回答一句</li>
<li>没有提问就没有回答，即便对方主动给你说话，我也是个聋子听不见</li>
</ul>
<p>WebSocket 打电话：</p>
<ul>
<li>双向对话</li>
</ul>
<img src="https://yhx0507.github.io/wxapp_static/app/bg2017051502.png" class="">

<blockquote>
<p>HTTP 和 WebSocket 通信模型</p>
</blockquote>
<p>其他特点包括：</p>
<p>（1）建立在 TCP 协议之上，服务器端的实现比较容易。</p>
<p>（2）与 HTTP 协议有着良好的兼容性。默认端口也是 80 和 443，并且握手阶段（第 1 次建立连接）采用 HTTP 协议，因此握手时不容易屏蔽，能通过各种 HTTP 代理服务器。</p>
<p>（3）数据格式比较轻量，性能开销小，通信高效。</p>
<p>（4）可以发送文本，也可以发送二进制数据。</p>
<p>（5）没有同源跨域限制，客户端可以与任意服务器通信。</p>
<p>（6）协议标识符是<code>ws</code>（如果加密，则为<code>wss</code>），服务器网址就是 URL。</p>
<p>（7）浏览器专门为 WebSocket 通信提供了一个请求对象 <code>WebSocket</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ws:&#x2F;&#x2F;example.com:80&#x2F;some&#x2F;path</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="https://yhx0507.github.io/wxapp_static/app/bg2017051503.jpg" class="">

<h2 id="使用原生-WebSocket（了解）"><a href="#使用原生-WebSocket（了解）" class="headerlink" title="使用原生 WebSocket（了解）"></a>使用原生 WebSocket（了解）</h2><blockquote>
<p>参考文档：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket">MDN - WebSocket</a></li>
</ul>
</blockquote>
<p>浏览器为 HTTP 通信提供了 <code>XMLHttpRequest</code> 对象，同样的，也为 WebSocket 通信提供了一个通信操作接口：<code>WebSocket</code>。</p>
<p>通信模型：</p>
<ul>
<li>拨号（建立连接）</li>
<li>通话（双向通信）</li>
<li>结束通话（关闭连接）</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// WebSocet 通信模型</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 1. 拨打电话（建立连接）</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 注意：wss://echo.websocket.org 是一个在线的测试接口，仅用于 WebSocket 协议通信测试使用</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">&quot;wss://echo.websocket.org&quot;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 当连接建立成功，触发 open 事件</span></span></span><br><span class="line"><span class="javascript">      ws.onopen = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;建立连接成功 ...&quot;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 连接建立成功以后，就可以使用这个连接对象通信了</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// send 方法发送数据</span></span></span><br><span class="line"><span class="javascript">        ws.send(<span class="string">&quot;Hello WebSockets!&quot;</span>);</span></span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 当接收到对方发送的消息的时候，触发 message 事件</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 我们可以通过回调函数的 evt.data 获取对方发送的数据内容</span></span></span><br><span class="line"><span class="javascript">      ws.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;接收到消息: &quot;</span> + evt.data);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 当不需要通信的时候，可以手动的关闭连接</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// ws.close();</span></span></span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 当连接断开的时候触发 close 事件</span></span></span><br><span class="line"><span class="javascript">      ws.onclose = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;连接已关闭.&quot;</span>);</span></span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>怎么查看 WebSocket 请求日志：</p>
<img src="https://yhx0507.github.io/wxapp_static/app/1569575005360.png" class="">

<blockquote>
<p>朝上的绿色箭头是发出去的消息</p>
<p>朝下的红色箭头是收到的消息</p>
</blockquote>
<h2 id="Socket-IO（了解体验）"><a href="#Socket-IO（了解体验）" class="headerlink" title="Socket.IO（了解体验）"></a>Socket.IO（了解体验）</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><ul>
<li>原生的 WebSocket 使用比较麻烦，所以推荐使用一个封装好的解决方案：socket.io</li>
<li>socket.io 提供了服务端 + 客户端的实现<ul>
<li>客户端：浏览器</li>
<li>服务端：Java、Python、PHP、。。。。Node.js</li>
</ul>
</li>
<li>对于前端开发者来说，只需要关心她的客户端如何使用即可</li>
<li>注意：Socket.io 必须前后端配套使用<ul>
<li>实际工作中，socket.io 已经成为了各大后端开发的 WebSocket 通信主流解决方案</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/socketio/socket.io">GitHub 仓库</a></li>
<li><a target="_blank" rel="noopener" href="https://socket.io/">官网</a></li>
</ul>
<p>Socket.io 和 WebSocket 就好比它就好比 axios 和 XMLHTTPRequest 的关系。</p>
<h3 id="基本使用-1"><a href="#基本使用-1" class="headerlink" title="基本使用"></a>基本使用</h3><p>官方的 Hello World：<a target="_blank" rel="noopener" href="https://socket.io/get-started/chat/%E3%80%82">https://socket.io/get-started/chat/。</a></p>
<p>服务端代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)();</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>).createServer(app);</span><br><span class="line"><span class="keyword">var</span> io = <span class="built_in">require</span>(<span class="string">&quot;socket.io&quot;</span>)(http);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.sendFile(__dirname + <span class="string">&quot;/index.html&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">&quot;connection&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">  socket.on(<span class="string">&quot;disconnect&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;user disconnected&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  socket.on(<span class="string">&quot;chat message&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">    io.emit(<span class="string">&quot;chat message&quot;</span>, msg);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.listen(<span class="number">3000</span>, <span class="string">&quot;0.0.0.0&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;listening on *:3000&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>客户端代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Socket.IO chat<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">      * &#123;</span><br><span class="line">        margin: 0;</span><br><span class="line">        padding: 0;</span><br><span class="line">        box-sizing: border-box;</span><br><span class="line">      &#125;</span><br><span class="line">      body &#123;</span><br><span class="line">        font: 13px Helvetica, Arial;</span><br><span class="line">      &#125;</span><br><span class="line">      form &#123;</span><br><span class="line"><span class="css">        <span class="selector-tag">background</span>: <span class="selector-id">#000</span>;</span></span><br><span class="line">        padding: 3px;</span><br><span class="line">        position: fixed;</span><br><span class="line">        bottom: 0;</span><br><span class="line">        width: 100%;</span><br><span class="line">      &#125;</span><br><span class="line">      form input &#123;</span><br><span class="line">        border: 0;</span><br><span class="line">        padding: 10px;</span><br><span class="line">        width: 90%;</span><br><span class="line"><span class="css">        <span class="selector-tag">margin-right</span>: 0<span class="selector-class">.5</span>%;</span></span><br><span class="line">      &#125;</span><br><span class="line">      form button &#123;</span><br><span class="line">        width: 9%;</span><br><span class="line">        background: rgb(130, 224, 255);</span><br><span class="line">        border: none;</span><br><span class="line">        padding: 10px;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-id">#messages</span> &#123;</span></span><br><span class="line">        list-style-type: none;</span><br><span class="line">        margin: 0;</span><br><span class="line">        padding: 0;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-id">#messages</span> <span class="selector-tag">li</span> &#123;</span></span><br><span class="line">        padding: 5px 10px;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-id">#messages</span> <span class="selector-tag">li</span><span class="selector-pseudo">:nth-child(odd)</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">background</span>: <span class="selector-id">#eee</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 消息列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;messages&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 发送消息的表单 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;m&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">button</span>&gt;</span>Send<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- SocketIO 提供了一个客户端实现：socket.io.js --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/socket.io/socket.io.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://code.jquery.com/jquery-1.11.1.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 建立连接，得到 socket 通信对象</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> socket = io();</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      socket.on(<span class="string">&quot;connect&quot;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;建立连接成功了&quot;</span>);</span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">      $(<span class="string">&quot;form&quot;</span>).submit(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        e.preventDefault(); <span class="comment">// prevents page reloading</span></span></span><br><span class="line"><span class="javascript">        socket.emit(<span class="string">&quot;chat message&quot;</span>, $(<span class="string">&quot;#m&quot;</span>).val());</span></span><br><span class="line"><span class="javascript">        $(<span class="string">&quot;#m&quot;</span>).val(<span class="string">&quot;&quot;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">      socket.on(<span class="string">&quot;chat message&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">&quot;#messages&quot;</span>).append($(<span class="string">&quot;&lt;li&gt;&quot;</span>).text(msg));</span></span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="扩展：ngrok-代理"><a href="#扩展：ngrok-代理" class="headerlink" title="扩展：ngrok 代理"></a>扩展：ngrok 代理</h3><p><a target="_blank" rel="noopener" href="https://lipengzhou.com/posts/9c28d833/">https://lipengzhou.com/posts/9c28d833/</a></p>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>我们只需要关注客户端怎么使用：</p>
<ul>
<li>怎么建立连接</li>
<li>怎么发送消息</li>
<li>怎么接收消息</li>
</ul>
<p>建立连接：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socket = io(<span class="string">&quot;连接地址&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>发送数据：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发送指定类型的消息</span></span><br><span class="line"><span class="comment">// 数据可以是任何类型</span></span><br><span class="line">socket.emit(<span class="string">&quot;消息类型&quot;</span>, 数据);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>接收消息：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 消息类型</span></span><br><span class="line"><span class="comment">// 回调函数参数获取消息数据</span></span><br><span class="line">socket.on(<span class="string">&quot;消息类型&quot;</span>, <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>消息类型由后端给出，他会告诉你收发消息的类型，就好比 HTTP 接口中的请求路径一样。</p>
</blockquote>
<h2 id="小智同学"><a href="#小智同学" class="headerlink" title="小智同学"></a>小智同学</h2><h3 id="准备-7"><a href="#准备-7" class="headerlink" title="准备"></a>准备</h3><p>创建 <code>chat/index.vue</code>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>小智同学<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;ChatIndex&quot;</span></span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后配置路由：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">import</span> Chat <span class="keyword">from</span> <span class="string">&#x27;@/views/chat&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  <span class="comment">// 配置路由表</span></span><br><span class="line">  routes: [</span><br><span class="line">    ...</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&#x27;user-chat&#x27;</span>,</span><br><span class="line">      path: <span class="string">&#x27;/user/chat&#x27;</span>,</span><br><span class="line">      component: Chat</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后，在我的页面中点击 “小智同学” 跳转到聊天页面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 其它 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-grid</span> <span class="attr">clickable</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-grid-item</span> <span class="attr">icon</span>=<span class="string">&quot;star&quot;</span> <span class="attr">text</span>=<span class="string">&quot;我的收藏&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-grid-item</span> <span class="attr">icon</span>=<span class="string">&quot;chat&quot;</span> <span class="attr">text</span>=<span class="string">&quot;我的评论&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-grid-item</span> <span class="attr">icon</span>=<span class="string">&quot;like&quot;</span> <span class="attr">text</span>=<span class="string">&quot;我的点赞&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-grid-item</span> <span class="attr">icon</span>=<span class="string">&quot;browsing-history&quot;</span> <span class="attr">text</span>=<span class="string">&quot;浏览历史&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">van-grid</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;消息通知&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;用户反馈&quot;</span> <span class="attr">is-link</span> /&gt;</span></span><br><span class="line">  + <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;小智同学&quot;</span> <span class="attr">is-link</span> @<span class="attr">click</span>=<span class="string">&quot;$router.push(&#x27;/chat&#x27;)&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;系统设置&quot;</span> <span class="attr">is-link</span> <span class="attr">to</span>=<span class="string">&quot;/settings&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /其它 --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="布局-4"><a href="#布局-4" class="headerlink" title="布局"></a>布局</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;chat-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span></span></span><br><span class="line"><span class="tag">      <span class="attr">title</span>=<span class="string">&quot;小智同学&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">left-arrow</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">click-left</span>=<span class="string">&quot;$router.back()&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">fixed</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 消息列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;message-list&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;message-list&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;message-item&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:class</span>=<span class="string">&quot;&#123; reverse: item % 3 === 0 &#125;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">&quot;item in 20&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:key</span>=<span class="string">&quot;item&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">slot</span>=<span class="string">&quot;icon&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">round</span></span></span><br><span class="line"><span class="tag">          <span class="attr">width</span>=<span class="string">&quot;30&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">height</span>=<span class="string">&quot;30&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">src</span>=<span class="string">&quot;https://img.yzcdn.cn/vant/cat.jpeg&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; `hello$&#123;item&#125;` &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /消息列表 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 发送消息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">class</span>=<span class="string">&quot;send-message&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-field</span> <span class="attr">v-model</span>=<span class="string">&quot;message&quot;</span> <span class="attr">center</span> <span class="attr">clearable</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">slot</span>=<span class="string">&quot;button&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>发送<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /发送消息 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    data() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        message: <span class="string">&quot;&quot;</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    mounted() &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.list = <span class="built_in">this</span>.$refs[<span class="string">&quot;message-list&quot;</span>];</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.chat-container</span> &#123;</span></span><br><span class="line">    position: absolute;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100%;</span><br><span class="line">    padding: 46px 0 50px 0;</span><br><span class="line">    top: 0;</span><br><span class="line">    left: 0;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line"><span class="css">    <span class="selector-tag">background</span>: <span class="selector-id">#f5f5f6</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.message-list</span> &#123;</span></span><br><span class="line">      height: 100%;</span><br><span class="line">      overflow-y: scroll;</span><br><span class="line"><span class="css">      <span class="selector-class">.message-item</span> &#123;</span></span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: center;</span><br><span class="line">        padding: 10px;</span><br><span class="line"><span class="css">        <span class="selector-class">.title</span> &#123;</span></span><br><span class="line"><span class="css">          <span class="selector-tag">background</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">          padding: 5px;</span><br><span class="line">          border-radius: 6px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.avatar</span> &#123;</span></span><br><span class="line">          margin-right: 5px;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.reverse</span> &#123;</span></span><br><span class="line">        flex-direction: row-reverse;</span><br><span class="line"><span class="css">        <span class="selector-class">.title</span> &#123;</span></span><br><span class="line">          margin-right: 5px;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.send-message</span> &#123;</span></span><br><span class="line">      position: fixed;</span><br><span class="line">      bottom: 0;</span><br><span class="line">      left: 0;</span><br><span class="line">      right: 0;</span><br><span class="line"><span class="css">      <span class="selector-tag">background</span>: <span class="selector-id">#f5f5f6</span> !<span class="selector-tag">important</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;page-user-chat&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span></span></span><br><span class="line"><span class="tag">      <span class="attr">fixed</span></span></span><br><span class="line"><span class="tag">      <span class="attr">left-arrow</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">click-left</span>=<span class="string">&quot;$router.back()&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">title</span>=<span class="string">&quot;小智同学&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">van-nav-bar</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;chat-list&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;chat-item&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:class</span>=<span class="string">&quot;&#123;left:item.name===&#x27;xz&#x27;,right:item.name===&#x27;self&#x27;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">&quot;(item,i) in list&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-image</span> <span class="attr">v-if</span>=<span class="string">&quot;item.name===&#x27;xz&#x27;&quot;</span> <span class="attr">fit</span>=<span class="string">&quot;cover&quot;</span> <span class="attr">round</span> <span class="attr">:src</span>=<span class="string">&quot;xzAvatar&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;chat-pao&quot;</span>&gt;</span>&#123;&#123;item.msg&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-if</span>=<span class="string">&quot;item.name===&#x27;self&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">fit</span>=<span class="string">&quot;cover&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">round</span></span></span><br><span class="line"><span class="tag">          <span class="attr">src</span>=<span class="string">&quot;https://img.yzcdn.cn/vant/cat.jpeg&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;reply-container van-hairline--top&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-field</span> <span class="attr">v-model</span>=<span class="string">&quot;value&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;说点什么...&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-loading</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-if</span>=<span class="string">&quot;commentLoading&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">slot</span>=<span class="string">&quot;button&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">type</span>=<span class="string">&quot;spinner&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">size</span>=<span class="string">&quot;16px&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span><span class="tag">&lt;/<span class="name">van-loading</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-else</span></span></span><br><span class="line"><span class="tag">          @<span class="attr">click</span>=<span class="string">&quot;send()&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">slot</span>=<span class="string">&quot;button&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">style</span>=<span class="string">&quot;font-size:12px;color:#999&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span>提交<span class="tag">&lt;/<span class="name">span</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> xzAvatar <span class="keyword">from</span> <span class="string">&quot;@/assets/images/xz.png&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> io <span class="keyword">from</span> <span class="string">&quot;socket.io-client&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; userLocal &#125; <span class="keyword">from</span> <span class="string">&quot;@/utils/local&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    data() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        value: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="javascript">        list: <span class="literal">null</span>,</span></span><br><span class="line">        xzAvatar,</span><br><span class="line"><span class="javascript">        commentLoading: <span class="literal">false</span></span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.list = [];</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.socket = io(<span class="string">&quot;http://ttapi.research.itcast.cn&quot;</span>, &#123;</span></span><br><span class="line">        query: &#123;</span><br><span class="line">          token: userLocal.getUser().token</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.socket.on(<span class="string">&quot;connect&quot;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 建了链接后默认  小智给你打招呼</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.list.push(&#123; <span class="attr">name</span>: <span class="string">&quot;xz&quot;</span>, <span class="attr">msg</span>: <span class="string">&quot;你好&quot;</span> &#125;);</span></span><br><span class="line">      &#125;);</span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.socket.on(<span class="string">&quot;message&quot;</span>, <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 接受机器人消息</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.list.push(&#123; <span class="attr">name</span>: <span class="string">&quot;xz&quot;</span>, <span class="attr">msg</span>: data.msg &#125;);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.scrollBottom();</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    deactivated() &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.socket.close();</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      scrollBottom() &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.$refs.list.scrollTop = <span class="built_in">this</span>.$refs.list.scrollHeight;</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      send() &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.socket.emit(<span class="string">&quot;message&quot;</span>, &#123; <span class="attr">msg</span>: <span class="built_in">this</span>.value, <span class="attr">timestamp</span>: <span class="built_in">Date</span>.now() &#125;);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.list.push(&#123; <span class="attr">name</span>: <span class="string">&quot;self&quot;</span>, <span class="attr">msg</span>: <span class="built_in">this</span>.value &#125;);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.value = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.scrollBottom();</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.page-user-chat</span> &#123;</span></span><br><span class="line">    height: 100%;</span><br><span class="line">    width: 100%;</span><br><span class="line">    position: absolute;</span><br><span class="line">    left: 0;</span><br><span class="line">    top: 0;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">    padding: 46px 0 50px 0;</span><br><span class="line"><span class="css">    <span class="selector-class">.chat-list</span> &#123;</span></span><br><span class="line">      height: 100%;</span><br><span class="line">      overflow-y: scroll;</span><br><span class="line"><span class="css">      <span class="selector-class">.chat-item</span> &#123;</span></span><br><span class="line">        padding: 10px;</span><br><span class="line"><span class="css">        <span class="selector-class">.van-image</span> &#123;</span></span><br><span class="line">          vertical-align: top;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.chat-pao</span> &#123;</span></span><br><span class="line">          vertical-align: top;</span><br><span class="line">          display: inline-block;</span><br><span class="line">          min-width: 20px;</span><br><span class="line">          max-width: 60%;</span><br><span class="line">          min-height: 40px;</span><br><span class="line">          line-height: 40px;</span><br><span class="line"><span class="css">          <span class="selector-tag">border</span>: 0<span class="selector-class">.5px</span> <span class="selector-tag">solid</span> <span class="selector-id">#c2d9ea</span>;</span></span><br><span class="line">          border-radius: 4px;</span><br><span class="line">          position: relative;</span><br><span class="line">          padding: 0 10px;</span><br><span class="line"><span class="css">          <span class="selector-tag">background-color</span>: <span class="selector-id">#e0effb</span>;</span></span><br><span class="line">          word-break: break-all;</span><br><span class="line">          font-size: 14px;</span><br><span class="line"><span class="css">          <span class="selector-tag">color</span>: <span class="selector-id">#333</span>;</span></span><br><span class="line"><span class="css">          &amp;<span class="selector-pseudo">::before</span> &#123;</span></span><br><span class="line">            content: &quot;&quot;;</span><br><span class="line">            width: 10px;</span><br><span class="line">            height: 10px;</span><br><span class="line">            position: absolute;</span><br><span class="line">            top: 13px;</span><br><span class="line"><span class="css">            <span class="selector-tag">border-top</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#c2d9ea</span>;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">border-right</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#c2d9ea</span>;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background</span>: <span class="selector-id">#e0effb</span>;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.chat-item</span><span class="selector-class">.right</span> &#123;</span></span><br><span class="line">    text-align: right;</span><br><span class="line"><span class="css">    <span class="selector-class">.chat-pao</span> &#123;</span></span><br><span class="line">      margin-left: 0;</span><br><span class="line">      margin-right: 15px;</span><br><span class="line"><span class="css">      &amp;<span class="selector-pseudo">::before</span> &#123;</span></span><br><span class="line">        right: -6px;</span><br><span class="line">        transform: rotate(45deg);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.chat-item</span><span class="selector-class">.left</span> &#123;</span></span><br><span class="line">    text-align: left;</span><br><span class="line"><span class="css">    <span class="selector-class">.chat-pao</span> &#123;</span></span><br><span class="line">      margin-left: 15px;</span><br><span class="line">      margin-right: 0;</span><br><span class="line"><span class="css">      &amp;<span class="selector-pseudo">::before</span> &#123;</span></span><br><span class="line">        left: -6px;</span><br><span class="line">        transform: rotate(-135deg);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.van-image</span> &#123;</span></span><br><span class="line">    width: 40px;</span><br><span class="line">    height: 40px;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="css">  <span class="selector-class">.reply-container</span> &#123;</span></span><br><span class="line">    position: fixed;</span><br><span class="line">    left: 0;</span><br><span class="line">    bottom: 0;</span><br><span class="line">    height: 44px;</span><br><span class="line">    width: 100%;</span><br><span class="line"><span class="css">    <span class="selector-tag">background</span>: <span class="selector-id">#f5f5f5</span>;</span></span><br><span class="line">    z-index: 9999;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h3><p>步骤：</p>
<ul>
<li>安装<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/socketio/socket.io-client">https://github.com/socketio/socket.io-client</a></li>
</ul>
</li>
<li>导入</li>
<li>建立连接</li>
</ul>
<p>1、安装依赖</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yarn add socket.io-client</span></span><br><span class="line">npm i socket.io-client</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在初始化的时候建立连接</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io <span class="keyword">from</span> <span class="string">&quot;socket.io-client&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      message: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  created() &#123;</span><br><span class="line">    <span class="comment">// 建立连接</span></span><br><span class="line">    <span class="keyword">const</span> socket = io(<span class="string">&quot;http://ttapi.research.itcast.cn&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当客户端与服务器建立连接成功，触发 connect 事件</span></span><br><span class="line">    socket.on(<span class="string">&quot;connect&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;建立连接成功！&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="收发消息"><a href="#收发消息" class="headerlink" title="收发消息"></a>收发消息</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io <span class="keyword">from</span> <span class="string">&#x27;socket.io-client&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      message: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">+      socket: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  created () &#123;</span><br><span class="line">    <span class="comment">// 建立连接</span></span><br><span class="line">    <span class="keyword">const</span> socket = io(<span class="string">&#x27;http://ttapi.research.itcast.cn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把 socket 存储到 data 中，然后就可以在 methods 中访问到了</span></span><br><span class="line">+    <span class="built_in">this</span>.socket = socket</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当客户端与服务器建立连接成功，触发 connect 事件</span></span><br><span class="line">    socket.on(<span class="string">&#x27;connect&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;建立连接成功！&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 监听接收服务端消息</span></span><br><span class="line">+    socket.on(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">+      <span class="built_in">console</span>.log(<span class="string">&#x27;收到服务器消息：&#x27;</span>, data)</span><br><span class="line">+    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">+    onSendMessage () &#123;</span><br><span class="line">+      <span class="keyword">const</span> message = <span class="built_in">this</span>.message.trim()</span><br><span class="line">+      <span class="keyword">if</span> (!message) &#123;</span><br><span class="line">+        <span class="keyword">return</span></span><br><span class="line">+      &#125;</span><br><span class="line">+</span><br><span class="line">+      <span class="comment">// 发送消息</span></span><br><span class="line">+      <span class="built_in">this</span>.socket.emit(<span class="string">&#x27;message&#x27;</span>, &#123;</span><br><span class="line">+        msg: message,</span><br><span class="line">+        timestamp: <span class="built_in">Date</span>.now()</span><br><span class="line">+      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="展示消息列表"><a href="#展示消息列表" class="headerlink" title="展示消息列表"></a>展示消息列表</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;chat-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-nav-bar</span></span></span><br><span class="line"><span class="tag">      <span class="attr">title</span>=<span class="string">&quot;小智同学&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">left-arrow</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">click-left</span>=<span class="string">&quot;$router.back()&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">fixed</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /导航栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 消息列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;message-list&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;message-list&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;message-item&quot;</span></span></span><br><span class="line"><span class="tag">        +</span></span><br><span class="line"><span class="tag">        <span class="attr">:class</span>=<span class="string">&quot;&#123; reverse: item.isMe &#125;&quot;</span></span></span><br><span class="line"><span class="tag">        +</span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in messages&quot;</span></span></span><br><span class="line"><span class="tag">        +</span></span><br><span class="line"><span class="tag">        <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-image</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">slot</span>=<span class="string">&quot;icon&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">round</span></span></span><br><span class="line"><span class="tag">          <span class="attr">width</span>=<span class="string">&quot;30&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">height</span>=<span class="string">&quot;30&quot;</span></span></span><br><span class="line"><span class="tag">          +</span></span><br><span class="line"><span class="tag">          <span class="attr">:src</span>=<span class="string">&quot;item.photo&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>+ <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; item.message &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /消息列表 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 发送消息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">van-cell-group</span> <span class="attr">class</span>=<span class="string">&quot;send-message&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">van-field</span> <span class="attr">v-model</span>=<span class="string">&quot;message&quot;</span> <span class="attr">center</span> <span class="attr">clearable</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">          <span class="attr">slot</span>=<span class="string">&quot;button&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">          @<span class="attr">click</span>=<span class="string">&quot;onSendMessage&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span>发送<span class="tag">&lt;/<span class="name">van-button</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">van-field</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">van-cell-group</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /发送消息 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> io <span class="keyword">from</span> <span class="string">&#x27;socket.io-client&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&#x27;ChatIndex&#x27;</span>,</span></span><br><span class="line">    data () &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        message: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        socket: <span class="literal">null</span>,</span></span><br><span class="line"><span class="javascript">        <span class="comment">// [ &#123; message: &#x27;消息数据&#x27;, isMe: true, photo: &#x27;头像&#x27; &#125;, ]</span></span></span><br><span class="line"><span class="javascript">  +      messages: [] <span class="comment">// 存储所有的消息列表</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    created () &#123;</span><br><span class="line"><span class="javascript">      <span class="comment">// 建立连接</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> socket = io(<span class="string">&#x27;http://ttapi.research.itcast.cn&#x27;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 把 socket 存储到 data 中，然后就可以在 methods 中访问到了</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.socket = socket</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 当客户端与服务器建立连接成功，触发 connect 事件</span></span></span><br><span class="line"><span class="javascript">      socket.on(<span class="string">&#x27;connect&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&#x27;建立连接成功！&#x27;</span>)</span></span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 监听接收服务端消息</span></span></span><br><span class="line"><span class="javascript">      socket.on(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&#x27;收到服务器消息：&#x27;</span>, data)</span></span><br><span class="line"><span class="javascript">  +      <span class="built_in">this</span>.messages.push(&#123;</span></span><br><span class="line">  +        message: data.msg,</span><br><span class="line"><span class="javascript">  +        isMe: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">  +        photo: <span class="string">&#x27;http://toutiao.meiduo.site/FkBUsGwtrHKjoF0NPLzeilckol1-&#x27;</span></span></span><br><span class="line">  +      &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    methods: &#123;</span><br><span class="line">      onSendMessage () &#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> message = <span class="built_in">this</span>.message.trim()</span></span><br><span class="line">        if (!message) &#123;</span><br><span class="line"><span class="javascript">          <span class="keyword">return</span></span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 发送消息</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.socket.emit(<span class="string">&#x27;message&#x27;</span>, &#123;</span></span><br><span class="line">          msg: message,</span><br><span class="line"><span class="javascript">          timestamp: <span class="built_in">Date</span>.now()</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 把消息存储到数组中</span></span></span><br><span class="line"><span class="javascript">  +      <span class="built_in">this</span>.messages.push(&#123;</span></span><br><span class="line">  +        message,</span><br><span class="line"><span class="javascript">  +        isMe: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">  +        photo: <span class="string">&#x27;https://img.yzcdn.cn/vant/cat.jpeg&#x27;</span></span></span><br><span class="line">  +      &#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">// 清空文本框</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.message = <span class="string">&#x27;&#x27;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="数据持久化-1"><a href="#数据持久化-1" class="headerlink" title="数据持久化"></a>数据持久化</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io <span class="keyword">from</span> <span class="string">&#x27;socket.io-client&#x27;</span></span><br><span class="line">+ <span class="keyword">import</span> &#123; getItem, setItem &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/storage&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;ChatIndex&#x27;</span>,</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      message: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      socket: <span class="literal">null</span>,</span><br><span class="line">      <span class="comment">// [ &#123; message: &#x27;消息数据&#x27;, isMe: true, photo: &#x27;头像&#x27; &#125;, ]</span></span><br><span class="line">+      messages: getItem(<span class="string">&#x27;chat-messages&#x27;</span>) || []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">+  watch: &#123;</span><br><span class="line">+    messages (newValue) &#123;</span><br><span class="line">+      setItem(<span class="string">&#x27;chat-messages&#x27;</span>, newValue)</span><br><span class="line">+    &#125;</span><br><span class="line">+  &#125;,</span><br><span class="line"></span><br><span class="line">  created () &#123;</span><br><span class="line">    <span class="comment">// 建立连接</span></span><br><span class="line">    <span class="keyword">const</span> socket = io(<span class="string">&#x27;http://ttapi.research.itcast.cn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把 socket 存储到 data 中，然后就可以在 methods 中访问到了</span></span><br><span class="line">    <span class="built_in">this</span>.socket = socket</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当客户端与服务器建立连接成功，触发 connect 事件</span></span><br><span class="line">    socket.on(<span class="string">&#x27;connect&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;建立连接成功！&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 监听接收服务端消息</span></span><br><span class="line">    socket.on(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;收到服务器消息：&#x27;</span>, data)</span><br><span class="line">      <span class="built_in">this</span>.messages.push(&#123;</span><br><span class="line">        message: data.msg,</span><br><span class="line">        isMe: <span class="literal">false</span>,</span><br><span class="line">        photo: <span class="string">&#x27;http://toutiao.meiduo.site/FkBUsGwtrHKjoF0NPLzeilckol1-&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    onSendMessage () &#123;</span><br><span class="line">      <span class="keyword">const</span> message = <span class="built_in">this</span>.message.trim()</span><br><span class="line">      <span class="keyword">if</span> (!message) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 发送消息</span></span><br><span class="line">      <span class="built_in">this</span>.socket.emit(<span class="string">&#x27;message&#x27;</span>, &#123;</span><br><span class="line">        msg: message,</span><br><span class="line">        timestamp: <span class="built_in">Date</span>.now()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 把消息存储到数组中</span></span><br><span class="line">      <span class="built_in">this</span>.messages.push(&#123;</span><br><span class="line">        message,</span><br><span class="line">        isMe: <span class="literal">true</span>,</span><br><span class="line">        photo: <span class="string">&#x27;https://img.yzcdn.cn/vant/cat.jpeg&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 清空文本框</span></span><br><span class="line">      <span class="built_in">this</span>.message = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="消息列表自动滚动到底部"><a href="#消息列表自动滚动到底部" class="headerlink" title="消息列表自动滚动到底部"></a>消息列表自动滚动到底部</h3><p>公式：DOM.scrollTop = DOM.scrollHeight</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io <span class="keyword">from</span> <span class="string">&#x27;socket.io-client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getItem, setItem &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/storage&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;ChatIndex&#x27;</span>,</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      message: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      socket: <span class="literal">null</span>,</span><br><span class="line">      <span class="comment">// [ &#123; message: &#x27;消息数据&#x27;, isMe: true, photo: &#x27;头像&#x27; &#125;, ]</span></span><br><span class="line">      messages: getItem(<span class="string">&#x27;chat-messages&#x27;</span>) || []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  watch: &#123;</span><br><span class="line">    messages (newValue) &#123;</span><br><span class="line">      setItem(<span class="string">&#x27;chat-messages&#x27;</span>, newValue)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 让列表滚动到最底部</span></span><br><span class="line">+      <span class="keyword">const</span> messageList = <span class="built_in">this</span>.$refs[<span class="string">&#x27;message-list&#x27;</span>]</span><br><span class="line">+</span><br><span class="line">+      <span class="comment">// 这里需要把操作 DOM 的这个代码放到 $nextTick 中</span></span><br><span class="line">+      <span class="comment">// 为啥？明天再说</span></span><br><span class="line">+      <span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">+        messageList.scrollTop = messageList.scrollHeight</span><br><span class="line">+      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  created () &#123;</span><br><span class="line">    <span class="comment">// 建立连接</span></span><br><span class="line">    <span class="keyword">const</span> socket = io(<span class="string">&#x27;http://ttapi.research.itcast.cn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把 socket 存储到 data 中，然后就可以在 methods 中访问到了</span></span><br><span class="line">    <span class="built_in">this</span>.socket = socket</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当客户端与服务器建立连接成功，触发 connect 事件</span></span><br><span class="line">    socket.on(<span class="string">&#x27;connect&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;建立连接成功！&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 监听接收服务端消息</span></span><br><span class="line">    socket.on(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;收到服务器消息：&#x27;</span>, data)</span><br><span class="line">      <span class="built_in">this</span>.messages.push(&#123;</span><br><span class="line">        message: data.msg,</span><br><span class="line">        isMe: <span class="literal">false</span>,</span><br><span class="line">        photo: <span class="string">&#x27;http://toutiao.meiduo.site/FkBUsGwtrHKjoF0NPLzeilckol1-&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">+  mounted () &#123;</span><br><span class="line">+    <span class="keyword">const</span> messageList = <span class="built_in">this</span>.$refs[<span class="string">&#x27;message-list&#x27;</span>]</span><br><span class="line">+    messageList.scrollTop = messageList.scrollHeight</span><br><span class="line">+  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    onSendMessage () &#123;</span><br><span class="line">      <span class="keyword">const</span> message = <span class="built_in">this</span>.message.trim()</span><br><span class="line">      <span class="keyword">if</span> (!message) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 发送消息</span></span><br><span class="line">      <span class="built_in">this</span>.socket.emit(<span class="string">&#x27;message&#x27;</span>, &#123;</span><br><span class="line">        msg: message,</span><br><span class="line">        timestamp: <span class="built_in">Date</span>.now()</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 把消息存储到数组中</span></span><br><span class="line">      <span class="built_in">this</span>.messages.push(&#123;</span><br><span class="line">        message,</span><br><span class="line">        isMe: <span class="literal">true</span>,</span><br><span class="line">        photo: <span class="string">&#x27;https://img.yzcdn.cn/vant/cat.jpeg&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 清空文本框</span></span><br><span class="line">      <span class="built_in">this</span>.message = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="nextTick-的作用"><a href="#nextTick-的作用" class="headerlink" title="$nextTick 的作用"></a>$nextTick 的作用</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span> <span class="attr">ref</span>=<span class="string">&quot;message&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeMessage&quot;</span>&gt;</span>点击改变 message<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cn.vuejs.org/js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">			el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">			data: &#123;</span><br><span class="line"><span class="javascript">				message: <span class="string">&#x27;hello&#x27;</span></span></span><br><span class="line">			&#125;,</span><br><span class="line">			methods: &#123;</span><br><span class="line">				changeMessage () &#123;</span><br><span class="line"><span class="javascript">					<span class="comment">// 修改数据（响应式），数据改变会影响视图更新</span></span></span><br><span class="line"><span class="javascript">					<span class="comment">// 注意：数据影响视图不是即时的</span></span></span><br><span class="line"><span class="javascript">					<span class="built_in">this</span>.message = <span class="string">&#x27;world&#x27;</span></span></span><br><span class="line">					</span><br><span class="line"><span class="javascript">					<span class="built_in">this</span>.hello()</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">					<span class="comment">// 修改完数据之后，马上操作数据影响的这个 DOM</span></span></span><br><span class="line"><span class="javascript">					<span class="comment">// console.log(this.$refs.message.innerHTML)</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">					<span class="comment">// 什么场景下才需要使用这个 API？当你想要在修改数据之后马上操作数据影响的DOM。</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">					<span class="comment">// 为了解决这个问题，Vue 提供了一个特殊的 API：$nextTick</span></span></span><br><span class="line"><span class="javascript">					<span class="comment">// 该函数中的代码会确保本次数据更新视图之后才执行</span></span></span><br><span class="line"><span class="javascript">					<span class="comment">// 官方文档说明：https://cn.vuejs.org/v2/api/#vm-nextTick</span></span></span><br><span class="line"><span class="javascript">					<span class="comment">// 该代码不是更新视图 DOM，更新视图 DOM 是 Vue 的事儿</span></span></span><br><span class="line"><span class="javascript">					<span class="comment">// 简单理解：你可以把它当作一个定时器，它会在内部完成 DOM 修改之后触发调用</span></span></span><br><span class="line"><span class="javascript">					<span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">						<span class="built_in">console</span>.log(<span class="built_in">this</span>.$refs.message.innerHTML)</span></span><br><span class="line">					&#125;)</span><br><span class="line">				&#125;,</span><br><span class="line"></span><br><span class="line">				hello () &#123;</span><br><span class="line"><span class="javascript">					<span class="built_in">console</span>.log(<span class="built_in">this</span>.$refs.message.innerHTML)</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="十四、功能优化"><a href="#十四、功能优化" class="headerlink" title="十四、功能优化"></a>十四、功能优化</h1><h2 id="处理-token-过期"><a href="#处理-token-过期" class="headerlink" title="处理 token 过期"></a>处理 token 过期</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">request.interceptors.response.use(</span><br><span class="line">  <span class="comment">// 响应成功进入第1个函数</span></span><br><span class="line">  <span class="comment">// 该函数的参数是响应对象</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Any status code that lie within the range of 2xx cause this function to trigger</span></span><br><span class="line">    <span class="comment">// Do something with response data</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 响应失败进入第2个函数，该函数的参数是错误对象</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Any status codes that falls outside the range of 2xx cause this function to trigger</span></span><br><span class="line">    <span class="comment">// Do something with response error</span></span><br><span class="line">    <span class="comment">// 如果响应码是 401 ，则请求获取新的 token</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 响应拦截器中的 error 就是那个响应的错误对象</span></span><br><span class="line">    <span class="built_in">console</span>.dir(error)</span><br><span class="line">    <span class="keyword">if</span> (error.response &amp;&amp; error.response.status === <span class="number">401</span>) &#123;</span><br><span class="line">      <span class="comment">// 校验是否有 refresh_token</span></span><br><span class="line">      <span class="keyword">const</span> user = store.state.user</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!user || !user.refresh_token) &#123;</span><br><span class="line">        <span class="comment">// router.push(&#x27;/login&#x27;)</span></span><br><span class="line">+        redirectLogin()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 代码不要往后执行了</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果有refresh_token，则请求获取新的 token</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> axios(&#123;</span><br><span class="line">          method: <span class="string">&#x27;PUT&#x27;</span>,</span><br><span class="line">          url: <span class="string">&#x27;http://ttapi.research.itcast.cn/app/v1_0/authorizations&#x27;</span>,</span><br><span class="line">          headers: &#123;</span><br><span class="line">            Authorization: <span class="string">`Bearer <span class="subst">$&#123;user.refresh_token&#125;</span>`</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果获取成功，则把新的 token 更新到容器中</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;刷新 token  成功&#x27;</span>, res)</span><br><span class="line">        store.commit(<span class="string">&#x27;setUser&#x27;</span>, &#123;</span><br><span class="line">          token: res.data.data.token, <span class="comment">// 最新获取的可用 token</span></span><br><span class="line">          refresh_token: user.refresh_token <span class="comment">// 还是原来的 refresh_token</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 把之前失败的用户请求继续发出去</span></span><br><span class="line">        <span class="comment">// config 是一个对象，其中包含本次失败请求相关的那些配置信息，例如 url、method 都有</span></span><br><span class="line">        <span class="comment">// return 把 request 的请求结果继续返回给发请求的具体位置</span></span><br><span class="line">        <span class="keyword">return</span> request(error.config)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="comment">// 如果获取失败，直接跳转 登录页</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;请求刷线 token 失败&#x27;</span>, err)</span><br><span class="line">        <span class="comment">// router.push(&#x27;/login&#x27;)</span></span><br><span class="line">+        redirectLogin()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">+ <span class="function"><span class="keyword">function</span> <span class="title">redirectLogin</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">+   <span class="comment">// router.currentRoute 当前路由对象，和你在组件中访问的 this.$route 是同一个东西</span></span><br><span class="line">    <span class="comment">// query 参数的数据格式就是：?key=value&amp;key=value</span></span><br><span class="line">+   router.push(<span class="string">&#x27;/login?redirect=&#x27;</span> + router.currentRoute.fullPath)</span><br><span class="line">+ &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="登录成功跳转回原来页面"><a href="#登录成功跳转回原来页面" class="headerlink" title="登录成功跳转回原来页面"></a>登录成功跳转回原来页面</h2><p>首先在响应拦截器中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">request.interceptors.response.use(</span><br><span class="line">  <span class="comment">// 响应成功进入第1个函数</span></span><br><span class="line">  <span class="comment">// 该函数的参数是响应对象</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Any status code that lie within the range of 2xx cause this function to trigger</span></span><br><span class="line">    <span class="comment">// Do something with response data</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 响应失败进入第2个函数，该函数的参数是错误对象</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Any status codes that falls outside the range of 2xx cause this function to trigger</span></span><br><span class="line">    <span class="comment">// Do something with response error</span></span><br><span class="line">    <span class="comment">// 如果响应码是 401 ，则请求获取新的 token</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 响应拦截器中的 error 就是那个响应的错误对象</span></span><br><span class="line">    <span class="built_in">console</span>.dir(error)</span><br><span class="line">    <span class="keyword">if</span> (error.response &amp;&amp; error.response.status === <span class="number">401</span>) &#123;</span><br><span class="line">      <span class="comment">// 校验是否有 refresh_token</span></span><br><span class="line">      <span class="keyword">const</span> user = store.state.user</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!user || !user.refresh_token) &#123;</span><br><span class="line">        <span class="comment">// router.push(&#x27;/login&#x27;)</span></span><br><span class="line">+        redirectLogin()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 代码不要往后执行了</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果有refresh_token，则请求获取新的 token</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> axios(&#123;</span><br><span class="line">          method: <span class="string">&#x27;PUT&#x27;</span>,</span><br><span class="line">          url: <span class="string">&#x27;http://ttapi.research.itcast.cn/app/v1_0/authorizations&#x27;</span>,</span><br><span class="line">          headers: &#123;</span><br><span class="line">            Authorization: <span class="string">`Bearer <span class="subst">$&#123;user.refresh_token&#125;</span>`</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果获取成功，则把新的 token 更新到容器中</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;刷新 token  成功&#x27;</span>, res)</span><br><span class="line">        store.commit(<span class="string">&#x27;setUser&#x27;</span>, &#123;</span><br><span class="line">          token: res.data.data.token, <span class="comment">// 最新获取的可用 token</span></span><br><span class="line">          refresh_token: user.refresh_token <span class="comment">// 还是原来的 refresh_token</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 把之前失败的用户请求继续发出去</span></span><br><span class="line">        <span class="comment">// config 是一个对象，其中包含本次失败请求相关的那些配置信息，例如 url、method 都有</span></span><br><span class="line">        <span class="comment">// return 把 request 的请求结果继续返回给发请求的具体位置</span></span><br><span class="line">        <span class="keyword">return</span> request(error.config)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="comment">// 如果获取失败，直接跳转 登录页</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;请求刷线 token 失败&#x27;</span>, err)</span><br><span class="line">        <span class="comment">// router.push(&#x27;/login&#x27;)</span></span><br><span class="line">+        redirectLogin()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">+ <span class="function"><span class="keyword">function</span> <span class="title">redirectLogin</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">+   <span class="comment">// router.currentRoute 当前路由对象，和你在组件中访问的 this.$route 是同一个东西</span></span><br><span class="line">    <span class="comment">// query 参数的数据格式就是：?key=value&amp;key=value</span></span><br><span class="line">+   router.push(<span class="string">&#x27;/login?redirect=&#x27;</span> + router.currentRoute.fullPath)</span><br><span class="line">+ &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后在登录成功以后：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> redirect = <span class="built_in">this</span>.$route.query.redirect || <span class="string">&quot;/&quot;</span>;</span><br><span class="line"><span class="built_in">this</span>.$router.push(redirect);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="组件缓存"><a href="#组件缓存" class="headerlink" title="组件缓存"></a>组件缓存</h2><p>默认组件在切换的时候会销毁，有了组件缓存就可以帮我们把组件缓存起来而不销毁。</p>
<blockquote>
<p>参考文档：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/guide/components-dynamic-async.html#%E5%9C%A8%E5%8A%A8%E6%80%81%E7%BB%84%E4%BB%B6%E4%B8%8A%E4%BD%BF%E7%94%A8-keep-alive">在动态组件上使用 <code>keep-alive</code></a></li>
</ul>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 失活的组件将会被缓存！--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">  动态组件</span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：<code>&lt;keep-alive&gt;</code> 要求被切换到的组件都有自己的名字，不论是通过组件的 <code>name</code> 选项还是局部/全局注册。</p>
</blockquote>
<p>1、在 App.vue 对根路由组件启用组件缓存</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、在 <code>views/tabbar/index.vue</code> 对子路由也启用组件缓存</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="禁用组件缓存"><a href="#禁用组件缓存" class="headerlink" title="禁用组件缓存"></a>禁用组件缓存</h3><blockquote>
<p>参考文档：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/api/#keep-alive">https://cn.vuejs.org/v2/api/#keep-alive</a></li>
</ul>
</blockquote>
<p>手动销毁的方式需要修改组件内部的代码，这里介绍一种更灵活的方式来配置哪些组件缓存，哪些组件不缓存。</p>
<p><code>include</code> 和 <code>exclude</code> 属性允许组件有条件地缓存。二者都可以用逗号分隔字符串、正则表达式或一个数组来表示：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 逗号分隔字符串 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">include</span>=<span class="string">&quot;a,b&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;view&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 正则表达式 (使用 `v-bind`) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">:include</span>=<span class="string">&quot;/a|b/&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;view&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 数组 (使用 `v-bind`) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">:include</span>=<span class="string">&quot;[&#x27;a&#x27;, &#x27;b&#x27;]&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;view&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>匹配首先检查组件自身的 <code>name</code> 选项，如果 <code>name</code> 选项不可用，则匹配它的局部注册名称 (父组件 <code>components</code> 选项的键值)。匿名组件不能被匹配。</p>
<p>总结：</p>
<ul>
<li>根据需要设置需要缓存的组件</li>
<li>缓存需要占用更大的内容，当缓存组件过多的时候容易造成页面卡顿</li>
<li>把不需要缓存的组件排除缓存</li>
</ul>
<h3 id="动态缓存"><a href="#动态缓存" class="headerlink" title="动态缓存"></a>动态缓存</h3><h1 id="十五、打包发布"><a href="#十五、打包发布" class="headerlink" title="十五、打包发布"></a>十五、打包发布</h1><h2 id="构建打包"><a href="#构建打包" class="headerlink" title="构建打包"></a>构建打包</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br><span class="line"></span><br><span class="line"><span class="comment"># yarn run build</span></span><br><span class="line">yarn build</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>VueCLI 会把打包结果存储到项目的 <code>dist</code> 目录中。</p>
<p>项目中默认配置了生产环境不允许有 <code>console.log()</code>，如果有该代码，则打包就会报错。这里我们为了方便，建议手动关闭该规则。</p>
<p>找到项目根目录下的 <code>.eslintrc</code> 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  root: <span class="literal">true</span>,</span><br><span class="line">  env: &#123;</span><br><span class="line">    node: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&#x27;extends&#x27;</span>: [</span><br><span class="line">    <span class="string">&#x27;plugin:vue/essential&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;@vue/standard&#x27;</span></span><br><span class="line">  ],</span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="comment">// 错误代号: 报错级别</span></span><br><span class="line">    <span class="comment">// process.env.NODE_ENV === &#x27;production&#x27; 可以判定当前代码运行环境</span></span><br><span class="line">    <span class="comment">// 如果你的开发环境，则它是 false，如果是生产环境，则它是 true</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭 console.log 校验</span></span><br><span class="line">    <span class="string">&#x27;no-console&#x27;</span>: <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line">    <span class="comment">// &#x27;no-console&#x27;: process.env.NODE_ENV === &#x27;production&#x27; ? &#x27;error&#x27; : &#x27;off&#x27;,</span></span><br><span class="line">    <span class="string">&#x27;no-debugger&#x27;</span>: process.env.NODE_ENV === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;error&#x27;</span> : <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;no-unused-vars&#x27;</span>: process.env.NODE_ENV === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;error&#x27;</span> : <span class="string">&#x27;off&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    parser: <span class="string">&#x27;babel-eslint&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后重新打包。</p>
<h2 id="测试打包结果"><a href="#测试打包结果" class="headerlink" title="测试打包结果"></a>测试打包结果</h2><p>将 dist 放到一个 Web 服务器中运行测试。</p>
<ul>
<li>Ngxin</li>
<li>Apache</li>
<li>tomcat</li>
<li>IIS</li>
<li>。。。。</li>
<li>Node.js</li>
</ul>
<p>这里推荐使用 Vue 官方推荐的一个命令行 http 服务工具：<a target="_blank" rel="noopener" href="https://github.com/zeit/serve">serve</a>。</p>
<p>安装：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yarn global add serve</span></span><br><span class="line">npm install -g serve</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dist 是运行 Web 服务根目录</span></span><br><span class="line">serve -s dist</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>serve 默认占用 5000 端口并启动一个服务</p>
</blockquote>
<p>然后在浏览器中访问给出的地址访问测试。</p>
<blockquote>
<p>提示</p>
<p><code>npm run serve</code> 运行的开发中的源代码（src 中的代码）</p>
<p>这里使用 <code>serve</code> 工具启动运行的是打包结果 dist 中的代码，主要是用来测试打包结果是否可以正常运行。</p>
</blockquote>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><ul>
<li>公司有专门的 devops，说白了就是运维<ul>
<li>有些公司没有专门的运维人员，那就后端负责</li>
</ul>
</li>
<li>你只需要把打包结果给人家就可以了</li>
</ul>
<p>依赖知识：</p>
<ul>
<li>买一个服务器</li>
<li>Linux 操作系统、常用 Linux 命令</li>
<li>域名</li>
<li>搭建服务器环境</li>
<li>把本地的 Web 网站放到远程服务器</li>
<li>维护更新。。。。</li>
</ul>
<h2 id="扩展：GitHub-Pages"><a href="#扩展：GitHub-Pages" class="headerlink" title="扩展：GitHub Pages"></a>扩展：GitHub Pages</h2><p>GitHub Pages 可以帮我们托管静态网站。</p>
<p>GitHub Pages 中的域名：</p>
<ul>
<li><p>如果你的仓库名字叫：你的用户名.github.io，则访问地址是：<a target="_blank" rel="noopener" href="https://lipengzhou.github.io/">https://lipengzhou.github.io/</a></p>
</li>
<li><p>如果是其他的名字，则访问地址是：<a target="_blank" rel="noopener" href="https://lipengzhou.github.io/%E4%BB%93%E5%BA%93%E5%90%8D%E7%A7%B0/">https://lipengzhou.github.io/仓库名称/</a></p>
</li>
<li><p>自定义域名</p>
<ul>
<li>首先你得有一个自己的域名</li>
<li>然后将域名解析配置 CNAME 到：<code>你的用户名.github.io</code></li>
<li>在托管的仓库根目录放一个文件</li>
</ul>
</li>
</ul>
<blockquote>
<p>提示：</p>
<p>GitHub Pages 默认的域名强制开启 https，自定义域名可以选择 http 或者 https。</p>
</blockquote>
<p>使用 GitHub Pages + GitHub Actions 实现自动部署。</p>
<h3 id="GitHub-Pages"><a href="#GitHub-Pages" class="headerlink" title="GitHub Pages"></a>GitHub Pages</h3><h3 id="部署-Vue-项目到-GitHub-Pages"><a href="#部署-Vue-项目到-GitHub-Pages" class="headerlink" title="部署 Vue 项目到 GitHub Pages"></a>部署 Vue 项目到 GitHub Pages</h3><p>GitHub Pages 只能托管静态资源，我们的 Vue 项目需要打包才能产生静态资源。</p>
<p>有了静态资源（dist），把它放到 GitHub 仓库中，开启 GitHub Pages 托管。</p>
<p>一种方式：</p>
<ul>
<li>在本地打包：<code>npm run build</code>，得到 <code>dist</code> 资源</li>
<li>把 dist 推送到 GitHub 仓库中<ul>
<li>我们可以新建一个仓库（不推荐，维护麻烦）</li>
<li>也可以使用我们的源代码仓库（推荐，放到 gh-pages 分支中）</li>
</ul>
</li>
<li>把编译结果（dist）放到源代码仓库的 gh-pages（该分支名具有特殊含义，GitHub Pages 服务的要求）</li>
<li>然后把 gh-pages 分支托管到 GitHub Pages 服务中</li>
</ul>
<p>注意一：如果你的域名在一个子目录下，则必须配置项目的 publicPath。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">a.com</span><br><span class="line"></span><br><span class="line">a.com&#x2F;a</span><br><span class="line"></span><br><span class="line">.com</span><br><span class="line">.cn</span><br><span class="line">.io</span><br><span class="line"></span><br><span class="line">.com&#x2F;a</span><br><span class="line">.com&#x2F;a&#x2F;b</span><br><span class="line">.cn&#x2F;a</span><br><span class="line">.io&#x2F;a</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>注意二：GitHub Pages 默认域名强制开启 https 协议，https 协议下的网站不能访问 http 接口地址。</p>
<p>解决办法：</p>
<ul>
<li>把接口更新到 https</li>
<li>使用自定义域名，可以不开启 https</li>
</ul>
<h3 id="结合-GitHub-Actions-自动部署-Vue-项目"><a href="#结合-GitHub-Actions-自动部署-Vue-项目" class="headerlink" title="结合 GitHub Actions 自动部署 Vue 项目"></a>结合 GitHub Actions 自动部署 Vue 项目</h3><ul>
<li>手动打包</li>
<li>手动推送</li>
<li>太麻烦</li>
</ul>
<p>使用 GitHub Actions 就可以自动起来了。</p>
<p>一、关于域名</p>
<p>GitHub 虽然有默认免费域名，但是只能有一个根路径的域名，而且都必须强制开启 https，所以如果你的项目中有 http 接口是不行的。</p>
<p>所以建议购买一个自己的域名。</p>
<p>推荐阿里云的万网。</p>
<p>二、在域名解析记录中添加一个 CNAME 到 <code>你的GitHub用户名.github.io</code>。</p>
<img src="https://yhx0507.github.io/wxapp_static/app/006tNbRwly1gbmotawimpj329q0u010o.jpg" class="">

<img src="https://yhx0507.github.io/wxapp_static/app/006tNbRwly1gbmotr8teyj327b0u0n49.jpg" class="">

<img src="https://yhx0507.github.io/wxapp_static/app/image-20200206114558224.png" class="">

<blockquote>
<p>记录类型：CNAME</p>
<p>主机记录：</p>
<ul>
<li><code>@</code>: 访问地址：<code>lipengzhou.com</code></li>
<li><code>www</code> 访问地址：<code>www.lipengzhou.com</code></li>
<li><code>abc</code> → <code>abc.lipengzhou</code></li>
</ul>
<p>解析线路：默认</p>
<p>记录值：<code>你的GitHub用户名.github.io</code></p>
<p>TTL: 10分钟，默认的</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/image-20200206114832875.png" class="">

<blockquote>
<p>添加成功，确认是否能看到添加的这条记录。</p>
</blockquote>
<p>然后在项目的 <code>public</code> 目录中添加一个文件 <code>CNAME</code> 写入你的自定义域名</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">toutiao89.lipengzhou.com</span><br></pre></td></tr></table></figure>

<p>三、生成 GitHub Token</p>
<img src="https://yhx0507.github.io/wxapp_static/app/image-20200206115237278.png" class="">

<img src="https://yhx0507.github.io/wxapp_static/app/image-20200206115311948.png" class="">

<img src="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-12-18_22-47-10.png" class="">

<img src="https://yhx0507.github.io/wxapp_static/app/image-20200206115515608.png" class="">

<img src="https://yhx0507.github.io/wxapp_static/app/image-20200206115537061.png" class="">

<blockquote>
<p>滚动到页面底部，点击 Generate token</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/image-20200206115641953.png" class="">

<blockquote>
<p>复制绿色背景中的内容，自己保管起来。</p>
<p>注意：该内容只显示一次，之后不再显示，如果忘了，就重新生成。</p>
</blockquote>
<p>四、将 token 配置到项目的 secrets 中</p>
<img src="https://yhx0507.github.io/wxapp_static/app/image-20200206120118601.png" class="">

<blockquote>
<p>Name：最好和我的一致，如果你修改了则下面的脚本内容也要修改。</p>
<p>Value：填写上一步生成的那个 token。</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/image-20200206120155955.png" class="">

<blockquote>
<p>如图所示，添加成功了。</p>
</blockquote>
<p>五、配置 GitHub Actions</p>
<p>在项目中创建 <code>.github/workflows/main.yml</code> 并写入下面的配置内容。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">name: build and deploy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当 master 分支 push 代码的时候触发 workflow</span></span><br><span class="line">on:</span><br><span class="line">  push:</span><br><span class="line">    branches:</span><br><span class="line">    - master</span><br><span class="line"></span><br><span class="line"><span class="built_in">jobs</span>:</span><br><span class="line">  build-deploy:</span><br><span class="line">    runs-on: ubuntu-latest</span><br><span class="line">    steps:</span><br><span class="line">    <span class="comment"># 下载仓库代码</span></span><br><span class="line">    - uses: actions/checkout@v2</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 缓存依赖</span></span><br><span class="line">    - name: Cache dependencies</span><br><span class="line">      uses: actions/cache@v1</span><br><span class="line">      with:</span><br><span class="line">        path: ~/.npm</span><br><span class="line">        key: <span class="variable">$&#123;&#123; runner.os &#125;</span>&#125;-node-<span class="variable">$&#123;&#123; hashFiles(&#x27;**/package-lock.json&#x27;) &#125;</span>&#125;</span><br><span class="line">        restore-keys: |</span><br><span class="line">          <span class="variable">$&#123;&#123; runner.os &#125;</span>&#125;-node-</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 安装依赖</span></span><br><span class="line">    - run: npm ci</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 打包构建</span></span><br><span class="line">    - run: npm run build</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 发布到 GitHub Pages</span></span><br><span class="line">    - name: Deploy</span><br><span class="line">      uses: peaceiris/actions-gh-pages@v2</span><br><span class="line">      env:</span><br><span class="line">        PERSONAL_TOKEN: <span class="variable">$&#123;&#123; secrets.ACCESS_TOKEN &#125;</span>&#125;</span><br><span class="line">        PUBLISH_BRANCH: gh-pages</span><br><span class="line">        PUBLISH_DIR: ./dist</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>六、推送源代码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git add</span><br><span class="line">git commit</span><br><span class="line">git push</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>七、查看部署状态</p>
<img src="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-12-18_22-53-16.png" class="">

<img src="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-12-18_22-54-15.png" class="">

<blockquote>
<p>自动部署已触发</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-12-18_22-55-17.png" class="">

<img src="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-12-18_22-56-00.png" class="">

<blockquote>
<p>当所有的任务都完成变为绿色的对勾之后，就表示本次自动部署成功了。</p>
<p>当有新的源码 push 推送过来，会再次触发自动部署。</p>
<p>如果自动部署失败，会有红色的 ×，它还会给你发一封邮件告诉你部署失败了。</p>
</blockquote>
<p>部署成功以后，进入 settings 中查看 GitHub Pages 服务是否正常。</p>
<img src="https://yhx0507.github.io/wxapp_static/app/Snipaste_2020-12-18_22-56-58.png" class="">

<p>最后在浏览器中访问你的域名。</p>
<h1 id="十六、Vue-项目构建优化"><a href="#十六、Vue-项目构建优化" class="headerlink" title="十六、Vue 项目构建优化"></a>十六、Vue 项目构建优化</h1><p>大多数 Vue 项目是基于 VueCLI 搭建的，而 VueCLI 的底层建筑是 webpack。webpack 是现在主流的功能强大的模块化打包工具，在使用 webpack 时，如果不注意性能优化，有非常大的可能会产生性能问题，性能问题主要分为<strong>开发时打包构建速度慢</strong>、<strong>开发调试时的重复性工作</strong>、以及<strong>输出文件质量不高</strong>等，因此性能优化也主要从这些方面来分析。</p>
<p>本文主要针对是在 Vue 项目中关于底层建筑 webpack 优化以及 Vue 本身相关的一些优化事宜。</p>
<h2 id="把-VueCLI-升级到最新稳定版"><a href="#把-VueCLI-升级到最新稳定版" class="headerlink" title="把 VueCLI 升级到最新稳定版"></a>把 VueCLI 升级到最新稳定版</h2><p>尤其是 VueCLI 3 之前创建的项目，强烈建议升级到最新版 Vue CLI。</p>
<h2 id="分析打包结果"><a href="#分析打包结果" class="headerlink" title="分析打包结果"></a>分析打包结果</h2><ul>
<li>了解打包的内容</li>
<li>找出最大的模块是什么</li>
<li>查找错误到达的模块</li>
<li>优化它！</li>
</ul>
<h3 id="vue-cli-service-build"><a href="#vue-cli-service-build" class="headerlink" title="vue-cli-service build"></a>vue-cli-service build</h3><blockquote>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/guide/cli-service.html#vue-cli-service-build">https://cli.vuejs.org/zh/guide/cli-service.html#vue-cli-service-build</a></li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">用法：vue-cli-service build [options] [entry|pattern]</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line"></span><br><span class="line">  --mode        指定环境模式 (默认值：production)</span><br><span class="line">  --dest        指定输出目录 (默认值：dist)</span><br><span class="line">  --modern      面向现代浏览器带自动回退地构建应用</span><br><span class="line">  --target      app | lib | wc | wc-async (默认值：app)</span><br><span class="line">  --name        库或 Web Components 模式下的名字 (默认值：package.json 中的 &quot;name&quot; 字段或入口文件名)</span><br><span class="line">  --no-clean    在构建项目之前不清除目标目录</span><br><span class="line">  --report      生成 report.html 以帮助分析包内容</span><br><span class="line">  --report-json 生成 report.json 以帮助分析包内容</span><br><span class="line">  --watch       监听文件变化</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>vue-cli-service build</code> 会在 <code>dist/</code> 目录产生一个可用于生产环境的包，带有 JS/CSS/HTML 的压缩，和为更好的缓存而做的自动的 vendor chunk splitting。它的 chunk manifest 会内联在 HTML 里。</p>
<p>这里还有一些有用的命令参数：</p>
<ul>
<li><code>--modern</code> 使用<a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/guide/browser-compatibility.html#%E7%8E%B0%E4%BB%A3%E6%A8%A1%E5%BC%8F">现代模式</a>构建应用，为现代浏览器交付原生支持的 ES2015 代码，并生成一个兼容老浏览器的包用来自动回退。</li>
<li><code>--target</code> 允许你将项目中的任何组件以一个库或 Web Components 组件的方式进行构建。更多细节请查阅<a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/guide/build-targets.html">构建目标</a>。</li>
<li><code>--report</code> 和 <code>--report-json</code> 会根据构建统计生成报告，它会帮助你分析包中包含的模块们的大小。<ul>
<li>内部使用的 <a target="_blank" rel="noopener" href="https://github.com/webpack-contrib/webpack-bundle-analyzer">Webpack Bundle Analyzer</a> 插件。</li>
</ul>
</li>
</ul>
<h3 id="使用图形界面打包"><a href="#使用图形界面打包" class="headerlink" title="使用图形界面打包"></a>使用图形界面打包</h3><blockquote>
<p>自带分析功能</p>
</blockquote>
<p>在命令行中执行 <code>vue ui</code> 启动 VueCLI 图形界面。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vue ui</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Gzip-压缩"><a href="#Gzip-压缩" class="headerlink" title="Gzip 压缩"></a>Gzip 压缩</h2><p>网站加载的速度很大程序取决于网站资源文件的大小，减少要传输的文件的大小可以使网站不仅加载更快，而且对于那些宽带是按量计费的用户来说也更友好。</p>
<p>HTTP协议上的GZIP编码是一种用来改进WEB应用程序性能的技术。大流量的WEB站点常常使用GZIP<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%8E%8B%E7%BC%A9%E6%8A%80%E6%9C%AF">压缩技术</a>来让用户感受更快的速度。这一般是指WWW服务器中安装的一个功能，当有人来访问这个服务器中的网站时，服务器中的这个功能就将网页内容压缩后传输到来访的电脑浏览器中显示出来.一般对纯文本内容可压缩到原大小的40%.这样传输就快了，效果就是你点击网址后会很快的显示出来.当然这也会增加服务器的负载. 一般服务器中都安装有这个功能模块的。</p>
<p>Gzip 是什么？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">一种文件压缩格式。</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>开启 Gzip 有什么好处？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Gzip 开启以后会将输出到用户浏览器的数据进行压缩的处理，这样就会减小通过网络传输的数据量，提高文件传输的速度。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：<code>gzip</code>不一定适用于所有文件的压缩。例如，文本文件压缩得非常好，通常会缩小两倍以上。另一方面，诸如JPEG或PNG文件之类的图像已经按其性质进行压缩，使用<code>gzip</code>压缩很难有好的压缩效果或者甚至没有效果。压缩文件会占用服务器资源，因此最好只压缩那些压缩效果好的文件。</p>
<p>资源太小的文件也不会压缩。</p>
</blockquote>
<p>如何开启？</p>
<p>不同服务器软件配置不一样，具体由部署项目的人负责，一般是运维、后端开发人员，如果想要自行配置，可自行百度查询。大多数服务器软件都是默认开启的。</p>
<ul>
<li>Nginx</li>
<li>Tomcat</li>
<li>Apache</li>
<li>IIS</li>
<li>…</li>
</ul>
<blockquote>
<p>实际工作中，如果服务器软件没有开启，可以和负责运维部署的人员沟通。</p>
</blockquote>
<p>如何检测内容是否已开启了 Gzip 压缩？查看响应头中是否有下面的字段信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Content-Encoding: gzip</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>前端没有调整配置服务器软件麻烦，该怎么测试？</p>
<p>使用 VueCLI 官方推荐的 <a target="_blank" rel="noopener" href="https://github.com/zeit/serve">serve</a> 命令行工具。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、如果你已经安装了就不需要安装了</span></span><br><span class="line">npm install --global serve</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用该命令检测是否已安装或者是否安装成功，如果能看到输出一个版本号，则证明安装好了</span></span><br><span class="line">serve --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 Web 服务</span></span><br><span class="line">serve -s dist</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 -u 参数禁用 Gzip 压缩</span></span><br><span class="line">serve -s -u ./</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Gzip-压缩原理"><a href="#Gzip-压缩原理" class="headerlink" title="Gzip 压缩原理"></a>Gzip 压缩原理</h3><p>不是每个浏览器都支持gzip的，如何知道客户端是否支持gzip呢，请求头中有个 <code>Accept-Encoding</code> 来标识对压缩的支持。客户端http请求头声明浏览器支持的压缩方式，服务端配置启用压缩，压缩的文件类型，压缩方式。当客户端请求到服务端的时候，服务器解析请求头，如果客户端支持gzip压缩，响应时对请求的资源进行压缩并返回给客户端，浏览器按照自己的方式解析，在http响应头，我们可以看到 <code>Content-encoding: gzip</code>，这是指服务端使用了  <code>gzip</code> 的压缩方式。</p>
<h2 id="在-Vue-CLI-中自定义-webpack-配置"><a href="#在-Vue-CLI-中自定义-webpack-配置" class="headerlink" title="在 Vue CLI 中自定义 webpack 配置"></a>在 Vue CLI 中自定义 webpack 配置</h2><blockquote>
<p>参考文档：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/guide/webpack.html">https://cli.vuejs.org/zh/guide/webpack.html</a> </li>
</ul>
</blockquote>
<h2 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h2><ul>
<li><p>CDN 主要针对的静态资源</p>
</li>
<li><p>我们可以把我们自己的代码放到 CDN 上</p>
</li>
<li><p>也可以使用一些免费的第三方 CDN 服务</p>
<ul>
<li>一般提供的都是一些常用的第三方包的 CDN 服</li>
<li>例如 bootcdn</li>
</ul>
</li>
<li><p>我们最好把项目中比较大的第三方包都使用 CDN 链接</p>
<ul>
<li>不仅能提高构建的速度</li>
<li>还能提高页面的响应速度</li>
</ul>
</li>
<li><p>当我们在项目中使用 CDN 链接之后，就没必要下载打包第三方包了</p>
</li>
</ul>
<h2 id="路由懒加载"><a href="#路由懒加载" class="headerlink" title="路由懒加载"></a>路由懒加载</h2><p>属于首屏加载优化的一种方案。</p>
<p>默认情况下所有页面资源都会打包到一起，如果页面过多会导致单个文件体积过大。使用路由懒加载可以优化这种情况。它的思路就是把每个页面的资源都独立的生成一个资源文件，只有当访问到该页面的时候才会请求加载。</p>
<h2 id="异步组件"><a href="#异步组件" class="headerlink" title="异步组件"></a>异步组件</h2><p>和路由懒加载是一个道理。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> MyComponent <span class="keyword">from</span> <span class="string">&#x27;my-component&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    <span class="string">&#x27;my-component&#x27;</span>: MyComponent</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import MyComponent from &#x27;my-component&#x27;</span></span><br><span class="line"><span class="keyword">const</span> MyComponent = <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;my-component&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    <span class="comment">// &#x27;my-component&#x27;: MyComponent</span></span><br><span class="line">    <span class="string">&#x27;my-component&#x27;</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;my-component&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="prefetch"><a href="#prefetch" class="headerlink" title="prefetch"></a>prefetch</h2><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Link_prefetching_FAQ">link rel=”prefetch”</a> 是一种 resource hint，用来告诉浏览器在页面加载完成后，利用空闲时间提前获取用户未来可能会访问的内容。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;prefetch&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./h5.html&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello Index page<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;./h5.html&quot;</span>&gt;</span>go to H5 Page<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>默认情况下，一个 Vue CLI 应用会为所有作为 async chunk 生成的 JavaScript 文件 (<a target="_blank" rel="noopener" href="https://webpack.js.org/guides/code-splitting/#dynamic-imports">通过动态 <code>import()</code> 按需 code splitting</a> 的产物) 自动生成 prefetch 提示。</p>
<p>这些提示会被 <a target="_blank" rel="noopener" href="https://github.com/vuejs/preload-webpack-plugin">@vue/preload-webpack-plugin</a> 注入，并且可以通过 <code>chainWebpack</code> 的 <code>config.plugin(&#39;prefetch&#39;)</code> 进行修改和删除。</p>
<p>示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 移除 prefetch 插件</span></span><br><span class="line">    config.plugins.delete(<span class="string">&#x27;prefetch&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 或者</span></span><br><span class="line">    <span class="comment">// 修改它的选项：</span></span><br><span class="line">    config.plugin(<span class="string">&#x27;prefetch&#x27;</span>).tap(<span class="function"><span class="params">options</span> =&gt;</span> &#123;</span><br><span class="line">      options[<span class="number">0</span>].fileBlacklist = options[<span class="number">0</span>].fileBlacklist || []</span><br><span class="line">      options[<span class="number">0</span>].fileBlacklist.push(<span class="regexp">/myasyncRoute(.)+?\.js$/</span>)</span><br><span class="line">      <span class="keyword">return</span> options</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当 prefetch 插件被禁用时，你可以通过 webpack 的内联注释手动选定要提前获取的代码区块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackPrefetch: true */</span> <span class="string">&#x27;./someAsyncComponent.vue&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>webpack 的运行时会在父级区块被加载之后注入 prefetch 链接。</p>
<blockquote>
<p>提示</p>
<p>Prefetch 链接将会消耗带宽。如果你的应用很大且有很多 async chunk，而用户主要使用的是对带宽较敏感的移动端，那么你可能需要关掉 prefetch 链接并手动选择要提前获取的代码区块。</p>
</blockquote>
<p>使用建议：</p>
<ul>
<li>如果是 PC 端项目建议默认开启</li>
<li>如果是移动端项目建议关闭，帮用户节省流量</li>
</ul>
<h2 id="按需加载第三方组件"><a href="#按需加载第三方组件" class="headerlink" title="按需加载第三方组件"></a>按需加载第三方组件</h2><ul>
<li>例如 Vant、element 都支持按需加载</li>
</ul>
<h2 id="缓存和并行处理"><a href="#缓存和并行处理" class="headerlink" title="缓存和并行处理"></a>缓存和并行处理</h2><p>VueCLI 内置了：</p>
<ul>
<li><code>cache-loader</code> 会默认为 Vue/Babel/TypeScript 编译开启。文件会缓存在 <code>node_modules/.cache</code> 中——如果你遇到了编译方面的问题，记得先删掉缓存目录之后再试试看。</li>
<li><code>thread-loader</code> 会在多核 CPU 的机器上为 Babel/TypeScript 转译开启</li>
</ul>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><h1 id="十七、移动-App-开发"><a href="#十七、移动-App-开发" class="headerlink" title="十七、移动 App 开发"></a>十七、移动 App 开发</h1><h2 id="移动-App-开发相关概念"><a href="#移动-App-开发相关概念" class="headerlink" title="移动 App 开发相关概念"></a><a href="./%E7%A7%BB%E5%8A%A8App%E5%BC%80%E5%8F%91%E4%BB%8B%E7%BB%8D.md">移动 App 开发相关概念</a></h2><h2 id="混合应用开发（DCloud-HTML5-App）"><a href="#混合应用开发（DCloud-HTML5-App）" class="headerlink" title="混合应用开发（DCloud HTML5+ App）"></a>混合应用开发（DCloud HTML5+ App）</h2><ul>
<li>百分之九十五的技术还是 Web、百分之五的技术是原生应用</li>
</ul>
<h2 id="安装-HBuilder"><a href="#安装-HBuilder" class="headerlink" title="安装 HBuilder"></a>安装 HBuilder</h2><p>访问 HBuilder 的下载页面：<a target="_blank" rel="noopener" href="https://www.dcloud.io/hbuilderx.html">https://www.dcloud.io/hbuilderx.html</a></p>
<img src="https://yhx0507.github.io/wxapp_static/app/1570587926151.png" class="">

<blockquote>
<p>选择 DOWNLOAD</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/1570587995718.png" class="">

<blockquote>
<p>根据自己的操作系统下载对应的安装包。</p>
<ul>
<li><p>标准版：可直接用于 web 开发、markdown、字处理场景。做 App 仍需要安装插件</p>
</li>
<li><p>App 开发板：在标准版的基础之上预置了 App/uni-app 开发所需的插件，开箱即用</p>
</li>
</ul>
<p>如果是开发 App 建议下载安装 App 开发版即可。</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/1570588350152.png" class="">

<blockquote>
<p>下载的文件是一个压缩包</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/1570588463176.png" class="">

<blockquote>
<p>解压到当前文件夹（或者其它目录都可以）</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/1570588604586.png" class="">

<blockquote>
<p>进入 HBuilderX 目录中，找到 <code>HBuilderX.exe</code> 并打开。</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/1570590042920.png" class="">

<h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>在 Hbuilder 的菜单栏中依次找到：文件 -&gt; 新建 -&gt; 项目</p>
<img src="https://yhx0507.github.io/wxapp_static/app/1570590394808.png" class="">

<blockquote>
<ul>
<li>项目类型：选择 5+App</li>
<li>项目名称：给项目起个名字</li>
<li>存储目录：设置项目的存储目录</li>
<li>项目模板：选择默认模板</li>
</ul>
<p>配置好以后，点击“创建”</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/1570590670255.png" class="">

<blockquote>
<p>创建完成。</p>
</blockquote>
<p>项目目录结构说明：</p>
<ul>
<li><p><code>css</code>：存储项目中的样式文件资源</p>
</li>
<li><p><code>img</code>：存储项目中的图片文件资源</p>
</li>
<li><p><code>js</code>：存储项目中的 js 文件资源</p>
</li>
<li><p><code>unpackage</code>：存储不需要打包的文件资源</p>
</li>
<li><p><code>index.html</code>：项目首页</p>
</li>
<li><p><code>manifest.json</code>：打包 App 的配置文件</p>
</li>
</ul>
<p>为了待会儿我们真机调试运行能够看到页面效果，我们这里在项目的 <code>index.html</code> 中添加一个标签：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="真机调试运行"><a href="#真机调试运行" class="headerlink" title="真机调试运行"></a>真机调试运行</h3><p>这里我们主要了解如何把上一步创建好的项目运行到手机上（仅用于开发测试）。</p>
<h4 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h4><p>常见问题：</p>
<ul>
<li><p>HBuilder/HBuilderX真机运行、手机运行、真机联调常见问题：<a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/97">https://ask.dcloud.net.cn/article/97</a></p>
</li>
<li><p>确保手机开启了 USB 调试模式</p>
</li>
<li><p>建议下载安装 360 手机助手，如果 360 手机助手能够连接到手机，基本就 OK 了</p>
</li>
</ul>
<p>1、在手机的设置中找到并打开开发者选项</p>
<p>在手机的设置中找到开发者选项：</p>
<img src="https://yhx0507.github.io/wxapp_static/app/1570591544471.png" class="">

<blockquote>
<p>提示：大多数安卓手机的设置中默认没有开发者选项，如果没有就打开百度搜索：你的手机品牌型号开发者选项，例如：小米 9 开发者选项，然后根据搜索到的结果找到并打开开发者选项。</p>
</blockquote>
<p>2、启用开发者选项和 USB 调试</p>
<img src="https://yhx0507.github.io/wxapp_static/app/1570591838627.png" class="">

<p>3、使用数据线连接手机和电脑</p>
<p>4、在 HBuilder 的菜单栏中依次选择：运行 -&gt; 运行到手机或模拟器 -&gt; 你的手机设备</p>
<img src="https://yhx0507.github.io/wxapp_static/app/1570591970145.png" class="">

<blockquote>
<p>提示：如果没有发现你的手机设备，请参考：<a target="_blank" rel="noopener" href="http://ask.dcloud.net.cn/article/97">HBuilder/HBuilderX 真机运行、手机运行、真机联调常见问题</a></p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/1570592155354.png" class="">

<blockquote>
<p>运行到设备之后，Hbuilder 中会自动打开一个控制台并输出运行日志。</p>
</blockquote>
<p>然后 Hbuilder 需要安装调试基座（应用）到手机中，这个时候手机会提示你是否允许安装该应用，选择允许即可。</p>
<p>调试基座安装好以后，Hbuilder 会自动打开并将项目运行到这个 App 中。</p>
<img src="https://yhx0507.github.io/wxapp_static/app/1570592635004.png" class="">

<p>然后我们在 <code>index.html</code> 新增一些内容：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>杨柳青青江水平<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>闻郎江上唱歌声<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>东边日出西边雨<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>道是无晴却有晴<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="https://yhx0507.github.io/wxapp_static/app/1570592783359.png" class="">

<p>我们可以看到，手机 App 中的内容也自动更新了。</p>
<blockquote>
<p>如果没有自动更新，就手动退出并重新打开。</p>
</blockquote>
<h4 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h4><p>1、下载安装 <a target="_blank" rel="noopener" href="https://www.apple.com/cn/itunes/download/">iTunes</a></p>
<ul>
<li>Windows 用户：不要安装微软商店版</li>
<li>最新版的 macOS 不需要安装</li>
</ul>
<p>2、使用数据线连接到电脑</p>
<p>3、确保 iTunes 能够正常连接到手机</p>
<p>4、在 Hbuilder 中选择运行到你的 iPhone 设备</p>
<p>5、它会在手机中安装一个用于调试的测试 App：Hbuilder</p>
<p>6、在手机上设置 Hbuilder 为受信任的开发者</p>
<blockquote>
<p>注意：只有安装了未受信任的应用才能在设置中找到设备管理选项。</p>
</blockquote>
<p>因为 iPhone 的权限比较高，所以打开 Hbuilder 会提示“未受信任的企业级开发者”，所以这里需要手动设置该应用为受信任的开发者。</p>
<img src="https://yhx0507.github.io/wxapp_static/app/ios-trustapp-01.jpg" class="">

<img src="https://yhx0507.github.io/wxapp_static/app/ios-trustapp-02.jpg" class="">

<blockquote>
<p>打开手机的设置</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/ios-trustapp-03.jpg" class="">

<blockquote>
<p>在设置中找到通用并打开</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/ios-trustapp-04.jpg" class="">

<blockquote>
<p>打开设备管理</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/ios-trustapp-05.jpg" class="">

<blockquote>
<p>打开名称为 Digital Heaven… 的选项</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/ios-trustapp-06.jpg" class="">

<blockquote>
<p>选择“信任 Digital Heaven…”</p>
</blockquote>
<img src="https://yhx0507.github.io/wxapp_static/app/ios-trustapp-07.jpg" class="">

<blockquote>
<p>选择信任</p>
</blockquote>
<p>设置好以后就可以正常打开了，之后的其它操作和 Android 类似。</p>
<h3 id="访问-HTML5-API"><a href="#访问-HTML5-API" class="headerlink" title="访问 HTML5 + API"></a>访问 HTML5 + API</h3><ul>
<li><a target="_blank" rel="noopener" href="http://www.html5plus.org/doc/h5p.html">HTML5+ API Reference</a></li>
</ul>
<h3 id="打包发布"><a href="#打包发布" class="headerlink" title="打包发布"></a>打包发布</h3><ul>
<li>配置 <a target="_blank" rel="noopener" href="http://ask.dcloud.net.cn/article/94">manifest.json</a> 文件</li>
<li>在 HBuilder 中找到：发行 -&gt; 原生 App（云打包）</li>
<li>等待一段时间，得到打包结果安装包，然后安装到手机上测试</li>
<li>最后根据需要发布到对应的手机应用商店</li>
</ul>
<p>项目中的文件都被打包到应用安装包中了，只要安装了这个应用就不需要请求下载这些文件，除非是一些请求接口的功能必须是联网的。这种方式好处是一些核心文件不需要联网下载，但是更新麻烦，如果你修改了代码，则需要重新打包。</p>
<p>还有一种方式，我们把应用部署为网站，然后在这个壳儿里面加载我们的应用的那个网址。</p>
<p>如果是开发测试，则将 <code>manifest.json</code> 文件中的 <code>lanuchpath</code> 修改为你的局域网地址。</p>
<p>如果是发布部署，则将 <code>luanchpath</code> 设置为线上的地址。</p>
<h4 id="配置-manifest"><a href="#配置-manifest" class="headerlink" title="配置 manifest"></a>配置 manifest</h4><ul>
<li><a target="_blank" rel="noopener" href="http://ask.dcloud.net.cn/article/94">Manifest.json 文档说明 manifest 配置</a></li>
</ul>
<h4 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h4><ul>
<li>本地打包</li>
<li>云打包</li>
</ul>
<h4 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h4><h2 id="使用-Vue-js-开发-HTML5-App"><a href="#使用-Vue-js-开发-HTML5-App" class="headerlink" title="使用 Vue.js 开发 HTML5+ App"></a>使用 Vue.js 开发 HTML5+ App</h2><p>一、将你的项目部署到服务端</p>
<p>二、真机调试运行</p>
<p>1、启动本地开发 Web 服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yarn serve</span></span><br><span class="line">npm run serve</span><br></pre></td></tr></table></figure>

<p>2、启动手机真机调试</p>
<p>在 HBuilder 中，菜单栏 → 运行 → 运行到手机或模拟器 → 你的手机设备</p>
<p>3、编码测试。。。和原来在 PC 端的开发是一样的，只不过运行到了手机中</p>
<h3 id="打包发布-1"><a href="#打包发布-1" class="headerlink" title="打包发布"></a>打包发布</h3><p>一、打包手机安装包</p>
<p>1、将 <code>app/manifest.json</code> 中的 <code>launch_path</code> 改为线上地址：<code>http://toutiao89.lipengzhou.com</code>。</p>
<p>2、在 HBuilder 中加载项目中的 app 目录，菜单栏 → 发行 → 原生 App 云打包</p>
<p>3、配置打包规则</p>
<p>4、等待打包结果</p>
<p>5、根据需要发行到手机的应用商店供用户下载（安卓安装包可以直接放到自己的服务器供用户下载）</p>
<p>二、更新 App 内容？</p>
<p>只需要更新我们的网站就可以了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">将本地代码推送到 GitHub。</span><br><span class="line">触发 GitHub Actions 自动部署</span><br><span class="line"></span><br><span class="line">部署好以后，网站就更新了。</span><br></pre></td></tr></table></figure>



<p>手机 App 中的网页可能会有缓存问题，解决办法就是：结合前端 + 后端禁用缓存。</p>
<p>参考地址：<a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/question/31327">https://ask.dcloud.net.cn/question/31327</a></p>
<p>所以一般应用或是网站的更新都会选择在夜深人静的时候。</p>

      
       
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">赏</a>
</p>






    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2017 蜡笔小新</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" ></a>

    </div>
</div>
<div class="acParent"></div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#Proxy','#defineProperty','#cookie','#session','#Redux','#React','#Vue','#Vue-router','#router','#Vue3','#v-model','#Vue3新特性','#移动项目','#总结','#Vue组件通信','#git','#git stash','#git 版本回退','#不是内部命令或外部命令','#不是可运行的程序','#redux','#react','#Node','#Express','#小程序','#数组方法','#面试题','#csv表格下载','#文件下载','#图片下载','#Webpack','#Webpack入门','#Blob','#Vue3全局注册','#Vue2','#Canvas',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("/img/article-list-background.jpeg");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
